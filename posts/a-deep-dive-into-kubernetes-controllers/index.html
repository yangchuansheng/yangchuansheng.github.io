<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯» - Kubernetes|Docker|Istio|Envoy|Hugo|Golang|äº‘åŸç”Ÿ</title>


  <meta content="ç±³å¼€æœ—åŸºæ¨, kubernetes, controller, informer" name="keywords">

  <meta name="description" content="æœ¬æ–‡æˆ‘å°†ä¼šå¸¦ä½ æ·±å…¥äº†è§£ Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„ã€åŸºæœ¬ç»„ä»¶ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚">
  <meta name="author" content="ç±³å¼€æœ—åŸºæ¨"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "äº‘åŸç”Ÿå®éªŒå®¤",
    
    "url": "https:\/\/fuckcloudnative.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fuckcloudnative.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io\/posts\/a-deep-dive-into-kubernetes-controllers\/",
          "name": "Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯»"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "ç±³å¼€æœ—åŸºæ¨"
  },
  "headline": "Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯»",
  "description" : "æœ¬æ–‡æˆ‘å°†ä¼šå¸¦ä½ æ·±å…¥äº†è§£ Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„ã€åŸºæœ¬ç»„ä»¶ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚",
  "inLanguage" : "zh",
  "wordCount":  3846 ,
  "datePublished" : "2019-03-11T17:36:27",
  "dateModified" : "2019-03-11T17:36:27",
  "image" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
  "keywords" : [ "kubernetes" ],
  "mainEntityOfPage" : "https:\/\/fuckcloudnative.io\/posts\/a-deep-dive-into-kubernetes-controllers\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fuckcloudnative.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯»" />
<meta property="og:description" content="æœ¬æ–‡æˆ‘å°†ä¼šå¸¦ä½ æ·±å…¥äº†è§£ Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„ã€åŸºæœ¬ç»„ä»¶ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚">
<meta property="og:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
<meta property="og:url" content="https://fuckcloudnative.io/posts/a-deep-dive-into-kubernetes-controllers/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="äº‘åŸç”Ÿå®éªŒå®¤" />

  <meta name="twitter:title" content="Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯»" />
  <meta name="twitter:description" content="æœ¬æ–‡æˆ‘å°†ä¼šå¸¦ä½ æ·±å…¥äº†è§£ Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„ã€åŸºæœ¬ç»„ä»¶ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚">
  <meta name="twitter:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@RyangYang1" />
  <meta name="twitter:creator" content="@RyangYang1" />

  <link href='https://hugo-picture.oss-cn-beijing.aliyuncs.com/favicon-32x32.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.59.0" />
  <link rel="alternate" href="https://fuckcloudnative.io/index.xml" type="application/rss+xml" title="äº‘åŸç”Ÿå®éªŒå®¤">
  
  
  
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet">
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">


<link rel="stylesheet" href='/css/bundle.min.ca81645448b32fad41ea71de0716262d9ced5a37dc1c2499fbf80a12c2740528.css' integrity='sha256-yoFkVEizL61B6nHeBxYmLZztWjfcHCSZ&#43;/gKEsJ0BSg='>





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?efe96f04908ae320df234a4f5626879e";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script src="https://fuckcloudnative.io/js/pace.min.js"></script>



<script src="https://fuckcloudnative.io/js/busuanzi.pure.mini.js"></script>
<script>
var int = setInterval(fixCount, 50);
function fixCount() {
    if (document.getElementById('busuanzi_container_site_uv').ownerDocument.defaultView.getComputedStyle(document.getElementById('busuanzi_container_site_uv'), null).display === 'inline') {
        clearInterval(int);
        document.getElementById('busuanzi_value_site_uv') = parseInt(document.getElementById('busuanzi_value_site_uv').innerHTML) + parseInt('100000');
    }
}
</script>







    <div class="top-scroll-bar"></div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-145022311-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">åˆ‡æ¢å¯¼èˆª</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="https://fuckcloudnative.io">ğŸ³ > $ cd /home/</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-dharmachakra fa-spin" style="color:#986dbd"></i> æ–‡ç« åˆ†ç±»</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes/">kubernetes</a>
                
                  <a href="/categories/monitoring/">ç›‘æ§</a>
                
                  <a href="/categories/service-mesh/">Service Mesh</a>
                
                  <a href="/categories/devops/">DevOps</a>
                
                  <a href="/categories/docker/">Docker</a>
                
                  <a href="/categories/linux/">Linux</a>
                
                  <a href="/categories/python/">Python</a>
                
                  <a href="/categories/network/">ç½‘ç»œ</a>
                
                  <a href="/categories/loadbalance/"> è´Ÿè½½å‡è¡¡</a>
                
                  <a href="/categories/gfw/">ç§‘å­¦ä¸Šç½‘</a>
                
                  <a href="/categories/math/">æ•°å­¦</a>
                
                  <a href="/categories/share/">é»‘ç§‘æŠ€</a>
                
                  <a href="/categories/hugo/">Hugo</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fab fa-docker"></i> ç”µå­ä¹¦</a>
              <div class="navlinks-children">
                
                  <a href="/prometheus-handbook/">Prometheus ä¸­æ–‡æ–‡æ¡£</a>
                
                  <a href="/talent-is-overrated/">å¤©æ‰æºè‡ªåˆ»æ„ç»ƒä¹ </a>
                
                  <a href="/the-way-to-go/">Go å…¥é—¨æŒ‡å—</a>
                
                  <a href="https://github.com/fengdu78/Coursera-ML-AndrewNg-Notes">æœºå™¨å­¦ä¹ ç¬”è®°</a>
                
                  <a href="https://github.com/ruanyf/reading-list">é˜®ä¸€å³°ä¹¦å•</a>
                
                  <a href="https://istio.io/zh/docs">Istio service mesh</a>
                
                  <a href="https://www.gitbook.com/book/yeasy/docker_practice">Docker handbook</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-book"></i> è‘µèŠ±å®å…¸</a>
              <div class="navlinks-children">
                
                  <a href="/learn-english/"> è‹±è¯­å­¦ä¹ ç»ˆæç§˜è¯€</a>
                
                  <a href="/a-day-in-the-life-of-jeff/">A Day in the life of Jeff</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"> ğŸ˜±ç¦åˆ©</a>
              <div class="navlinks-children">
                
                  <a href="https://bt.fuckcloudnative.io">ç§å­æœç´¢</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Rss è®¢é˜…" href="/index.xml">Rss è®¢é˜…</a>
            </li>
          
        

        

        
        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">æœç´¢</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="äº‘åŸç”Ÿå®éªŒå®¤" href="https://fuckcloudnative.io">
            <img class="avatar-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" alt="äº‘åŸç”Ÿå®éªŒå®¤" />
          </a>
        </div>
      </div>
    

  </div>
</nav>





  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search fuckcloudnative.io</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>


<script src="https://fuckcloudnative.io/js/algoliasearch.min.js"></script>
<script src="https://fuckcloudnative.io/js/autocomplete.min.js"></script>


<script>
var client = algoliasearch("4BELQK2TOI", "62fd06bd949abb4211bfab0aa288f67b");
var index = client.initIndex('blog');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            
            return '<span>' + '<a href="/' + suggestion.uri+ '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>


    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1 
      
         
          data-img-src-1="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-04-27-080627.jpg" 
         
         
      ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
		  
		      <h1 align="center">Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯»</h1>
		  
                  
                    
		      <hr class="small">
                      <h2 class="post-subheading">Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„</h2>
                    
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;å‘è¡¨äº 2019 å¹´ 3 æœˆ 11 æ—¥
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;åˆ†é’Ÿ
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3846&nbsp;ä¸ªå­—
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
  
</span>

                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Kubernetes æ§åˆ¶å™¨çš„å·¥ä½œåŸç†è§£è¯»</h1>
              
              
              
                
                  <h2 class="post-subheading">Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;å‘è¡¨äº 2019 å¹´ 3 æœˆ 11 æ—¥
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;åˆ†é’Ÿ
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3846&nbsp;ä¸ªå­—
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
  
</span>

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <a title="æ¬ç“¦å·¥" href="https://bandwagonhost.com/aff.php?aff=54207" target="_blank">
<p id="sponsor-text" style="box-sizing: border-box;
    text-align: center;
    width: 100%;
    border: 1px solid #e5e4e9;
    background-color: #d0e4a9;
    margin: 1em 0 0;
    padding: 0.6em 0.6em 0.4em 0.6em;
    border-radius: 0.3em 0.3em 0.1em 0.1em;
    color: #076a66;"><span style="text-decoration: underline;">æ¬ç“¦å·¥</span>é¦™æ¸¯ VPS CN2ï¼Œè¶…ä½ä»· <span style="text-decoration: underline;">$2.99/å¹´</span>èµ·ã€‚é€‚åˆæ–°æ‰‹å…¥é—¨å»ºç«™ï¼Œæˆ‘çš„åšå®¢å°±æ˜¯åœ¨è¿™ä¸Šé¢æ­å»ºçš„</p>
<p style="padding:0em;margin:0 0 1.5em 0;border: 1px solid #e5e4e9;border-radius: 0.1em 0.1em 0.3em 0.3em;background-color: #28344a;text-align: center;" class="entry-sponsor-img">
  <img alt="æ¬ç“¦å·¥" id="support-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/bandwagonhost.jpg" style="border: none;width: 100%;max-width: 100%;display: inline-block;">

</p>
</a>

      <article role="main" class="blog-post">
	
<aside class="toc">
    <div id='anchors-navbar'>
        <i class='fa fa-anchor'></i>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-id-inline-toc-1-span-æ§åˆ¶å™¨çš„æ¨¡å‹"><span id="inline-toc">1.</span> æ§åˆ¶å™¨çš„æ¨¡å‹</a></li>
<li><a href="#span-id-inline-toc-2-span-æ°´å¹³è§¦å‘çš„-api"><span id="inline-toc">2.</span> æ°´å¹³è§¦å‘çš„ API</a></li>
<li><a href="#span-id-inline-toc-3-span-æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„"><span id="inline-toc">3.</span> æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„</a>
<ul>
<li><a href="#informer">Informer</a>
<ul>
<li><a href="#listwatcher">ListWatcher</a></li>
<li><a href="#resource-event-handler">Resource Event Handler</a></li>
<li><a href="#resyncperiod">ResyncPeriod</a></li>
</ul></li>
<li><a href="#sharedinformer">SharedInformer</a></li>
<li><a href="#workqueue">Workqueue</a></li>
</ul></li>
<li><a href="#span-id-inline-toc-4-span-å‚è€ƒèµ„æ–™"><span id="inline-toc">4.</span> å‚è€ƒèµ„æ–™</a></li>
</ul></li>
</ul>
</nav>
    </div>
    
</aside>


        
         

         
           
           <p>Kubernetes ä¸­è¿è¡Œäº†ä¸€ç³»åˆ—æ§åˆ¶å™¨æ¥ç¡®ä¿é›†ç¾¤çš„å½“å‰çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œå®ƒä»¬å°±æ˜¯ Kubernetes çš„å¤§è„‘ã€‚ä¾‹å¦‚ï¼ŒReplicaSet æ§åˆ¶å™¨è´Ÿè´£ç»´æŠ¤é›†ç¾¤ä¸­è¿è¡Œçš„ Pod æ•°é‡ï¼›Node æ§åˆ¶å™¨è´Ÿè´£ç›‘æ§èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¹¶åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶åŠæ—¶åšå‡ºå“åº”ã€‚æ€»è€Œè¨€ä¹‹ï¼Œåœ¨ Kubernetes ä¸­ï¼Œ<strong>æ¯ä¸ªæ§åˆ¶å™¨åªè´Ÿè´£æŸç§ç±»å‹çš„ç‰¹å®šèµ„æº</strong>ã€‚å¯¹äºé›†ç¾¤ç®¡ç†å‘˜æ¥è¯´ï¼Œäº†è§£æ¯ä¸ªæ§åˆ¶å™¨çš„è§’è‰²åˆ†å·¥è‡³å…³é‡è¦ï¼Œå¦‚æœ‰å¿…è¦ï¼Œä½ è¿˜éœ€è¦æ·±å…¥äº†è§£æ§åˆ¶å™¨çš„å·¥ä½œåŸç†ã€‚</p>

<p>æœ¬æ–‡æˆ‘å°†ä¼šå¸¦ä½ æ·±å…¥äº†è§£ Kubernetes æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„ã€åŸºæœ¬ç»„ä»¶ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯ä» Kubernetes æ§åˆ¶å™¨çš„å½“å‰å®ç°ä»£ç ä¸­æå–çš„ï¼ŒåŸºäº Go è¯­è¨€çš„ <a href="https://github.com/kubernetes/client-go" target="_blank">client-go</a> åº“ã€‚</p>

<h2 id="span-id-inline-toc-1-span-æ§åˆ¶å™¨çš„æ¨¡å‹"><span id="inline-toc">1.</span> æ§åˆ¶å™¨çš„æ¨¡å‹</h2>

<hr />

<p>Kubernetes å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†æ§åˆ¶å™¨æœ€å®Œç¾çš„è§£é‡Šï¼š</p>

<blockquote>
<p>In applications of robotics and automation, a control loop is a non-terminating loop that regulates the state of the system. In Kubernetes, a controller is a control loop that watches the shared state of the cluster through the API server and makes changes attempting to move the current state towards the desired state. Examples of controllers that ship with Kubernetes today are the replication controller, endpoints controller, namespace controller, and serviceaccounts controller.</p>
</blockquote>

<p>ç¿»è¯‘ï¼š</p>

<blockquote>
<p>åœ¨æœºå™¨äººè®¾è®¡å’Œè‡ªåŠ¨åŒ–çš„åº”ç”¨ä¸­ï¼Œ<strong>æ§åˆ¶å¾ªç¯</strong>æ˜¯ä¸€ä¸ªç”¨æ¥è°ƒèŠ‚ç³»ç»ŸçŠ¶æ€çš„éç»ˆæ­¢å¾ªç¯ã€‚è€Œåœ¨ Kubernetes ä¸­ï¼Œæ§åˆ¶å™¨å°±æ˜¯å‰é¢æåˆ°çš„æ§åˆ¶å¾ªç¯ï¼Œå®ƒé€šè¿‡ API Server ç›‘æ§æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼Œå¹¶ç¡®ä¿é›†ç¾¤å¤„äºé¢„æœŸçš„å·¥ä½œçŠ¶æ€ã€‚Kubernetes è‡ªå¸¦çš„æ§åˆ¶å™¨æœ‰ ReplicaSet æ§åˆ¶å™¨ï¼ŒEndpoint æ§åˆ¶å™¨ï¼ŒNamespace æ§åˆ¶å™¨å’Œ Service Account æ§åˆ¶å™¨ç­‰ã€‚</p>
</blockquote>

<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/" target="_blank">Kube-controller-manager</a></p>

<p>Kubernetes æ§åˆ¶å™¨ä¼šç›‘è§†èµ„æºçš„åˆ›å»º/æ›´æ–°/åˆ é™¤äº‹ä»¶ï¼Œå¹¶è§¦å‘ <code>Reconcile</code> å‡½æ•°ä½œä¸ºå“åº”ã€‚æ•´ä¸ªè°ƒæ•´è¿‡ç¨‹è¢«ç§°ä½œ â€œReconcile Loopâ€ï¼ˆè°ƒè°å¾ªç¯ï¼‰æˆ–è€… â€œSync Loopâ€ï¼ˆåŒæ­¥å¾ªç¯ï¼‰ã€‚<code>Reconcile</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ objectï¼ˆResource çš„å®ä¾‹ï¼‰çš„å‘½åç©ºé—´å’Œ object åæ¥è°ƒç”¨çš„å‡½æ•°ï¼Œä½¿ object çš„å®é™…çŠ¶æ€ä¸ object çš„ <code>Spec</code> ä¸­å®šä¹‰çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚è°ƒç”¨å®Œæˆåï¼Œ<code>Reconcile</code> ä¼šå°† object çš„çŠ¶æ€æ›´æ–°ä¸ºå½“å‰å®é™…çŠ¶æ€ã€‚</p>

<p>ä»€ä¹ˆæ—¶å€™æ‰ä¼šè§¦å‘ <code>Reconcile</code> å‡½æ•°å‘¢ï¼Ÿä»¥ ReplicaSet æ§åˆ¶å™¨ä¸ºä¾‹ï¼Œå½“æ”¶åˆ°äº†ä¸€ä¸ªå…³äº ReplicaSet çš„äº‹ä»¶æˆ–è€…å…³äº ReplicaSet åˆ›å»º Pod çš„äº‹ä»¶æ—¶ï¼Œå°±ä¼šè§¦å‘ <code>Reconcile</code> å‡½æ•°ã€‚</p>

<p>ä¸ºäº†é™ä½å¤æ‚æ€§ï¼ŒKubernetes å°†æ‰€æœ‰çš„æ§åˆ¶å™¨éƒ½æ‰“åŒ…åˆ° <code>kube-controller-manager</code> è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹ä¸­ã€‚ä¸‹é¢æ˜¯æ§åˆ¶å™¨æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼š</p>

<pre><code class="language-go">for {
  desired := getDesiredState()
  current := getCurrentState()
  makeChanges(desired, current)
}
</code></pre>

<h2 id="span-id-inline-toc-2-span-æ°´å¹³è§¦å‘çš„-api"><span id="inline-toc">2.</span> æ°´å¹³è§¦å‘çš„ API</h2>

<hr />

<p>Kubernetes çš„ API å’Œæ§åˆ¶å™¨éƒ½æ˜¯åŸºäºæ°´å¹³è§¦å‘çš„ï¼Œå¯ä»¥ä¿ƒè¿›ç³»ç»Ÿçš„è‡ªæˆ‘ä¿®å¤å’Œå‘¨æœŸåè°ƒã€‚<strong>æ°´å¹³è§¦å‘</strong>è¿™ä¸ªæ¦‚å¿µæ¥è‡ªç¡¬ä»¶çš„ä¸­æ–­ï¼Œä¸­æ–­å¯ä»¥æ˜¯æ°´å¹³è§¦å‘ï¼Œä¹Ÿå¯ä»¥æ˜¯è¾¹ç¼˜è§¦å‘ã€‚</p>

<ul>
<li><span id="inline-purple">æ°´å¹³è§¦å‘</span> : ç³»ç»Ÿä»…ä¾èµ–äºå½“å‰çŠ¶æ€ã€‚å³ä½¿ç³»ç»Ÿé”™è¿‡äº†æŸä¸ªäº‹ä»¶ï¼ˆå¯èƒ½å› ä¸ºæ•…éšœæŒ‚æ‰äº†ï¼‰ï¼Œå½“å®ƒæ¢å¤æ—¶ï¼Œä¾ç„¶å¯ä»¥é€šè¿‡æŸ¥çœ‹ä¿¡å·çš„å½“å‰çŠ¶æ€æ¥åšå‡ºæ­£ç¡®çš„å“åº”ã€‚</li>
<li><span id="inline-purple">è¾¹ç¼˜è§¦å‘</span> : ç³»ç»Ÿä¸ä»…ä¾èµ–äºå½“å‰çŠ¶æ€ï¼Œè¿˜ä¾èµ–äºè¿‡å»çš„çŠ¶æ€ã€‚å¦‚æœç³»ç»Ÿé”™è¿‡äº†æŸä¸ªäº‹ä»¶ï¼ˆâ€œè¾¹ç¼˜â€ï¼‰ï¼Œåˆ™å¿…é¡»é‡æ–°æŸ¥çœ‹è¯¥äº‹ä»¶æ‰èƒ½æ¢å¤ç³»ç»Ÿã€‚</li>
</ul>

<p>Kubernetes æ°´å¹³è§¦å‘çš„ API å®ç°æ–¹å¼æ˜¯ï¼šç›‘è§†ç³»ç»Ÿçš„å®é™…çŠ¶æ€ï¼Œå¹¶ä¸å¯¹è±¡çš„ <code>Spec</code> ä¸­å®šä¹‰çš„æœŸæœ›çŠ¶æ€è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åå†è°ƒç”¨ <code>Reconcile</code> å‡½æ•°æ¥è°ƒæ•´å®é™…çŠ¶æ€ï¼Œä½¿ä¹‹ä¸æœŸæœ›çŠ¶æ€ç›¸åŒ¹é…ã€‚</p>

<style type="text/css">.notice{padding:18px;line-height:24px;margin-bottom:24px;margin-top:30px;border-radius:4px;color:#444;background:#e7f2fa}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de}.notice-title:before{margin-right:8px;font-family:"Font Awesome 5 Free",FontAwesome;font-weight:600}.notice.warning .notice-title{background:rgba(217,83,79,.9)}.notice.warning .notice-title:before{content:'\f071'}.notice.warning{background:#fae2e2}.notice.info .notice-title{background:#f0b37e}.notice.info .notice-title:before{content:'\f05a'}.notice.info{background:#fff2db}.notice.note .notice-title{background:#6ab0de}.notice.note .notice-title:before{content:'\f06a'}.notice.note{background:#e7f2fA}.notice.tip .notice-title{background:rgba(92,184,92,.8)}.notice.tip .notice-title:before{content:'\f058'}.notice.tip{background:#e6f9e6}</style><div class="notice note" >
<p class="first notice-title">æ³¨æ„</p><p>æ°´å¹³è§¦å‘çš„ API ä¹Ÿå«å£°æ˜å¼ APIã€‚</p></div>


<p>æ°´å¹³è§¦å‘çš„ API æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>

<ul>
<li><code>Reconcile</code> ä¼šè·³è¿‡ä¸­é—´è¿‡ç¨‹åœ¨ <code>Spec</code> ä¸­å£°æ˜çš„å€¼ï¼Œç›´æ¥ä½œç”¨äºå½“å‰ <code>Spec</code> ä¸­å£°æ˜çš„å€¼ã€‚</li>
<li>åœ¨è§¦å‘ <code>Reconcile</code> ä¹‹å‰ï¼Œæ§åˆ¶å™¨ä¼šå¹¶å‘å¤„ç†å¤šä¸ªäº‹ä»¶ï¼Œè€Œä¸æ˜¯ä¸²è¡Œå¤„ç†æ¯ä¸ªäº‹ä»¶ã€‚</li>
</ul>

<p>ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š</p>

<p><strong>ä¾‹ 1ï¼šå¹¶å‘å¤„ç†å¤šä¸ªäº‹ä»¶</strong></p>

<p>ç”¨æˆ·åˆ›å»ºäº† 1000 ä¸ªå‰¯æœ¬æ•°çš„ ReplicaSetï¼Œç„¶å ReplicaSet æ§åˆ¶å™¨ä¼šåˆ›å»º 1000 ä¸ª Podï¼Œå¹¶ç»´æŠ¤ ReplicaSet çš„ <code>Status</code> å­—æ®µã€‚åœ¨æ°´å¹³è§¦å‘ç³»ç»Ÿä¸­ï¼Œæ§åˆ¶å™¨ä¼šåœ¨è§¦å‘ <code>Reconcile</code> ä¹‹å‰å¹¶å‘æ›´æ–°æ‰€æœ‰ Podï¼ˆ<code>Reconcile</code> å‡½æ•°ä»…æ¥æ”¶å¯¹è±¡çš„ Namespace å’Œ Name ä½œä¸ºå‚æ•°ï¼‰ï¼Œåªéœ€è¦æ›´æ–° <code>Status</code> å­—æ®µ 1 æ¬¡ã€‚è€Œåœ¨è¾¹ç¼˜è§¦å‘ç³»ç»Ÿä¸­ï¼Œæ§åˆ¶å™¨ä¼šä¸²è¡Œå“åº”æ¯ä¸ª Pod äº‹ä»¶ï¼Œè¿™æ ·å°±ä¼šæ›´æ–° <code>Status</code> å­—æ®µ 1000 æ¬¡ã€‚</p>

<p><strong>ä¾‹ 2ï¼šè·³è¿‡ä¸­é—´çŠ¶æ€</strong></p>

<p>ç”¨æˆ·ä¿®æ”¹äº†æŸä¸ª Deployment çš„é•œåƒï¼Œç„¶åè¿›è¡Œå›æ»šã€‚åœ¨å›æ»šè¿‡ç¨‹ä¸­å‘ç°å®¹å™¨é™·å…¥ crash å¾ªç¯ï¼Œéœ€è¦å¢åŠ å†…å­˜é™åˆ¶ã€‚ç„¶åç”¨æˆ·æ›´æ–°äº† Deployment çš„å†…å®¹ï¼Œè°ƒæ•´å†…å­˜é™åˆ¶ï¼Œé‡æ–°å¼€å§‹å›æ»šã€‚åœ¨æ°´å¹³è§¦å‘ç³»ç»Ÿä¸­ï¼Œæ§åˆ¶å™¨ä¼šç«‹å³åœæ­¢ä¸Šä¸€æ¬¡å›æ»šåŠ¨ä½œï¼Œå¼€å§‹æ ¹æ®æœ€æ–°å€¼è¿›è¡Œå›æ»šã€‚è€Œåœ¨è¾¹ç¼˜è§¦å‘ç³»ç»Ÿä¸­ï¼Œæ§åˆ¶å™¨å¿…é¡»ç­‰ä¸Šä¸€æ¬¡å›æ»šæ“ä½œå®Œæˆæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡å›æ»šã€‚</p>

<h2 id="span-id-inline-toc-3-span-æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„"><span id="inline-toc">3.</span> æ§åˆ¶å™¨çš„å†…éƒ¨ç»“æ„</h2>

<hr />

<p>æ¯ä¸ªæ§åˆ¶å™¨å†…éƒ¨éƒ½æœ‰ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š<code>Informer/SharedInformer</code> å’Œ <code>Workqueue</code>ã€‚å…¶ä¸­ <code>Informer/SharedInformer</code> è´Ÿè´£ watch Kubernetes èµ„æºå¯¹è±¡çš„çŠ¶æ€å˜åŒ–ï¼Œç„¶åå°†ç›¸å…³äº‹ä»¶ï¼ˆevenetsï¼‰å‘é€åˆ° <code>Workqueue</code> ä¸­ï¼Œæœ€åå†ç”±æ§åˆ¶å™¨çš„ <code>worker</code> ä» <code>Workqueue</code> ä¸­å–å‡ºäº‹ä»¶äº¤ç»™æ§åˆ¶å™¨å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ã€‚</p>

<div class="notice note" >
<p class="first notice-title">æ³¨æ„</p><p><strong>äº‹ä»¶</strong> = <strong>åŠ¨ä½œ</strong>ï¼ˆcreate, update æˆ– deleteï¼‰ + <strong>èµ„æºçš„ key</strong>ï¼ˆä»¥ <code>namespace/name</code> çš„å½¢å¼è¡¨ç¤ºï¼‰</p></div>


<h3 id="informer">Informer</h3>

<p>æ§åˆ¶å™¨çš„ä¸»è¦ä½œç”¨æ˜¯ watch èµ„æºå¯¹è±¡çš„å½“å‰çŠ¶æ€å’ŒæœŸæœ›çŠ¶æ€ï¼Œç„¶åå‘é€æŒ‡ä»¤æ¥è°ƒæ•´å½“å‰çŠ¶æ€ï¼Œä½¿ä¹‹æ›´æ¥è¿‘æœŸæœ›çŠ¶æ€ã€‚<strong>ä¸ºäº†è·å¾—èµ„æºå¯¹è±¡å½“å‰çŠ¶æ€çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ§åˆ¶å™¨éœ€è¦å‘ API Server å‘é€è¯·æ±‚ã€‚</strong></p>

<p>ä½†é¢‘ç¹åœ°è°ƒç”¨ API Server éå¸¸æ¶ˆè€—é›†ç¾¤èµ„æºï¼Œå› æ­¤ä¸ºäº†èƒ½å¤Ÿå¤šæ¬¡ <code>get</code> å’Œ <code>list</code> å¯¹è±¡ï¼ŒKubernetes å¼€å‘äººå‘˜æœ€ç»ˆå†³å®šä½¿ç”¨ <code>client-go</code> åº“æä¾›çš„ç¼“å­˜æœºåˆ¶ã€‚æ§åˆ¶å™¨å¹¶ä¸éœ€è¦é¢‘ç¹è°ƒç”¨ API Serverï¼Œåªæœ‰å½“èµ„æºå¯¹è±¡è¢«åˆ›å»ºï¼Œä¿®æ”¹æˆ–åˆ é™¤æ—¶ï¼Œæ‰éœ€è¦è·å–ç›¸å…³äº‹ä»¶ã€‚<strong><code>client-go</code> åº“æä¾›äº† <code>Listwatcher</code> æ¥å£ç”¨æ¥è·å¾—æŸç§èµ„æºçš„å…¨éƒ¨ Objectï¼Œç¼“å­˜åœ¨å†…å­˜ä¸­ï¼›ç„¶åï¼Œè°ƒç”¨ Watch API å» watch è¿™ç§èµ„æºï¼Œå»ç»´æŠ¤è¿™ä»½ç¼“å­˜ï¼›æœ€åå°±ä¸å†è°ƒç”¨ Kubernetes çš„ä»»ä½• APIï¼š</strong></p>

<pre><code class="language-go">lw := cache.NewListWatchFromClient(
      client,
      &amp;v1.Pod{},
      api.NamespaceAll,
      fieldSelector)
</code></pre>

<p>ä¸Šé¢çš„è¿™äº›æ‰€æœ‰å·¥ä½œéƒ½æ˜¯åœ¨ <code>Informer</code> ä¸­å®Œæˆçš„ï¼ŒInformer çš„æ•°æ®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-go">store, controller := cache.NewInformer {
	&amp;cache.ListWatch{},
	&amp;v1.Pod{},
	resyncPeriod,
	cache.ResourceEventHandlerFuncs{},
</code></pre>

<p>å°½ç®¡ Informer è¿˜æ²¡æœ‰åœ¨ Kubernetes çš„ä»£ç ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼ˆç›®å‰ä¸»è¦ä½¿ç”¨ <code>SharedInformer</code>ï¼Œä¸‹æ–‡æˆ‘ä¼šè¯¦è¿°ï¼‰ï¼Œä½†å¦‚æœä½ æƒ³ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„æ§åˆ¶å™¨ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªå¿…ä¸å¯å°‘çš„æ¦‚å¿µã€‚</p>

<div class="notice note" >
<p class="first notice-title">æ³¨æ„</p><p>ä½ å¯ä»¥æŠŠ <code>Informer</code> ç†è§£ä¸º API Server ä¸æ§åˆ¶å™¨ä¹‹é—´çš„äº‹ä»¶ä»£ç†ï¼ŒæŠŠ <code>Workqueue</code> ç†è§£ä¸ºå­˜å‚¨äº‹ä»¶çš„æ•°æ®ç»“æ„ã€‚</p></div>


<p>ä¸‹é¢æ˜¯ç”¨äºæ„é€  Informer çš„ä¸‰ç§æ¨¡å¼ï¼š</p>

<h4 id="listwatcher">ListWatcher</h4>

<p><code>ListWatcher</code> æ˜¯å¯¹æŸä¸ªç‰¹å®šå‘½åç©ºé—´ä¸­æŸä¸ªç‰¹å®šèµ„æºçš„ <code>list</code> å’Œ <code>watch</code> å‡½æ•°çš„é›†åˆã€‚è¿™æ ·åšæœ‰åŠ©äºæ§åˆ¶å™¨åªä¸“æ³¨äºæŸç§ç‰¹å®šèµ„æºã€‚<code>fieldSelector</code> æ˜¯ä¸€ç§è¿‡æ»¤å™¨ï¼Œå®ƒç”¨æ¥ç¼©å°èµ„æºæœç´¢çš„èŒƒå›´ï¼Œè®©æ§åˆ¶å™¨åªæ£€ç´¢åŒ¹é…ç‰¹å®šå­—æ®µçš„èµ„æºã€‚Listwatcher çš„æ•°æ®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-go">cache.ListWatch {
	listFunc := func(options metav1.ListOptions) (runtime.Object, error) {
		return client.Get().
			Namespace(namespace).
			Resource(resource).
			VersionedParams(&amp;options, metav1.ParameterCodec).
			FieldsSelectorParam(fieldSelector).
			Do().
			Get()
	}
	watchFunc := func(options metav1.ListOptions) (watch.Interface, error) {
		options.Watch = true
		return client.Get().
			Namespace(namespace).
			Resource(resource).
			VersionedParams(&amp;options, metav1.ParameterCodec).
			FieldsSelectorParam(fieldSelector).
			Watch()
	}
}
</code></pre>

<h4 id="resource-event-handler">Resource Event Handler</h4>

<p><code>Resource Event Handler</code> ç”¨æ¥å¤„ç†ç›¸å…³èµ„æºå‘ç”Ÿå˜åŒ–çš„äº‹ä»¶ï¼š</p>

<pre><code class="language-go">type ResourceEventHandlerFuncs struct {
	AddFunc    func(obj interface{})
	UpdateFunc func(oldObj, newObj interface{})
	DeleteFunc func(obj interface{})
}
</code></pre>

<ul>
<li><strong>AddFunc</strong> : å½“èµ„æºåˆ›å»ºæ—¶è¢«è°ƒç”¨</li>
<li><strong>UpdateFunc</strong> : å½“å·²ç»å­˜åœ¨çš„èµ„æºè¢«ä¿®æ”¹æ—¶å°±ä¼šè°ƒç”¨ <code>UpdateFunc</code>ã€‚<code>oldObj</code> è¡¨ç¤ºèµ„æºçš„æœ€è¿‘ä¸€æ¬¡å·²çŸ¥çŠ¶æ€ã€‚å¦‚æœ Informer å‘ API Server é‡æ–°åŒæ­¥ï¼Œåˆ™ä¸ç®¡èµ„æºæœ‰æ²¡æœ‰å‘ç”Ÿæ›´æ”¹ï¼Œéƒ½ä¼šè°ƒç”¨ <code>UpdateFunc</code>ã€‚</li>
<li><strong>DeleteFunc</strong> : å½“å·²ç»å­˜åœ¨çš„èµ„æºè¢«åˆ é™¤æ—¶å°±ä¼šè°ƒç”¨ <code>DeleteFunc</code>ã€‚è¯¥å‡½æ•°ä¼šè·å–èµ„æºçš„æœ€è¿‘ä¸€æ¬¡å·²çŸ¥çŠ¶æ€ï¼Œå¦‚æœæ— æ³•è·å–ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹ä¸º <code>DeletedFinalStateUnknown</code> çš„å¯¹è±¡ã€‚</li>
</ul>

<h4 id="resyncperiod">ResyncPeriod</h4>

<p><code>ResyncPeriod</code> ç”¨æ¥è®¾ç½®æ§åˆ¶å™¨éå†ç¼“å­˜ä¸­çš„èµ„æºä»¥åŠæ‰§è¡Œ <code>UpdateFunc</code> çš„é¢‘ç‡ã€‚è¿™æ ·åšå¯ä»¥å‘¨æœŸæ€§åœ°éªŒè¯èµ„æºçš„å½“å‰çŠ¶æ€æ˜¯å¦ä¸æœŸæœ›çŠ¶æ€åŒ¹é…ã€‚</p>

<p>å¦‚æœæ§åˆ¶å™¨é”™è¿‡äº† update æ“ä½œæˆ–è€…ä¸Šä¸€æ¬¡æ“ä½œå¤±è´¥äº†ï¼Œ<code>ResyncPeriod</code> å°†ä¼šèµ·åˆ°å¾ˆå¤§çš„å¼¥è¡¥ä½œç”¨ã€‚å¦‚æœä½ æƒ³ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œä¸è¦æŠŠå‘¨æœŸè®¾ç½®å¤ªçŸ­ï¼Œå¦åˆ™ç³»ç»Ÿè´Ÿè½½ä¼šéå¸¸é«˜ã€‚</p>

<h3 id="sharedinformer">SharedInformer</h3>

<p>é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼ŒInformer ä¼šå°†èµ„æºç¼“å­˜åœ¨æœ¬åœ°ä»¥ä¾›è‡ªå·±åç»­ä½¿ç”¨ã€‚ä½† Kubernetes ä¸­è¿è¡Œäº†å¾ˆå¤šæ§åˆ¶å™¨ï¼Œæœ‰å¾ˆå¤šèµ„æºéœ€è¦ç®¡ç†ï¼Œéš¾å…ä¼šå‡ºç°ä»¥ä¸‹è¿™ç§é‡å çš„æƒ…å†µï¼šä¸€ä¸ªèµ„æºå—åˆ°å¤šä¸ªæ§åˆ¶å™¨ç®¡ç†ã€‚</p>

<p>ä¸ºäº†åº”å¯¹è¿™ç§åœºæ™¯ï¼Œå¯ä»¥é€šè¿‡ <code>SharedInformer</code> æ¥åˆ›å»ºä¸€ä»½ä¾›å¤šä¸ªæ§åˆ¶å™¨å…±äº«çš„ç¼“å­˜ã€‚è¿™æ ·å°±ä¸éœ€è¦å†é‡å¤ç¼“å­˜èµ„æºï¼Œä¹Ÿå‡å°‘äº†ç³»ç»Ÿçš„å†…å­˜å¼€é”€ã€‚ä½¿ç”¨äº† <code>SharedInformer</code> ä¹‹åï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªæ§åˆ¶å™¨åŒæ—¶è¯»å–äº‹ä»¶ï¼Œ<code>SharedInformer</code> åªä¼šè°ƒç”¨ä¸€ä¸ª Watch API æ¥ watch ä¸Šæ¸¸çš„ API Serverï¼Œå¤§å¤§é™ä½äº† API Server çš„è´Ÿè½½ã€‚å®é™…ä¸Š <code>kube-controller-manager</code> å°±æ˜¯è¿™ä¹ˆå·¥ä½œçš„ã€‚</p>

<p><code>SharedInformer</code> æä¾› hooks æ¥æ¥æ”¶æ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤æŸä¸ªèµ„æºçš„äº‹ä»¶é€šçŸ¥ã€‚è¿˜æä¾›äº†ç›¸å…³å‡½æ•°ç”¨äºè®¿é—®å…±äº«ç¼“å­˜å¹¶ç¡®å®šä½•æ—¶å¯ç”¨ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸ API Server çš„è¿æ¥æ¬¡æ•°ï¼Œé™ä½ API Server çš„é‡å¤åºåˆ—åŒ–æˆæœ¬å’Œæ§åˆ¶å™¨çš„é‡å¤ååºåˆ—åŒ–æˆæœ¬ã€‚</p>

<pre><code class="language-go">lw := cache.NewListWatchFromClient(â€¦)
sharedInformer := cache.NewSharedInformer(lw, &amp;api.Pod{}, resyncPeriod)
</code></pre>

<h3 id="workqueue">Workqueue</h3>

<p>ç”±äº <code>SharedInformer</code> æä¾›çš„ç¼“å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒæ— æ³•è·Ÿè¸ªæ¯ä¸ªæ§åˆ¶å™¨ï¼Œè¿™å°±éœ€è¦æ§åˆ¶å™¨è‡ªå·±å®ç°æ’é˜Ÿå’Œé‡è¯•æœºåˆ¶ã€‚å› æ­¤ï¼Œå¤§å¤šæ•° <code>Resource Event Handler</code> æ‰€åšçš„å·¥ä½œåªæ˜¯å°†äº‹ä»¶æ”¾å…¥æ¶ˆè´¹è€…å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚</p>

<p>æ¯å½“èµ„æºè¢«ä¿®æ”¹æ—¶ï¼Œ<code>Resource Event Handler</code> å°±ä¼šæ”¾å…¥ä¸€ä¸ª key åˆ° <code>Workqueue</code> ä¸­ã€‚key çš„è¡¨ç¤ºå½¢å¼ä¸º <code>&lt;resource_namespace&gt;/&lt;resource_name&gt;</code>ï¼Œå¦‚æœæä¾›äº† <code>&lt;resource_namespace&gt;</code>ï¼Œkey çš„è¡¨ç¤ºå½¢å¼å°±æ˜¯ <code>&lt;resource_name&gt;</code>ã€‚æ¯ä¸ªäº‹ä»¶éƒ½ä»¥ key ä½œä¸ºæ ‡è¯†ï¼Œå› æ­¤æ¯ä¸ªæ¶ˆè´¹è€…ï¼ˆæ§åˆ¶å™¨ï¼‰éƒ½å¯ä»¥ä½¿ç”¨ workers ä» Workqueue ä¸­è¯»å– keyã€‚æ‰€æœ‰çš„è¯»å–åŠ¨ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œè¿™å°±ä¿è¯äº†ä¸ä¼šå‡ºç°ä¸¤ä¸ª worker åŒæ—¶è¯»å–åŒä¸€ä¸ª key çš„æƒ…å†µã€‚</p>

<p><code>Workqueue</code> åœ¨ <a href="https://github.com/kubernetes/client-go" target="_blank">client-go</a> åº“ä¸­çš„ä½ç½®ä¸º <code>client-go/util/workqueue</code>ï¼Œæ”¯æŒçš„é˜Ÿåˆ—ç±»å‹åŒ…æ‹¬å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå®šæ—¶é˜Ÿåˆ—å’Œé€Ÿç‡é™åˆ¶é˜Ÿåˆ—ã€‚ä¸‹é¢æ˜¯é€Ÿç‡é™åˆ¶é˜Ÿåˆ—çš„ä¸€ä¸ªç¤ºä¾‹ï¼š</p>

<pre><code class="language-go">queue :=
workqueue.NewRateLimitingQueue(workqueue.DefaultControllerRateLimiter())
</code></pre>

<p><code>Workqueue</code> æä¾›äº†å¾ˆå¤šå‡½æ•°æ¥å¤„ç† keyï¼Œæ¯ä¸ª key åœ¨ <code>Workqueue</code> ä¸­çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>


<link rel="stylesheet" href="https://fuckcloudnative.io/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/post_loading.gif" data-original="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/eENdLY.jpg" alt="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/eENdLY.jpg"/>
    </div>
    <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/eENdLY.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>å¦‚æœå¤„ç†äº‹ä»¶å¤±è´¥ï¼Œæ§åˆ¶å™¨å°±ä¼šè°ƒç”¨ <code>AddRateLimited()</code> å‡½æ•°å°†äº‹ä»¶çš„ key æ”¾å› <code>Workqueue</code> ä»¥ä¾›åç»­é‡è¯•ï¼ˆå¦‚æœé‡è¯•æ¬¡æ•°æ²¡æœ‰è¾¾åˆ°ä¸Šé™ï¼‰ã€‚å¦‚æœå¤„ç†æˆåŠŸï¼Œæ§åˆ¶å™¨å°±ä¼šè°ƒç”¨ <code>Forget()</code> å‡½æ•°å°†äº‹ä»¶çš„ key ä» <code>Workqueue</code> ä¸­ç§»é™¤ã€‚<strong>æ³¨æ„ï¼šè¯¥å‡½æ•°ä»…ä»…åªæ˜¯è®© <code>Workqueue</code> åœæ­¢è·Ÿè¸ªäº‹ä»¶å†å²ï¼Œå¦‚æœæƒ³ä» <code>Workqueue</code> ä¸­å®Œå…¨ç§»é™¤äº‹ä»¶ï¼Œéœ€è¦è°ƒç”¨ <code>Done()</code> å‡½æ•°ã€‚</strong></p>

<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œ<code>Workqueue</code> å¯ä»¥å¤„ç†æ¥è‡ªç¼“å­˜çš„äº‹ä»¶é€šçŸ¥ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<strong>æ§åˆ¶å™¨åº”è¯¥ä½•æ—¶å¯ç”¨ workers æ¥å¤„ç† <code>Workqueue</code> ä¸­çš„äº‹ä»¶å‘¢ï¼Ÿ</strong></p>

<p>æ§åˆ¶å™¨éœ€è¦ç­‰åˆ°ç¼“å­˜å®Œå…¨åŒæ­¥åˆ°æœ€æ–°çŠ¶æ€æ‰èƒ½å¼€å§‹å¤„ç† <code>Workqueue</code> ä¸­çš„äº‹ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>

<ol>
<li>åœ¨ç¼“å­˜å®Œå…¨åŒæ­¥ä¹‹å‰ï¼Œè·å–çš„èµ„æºä¿¡æ¯æ˜¯ä¸å‡†ç¡®çš„ã€‚</li>
<li>å¯¹å•ä¸ªèµ„æºçš„å¤šæ¬¡å¿«é€Ÿæ›´æ–°å°†ç”±ç¼“å­˜åˆå¹¶åˆ°æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤æ§åˆ¶å™¨å¿…é¡»ç­‰åˆ°ç¼“å­˜å˜ä¸ºç©ºé—²çŠ¶æ€æ‰èƒ½å¼€å§‹å¤„ç†äº‹ä»¶ï¼Œä¸ç„¶åªä¼šæŠŠæ—¶é—´æµªè´¹åœ¨ç­‰å¾…ä¸Šã€‚</li>
</ol>

<p>è¿™ç§åšæ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-go">controller.informer = cache.NewSharedInformer(...)
controller.queue = workqueue.NewRateLimitingQueue(workqueue.DefaultControllerRateLimiter())

controller.informer.Run(stopCh)

if !cache.WaitForCacheSync(stopCh, controller.HasSynched)
{
	log.Errorf(&quot;Timed out waiting for caches to sync&quot;))
}

// Now start processing
controller.runWorker()
</code></pre>

<p>æ‰€æœ‰å¤„ç†æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/post_loading.gif" data-original="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-29-033816.jpg" alt="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-29-033816.jpg"/>
    </div>
    <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-29-033816.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<p><center><p id=small>æ§åˆ¶å™¨å¤„ç†äº‹ä»¶çš„æµç¨‹</p></center></p>

<h2 id="span-id-inline-toc-4-span-å‚è€ƒèµ„æ–™"><span id="inline-toc">4.</span> å‚è€ƒèµ„æ–™</h2>

<hr />

<ul>
<li><a href="https://engineering.bitnami.com/articles/a-deep-dive-into-kubernetes-controllers.html" target="_blank">A Deep Dive Into Kubernetes Controllers</a></li>
</ul>
         
	 
	 <br />
	 <div style="text-align:center;color: #ccc;font-size:16px;font-family: cursive;">-------ä»–æ—¥æ±Ÿæ¹–ç›¸é€¢ <i class="fa fa-umbrella" style="color:#986dbd"></i> å†å½“æ¯é…’è¨€æ¬¢-------</div>
         
           

<div class="entry-shang text-center">
	<p>ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</p>
        <button class="zs show-zs btn rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"> <span>èµ</span> </button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">Ã—</button>
		<span class="author"><img src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg"/>ç±³å¼€æœ—åŸºæ¨</span>
		<p class="tip"><i></i><span>çœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™</span></p>
 	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2å…ƒ</button>
			<button class="btn btn-blink" data-num="5">5å…ƒ</button>
			<button class="btn btn-blink" data-num="10">10å…ƒ</button>
			<button class="btn btn-blink" data-num="50">50å…ƒ</button>
			<button class="btn btn-blink" data-num="100">100å…ƒ</button>
			<button class="btn btn-blink" data-num="1">ä»»æ„é‡‘é¢</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2å…ƒ</button>
			<p>ä½¿ç”¨<span id="pay-type">å¾®ä¿¡</span>æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
			<img src="/img/wechat-2.png" id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
                <span class="zs-wechat"><img src="/img/wechat-btn.png"/></span>
	</div>
</div>

         

        
          <div class="blog-tags">
            
              <a href="https://fuckcloudnative.io/tags/kubernetes/"><i class="fa fa-tags"></i>kubernetes</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
	      <a href="//service.weibo.com/share/share.php?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fa-deep-dive-into-kubernetes-controllers%2f&amp;title=Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e8%a7%a3%e8%af%bb&amp;pic=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2f1_dmfykjhuLG8NZDliNetoQQ.jpeg" target="_blank" title="åˆ†äº«åˆ°å¾®åš">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
      
      <li>
	      <a href="//connect.qq.com/widget/shareqq/index.html?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fa-deep-dive-into-kubernetes-controllers%2f&amp;title=Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e8%a7%a3%e8%af%bb&amp;source=Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e8%a7%a3%e8%af%bb&amp;desc=%e6%9c%ac%e6%96%87%e6%88%91%e5%b0%86%e4%bc%9a%e5%b8%a6%e4%bd%a0%e6%b7%b1%e5%85%a5%e4%ba%86%e8%a7%a3%20Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%86%85%e9%83%a8%e7%bb%93%e6%9e%84%e3%80%81%e5%9f%ba%e6%9c%ac%e7%bb%84%e4%bb%b6%e4%bb%a5%e5%8f%8a%e5%ae%83%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e3%80%82&amp;pics=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2f1_dmfykjhuLG8NZDliNetoQQ.jpeg&amp;summary=%e6%9c%ac%e6%96%87%e6%88%91%e5%b0%86%e4%bc%9a%e5%b8%a6%e4%bd%a0%e6%b7%b1%e5%85%a5%e4%ba%86%e8%a7%a3%20Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%86%85%e9%83%a8%e7%bb%93%e6%9e%84%e3%80%81%e5%9f%ba%e6%9c%ac%e7%bb%84%e4%bb%b6%e4%bb%a5%e5%8f%8a%e5%ae%83%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e3%80%82" target="_blank" title="åˆ†äº«åˆ° QQ">
          <i class="fab fa-qq"></i>
        </a>
      </li>
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fa-deep-dive-into-kubernetes-controllers%2f&amp;text=Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e8%a7%a3%e8%af%bb&amp;via=RyangYang1" target="_blank" title="åˆ†äº«åˆ° Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffuckcloudnative.io%2fposts%2fa-deep-dive-into-kubernetes-controllers%2f" target="_blank" title="åˆ†äº«åˆ° Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
	      <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fa-deep-dive-into-kubernetes-controllers%2f&amp;title=Kubernetes%20%e6%8e%a7%e5%88%b6%e5%99%a8%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%e8%a7%a3%e8%af%bb" target="_blank" title="åˆ†äº«åˆ° LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">ç›¸å…³æ¨è</h4>
                  <ul>
                
                
                    <li><a href="/posts/sealos/">kubernetes é«˜å¯ç”¨éƒ¨ç½²å·¥å…·ï¼šsealos</a></li>
                
                    <li><a href="/posts/what-happens-when-k8s/">kubectl åˆ›å»º Pod èƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li>
                
                    <li><a href="/posts/istio-1.3-tour/">æ‰‹æŠŠæ‰‹æ•™ä½ éƒ¨ç½² Istio 1.3</a></li>
                
                    <li><a href="/posts/kubesphere/">KubeSphere å®‰è£…æ•™ç¨‹</a></li>
                
                    <li><a href="/posts/istio-1.3/">Istio 1.3 å‘å¸ƒï¼ŒHTTP é¥æµ‹ä¸å†éœ€è¦ Mixer</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fuckcloudnative.io/posts/matrix-multiplication/" data-toggle="tooltip" data-placement="top" title="ç†è§£çŸ©é˜µä¹˜æ³•">&larr; å‰ä¸€ç¯‡</a>
            </li>
          
          
            <li class="next">
              <a href="https://fuckcloudnative.io/posts/netwnetwork-virtualization-macvlan/" data-toggle="tooltip" data-placement="top" title="Linux è™šæ‹Ÿç½‘å¡æŠ€æœ¯ï¼šMacvlan">åä¸€ç¯‡ &rarr;</a>
            </li>
          
        </ul>
      

      
	    <link rel="stylesheet" href="https://fuckcloudnative.io/css/iDisqus.min.css" />
<div id="comment"></div>
<script src="https://fuckcloudnative.io/js/iDisqus.min.js"></script>
<script>
var disq = new iDisqus('comment', {
    forum: 'fuckcloudnative',
    api: 'https://disqus.fuckcloudnative.io',
    site: 'http://fuckcloudnative.io',
    emojiPath: 'https://api.fooleap.org/emoji/unicode/',
    mode: 2,
    timeout: 15,
    init: true
});
</script>

      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:yangchuansheng33@gmail.com" target="_blank" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-13-%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E6%A8%AA%E7%89%88%E4%BA%8C%E7%BB%B4%E7%A0%81_2019.05.17.1.1.png" target="_blank" title="Weixin">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/yangchuansheng" target="_blank" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/RyangYang1" target="_blank" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/yang-ryan-b6659b106" target="_blank" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://weibo.com/3496206342" target="_blank" title="å¾®åš">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://drive.google.com/drive/folders/0By_W-zIhlMXqSGJyU3pHaVVpV2M" target="_blank" title="è§†é¢‘åˆ†äº«">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-google-drive fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://fuckcloudnative.io/index.xml" target="_blank" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
	<br />
        <p class="credits copyright text-muted">
	  &nbsp;&bull;&nbsp;&copy;2019
          
            
              <a href="https://fuckcloudnative.io">ç±³å¼€æœ—åŸºæ¨</a>
            
          

          &nbsp;&bull;&nbsp;æ›´æ–°äº
          
            2019 å¹´ 11 æœˆ 17 æ—¥
          

	  &nbsp;&bull;&nbsp;
          <a href="https://fuckcloudnative.io/tags/">æ‰€æœ‰æ–‡ç« </a>

	  
        </p>
        <p class="credits theme-by text-muted">
        <br />
        <span id="busuanzi_container_site_pv">
            æœ¬ç«™å·²è¢«è®¿é—® <span id="busuanzi_value_site_pv"></span> æ¬¡å•¦
        </span>
        <span id="busuanzi_container_site_uv">
            &ensp;|&ensp;&thinsp;æ‚¨æ˜¯ç¬¬ <span id="busuanzi_value_site_uv"></span> ä½åˆ°è®¿çš„å°ä¼™ä¼´
        </span>
        </p>
        
        <p class="credits theme-by text-muted">
          ç”± <a href="https://gohugo.io">Hugo v0.59.0</a> å¼ºåŠ›é©±åŠ¨ &nbsp;&bull;&nbsp; ä¸»é¢˜ <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> ç§»æ¤è‡ª <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
	  <section class="credits theme-by text-muted" align="center">
    <span class="footer__copyright">
    <div>
    <span id="span_dt_dt"> </span>
    <script language="javascript">
      function show_date_time(){
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date("7/8/2017 10:56:12");
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span_dt_dt.innerHTML="æœ¬ç«™å·²ç»å¼€å¿ƒè¿è¡Œ "+daysold+" å¤© "+hrsold+" å°æ—¶ "+minsold+" åˆ† "+seconds+" ç§’";
      }
      show_date_time();
    </script>
    </div>
</script>
</section>

	</p>
      </div>
    </div>
  </div>
</footer>

<script src='/js/bundle.min.13b2d74fbe48bdf362a1e1572571a00fa30ef02c3fa8f697c71a47c9462a759a.js' integrity='sha256-E7LXT75IvfNioeFXJXGgD6MO8Cw/qPaXxxpHyUYqdZo='></script>






<script src="https://fuckcloudnative.io/js/load-photoswipe.js"></script>







<div class="rocket"><img src="/img/rocket_up.png" alt="" width="100" height="100"></div>
<script>
    $(function () {
      $(window).scroll(function () {
        
        if ($(window).scrollTop() >= 1000) {
          $('.rocket').stop().fadeIn(1000);
        }else {
          $('.rocket').stop().fadeOut(1000);
        }
      })
      
      $('.rocket').click(function () {
        $('html,body').stop().animate({scrollTop:0},400);
       
      })
    })

</script>




<script type="text/javascript">
      jQuery(function() {
          jQuery("img").lazyload({threshold: 0,effect: "fadeIn"});
      });
</script>











<script type="text/javascript">
$(document).ready(function () {
  $(window).scroll(function(){
    $(".top-scroll-bar").attr("style", "width: " + ($(this).scrollTop() / ($(document).height() - $(this).height()) * 100) + "%; display: block;");
  });
})
</script>


<script type="text/javascript">
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("Docker", "Kubernetes", "Prometheus", "Envoy", "Istio", "coredns", "Service Mesh", "Cloud Native");
        var $i = $("<span />").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        function randomColor() {
          var flakeColor = new Array("#FFDA65", "#00BFFF", "#BA55D3", "#FFA07A", "#87CEEB", "#FFB6C1");
          var snowColor = flakeColor[Math.floor(flakeColor.length * Math.random())];
          return snowColor;
        }
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": randomColor()
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>


    
  </body>
</html>

