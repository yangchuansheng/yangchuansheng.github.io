<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Istio 1.4 部署指南 - Kubernetes|Docker|Istio|Envoy|Hugo|Golang|云原生</title>


  <meta content="米开朗基杨, istio, istio cni, critical pod" name="keywords">

  <meta name="description" content="本文将会告诉你如何使用 istioctl 部署 istio 1.4，并开启 istio CNI 插件。">
  <meta name="author" content="米开朗基杨"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "云原生实验室",
    
    "url": "https:\/\/fuckcloudnative.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fuckcloudnative.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io\/posts\/istio-deploy\/",
          "name": "Istio 1.4 部署指南"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "米开朗基杨"
  },
  "headline": "Istio 1.4 部署指南",
  "description" : "本文将会告诉你如何使用 istioctl 部署 istio 1.4，并开启 istio CNI 插件。",
  "inLanguage" : "zh",
  "wordCount":  2436 ,
  "datePublished" : "2019-12-15T00:14:06",
  "dateModified" : "2019-12-15T00:14:06",
  "image" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
  "keywords" : [ "istio, service mesh" ],
  "mainEntityOfPage" : "https:\/\/fuckcloudnative.io\/posts\/istio-deploy\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fuckcloudnative.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Istio 1.4 部署指南" />
<meta property="og:description" content="本文将会告诉你如何使用 istioctl 部署 istio 1.4，并开启 istio CNI 插件。">
<meta property="og:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
<meta property="og:url" content="https://fuckcloudnative.io/posts/istio-deploy/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="云原生实验室" />

  <meta name="twitter:title" content="Istio 1.4 部署指南" />
  <meta name="twitter:description" content="本文将会告诉你如何使用 istioctl 部署 istio 1.4，并开启 istio CNI 插件。">
  <meta name="twitter:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@RyangYang1" />
  <meta name="twitter:creator" content="@RyangYang1" />

  <link href='https://hugo-picture.oss-cn-beijing.aliyuncs.com/favicon-32x32.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.59.0" />
  <link rel="alternate" href="https://fuckcloudnative.io/index.xml" type="application/rss+xml" title="云原生实验室">
  
  
  
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet">
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">


<link rel="stylesheet" href='/css/bundle.min.f389e6be7cecef1da8fb771dfe9c801a88dc7f2f87660bd530c4f14216846f94.css' integrity='sha256-84nmvnzs7x2o&#43;3cd/pyAGojcfy&#43;HZgvVMMTxQhaEb5Q='>





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?efe96f04908ae320df234a4f5626879e";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script src="https://fuckcloudnative.io/js/pace.min.js"></script>



<script src="https://fuckcloudnative.io/js/busuanzi.pure.mini.js"></script>
<script>
var int = setInterval(fixCount, 50);
function fixCount() {
    if (document.getElementById('busuanzi_container_site_uv').ownerDocument.defaultView.getComputedStyle(document.getElementById('busuanzi_container_site_uv'), null).display === 'inline') {
        clearInterval(int);
        document.getElementById('busuanzi_value_site_uv') = parseInt(document.getElementById('busuanzi_value_site_uv').innerHTML) + parseInt('100000');
    }
}
</script>







    <div class="top-scroll-bar"></div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-145022311-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="https://fuckcloudnative.io">🐳 > $ cd /home/</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-dharmachakra fa-spin" style="color:#986dbd"></i> 文章分类</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes/">kubernetes</a>
                
                  <a href="/categories/monitoring/">监控</a>
                
                  <a href="/categories/service-mesh/">Service Mesh</a>
                
                  <a href="/categories/devops/">DevOps</a>
                
                  <a href="/categories/docker/">Docker</a>
                
                  <a href="/categories/linux/">Linux</a>
                
                  <a href="/categories/python/">Python</a>
                
                  <a href="/categories/network/">网络</a>
                
                  <a href="/categories/loadbalance/"> 负载均衡</a>
                
                  <a href="/categories/gfw/">科学上网</a>
                
                  <a href="/categories/math/">数学</a>
                
                  <a href="/categories/share/">黑科技</a>
                
                  <a href="/categories/hugo/">Hugo</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fab fa-docker"></i> 电子书</a>
              <div class="navlinks-children">
                
                  <a href="/prometheus-handbook/">Prometheus 中文文档</a>
                
                  <a href="/talent-is-overrated/">天才源自刻意练习</a>
                
                  <a href="/the-way-to-go/">Go 入门指南</a>
                
                  <a href="https://github.com/fengdu78/Coursera-ML-AndrewNg-Notes">机器学习笔记</a>
                
                  <a href="https://github.com/ruanyf/reading-list">阮一峰书单</a>
                
                  <a href="https://istio.io/zh/docs">Istio service mesh</a>
                
                  <a href="https://www.gitbook.com/book/yeasy/docker_practice">Docker handbook</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-book"></i> 葵花宝典</a>
              <div class="navlinks-children">
                
                  <a href="/learn-english/"> 英语学习终极秘诀</a>
                
                  <a href="/a-day-in-the-life-of-jeff/">A Day in the life of Jeff</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"> 😱福利</a>
              <div class="navlinks-children">
                
                  <a href="https://bt.fuckcloudnative.io">种子搜索</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Rss 订阅" href="/index.xml">Rss 订阅</a>
            </li>
          
        

        

        
        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">搜索</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="云原生实验室" href="https://fuckcloudnative.io">
            <img class="avatar-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" alt="云原生实验室" />
          </a>
        </div>
      </div>
    

  </div>
</nav>





  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search fuckcloudnative.io</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>


<script src="https://fuckcloudnative.io/js/algoliasearch.min.js"></script>
<script src="https://fuckcloudnative.io/js/autocomplete.min.js"></script>


<script>
var client = algoliasearch("4BELQK2TOI", "62fd06bd949abb4211bfab0aa288f67b");
var index = client.initIndex('blog');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            
            return '<span>' + '<a href="/' + suggestion.uri+ '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>


    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1 
      
         
          data-img-src-1="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-04-27-080627.jpg" 
         
         
      ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
		  
		      <h1 align="center">Istio 1.4 部署指南</h1>
		  
                  
                    
		      <hr class="small">
                      <h2 class="post-subheading">使用 Istio CNI Plugin 来转发流量</h2>
                    
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;发表于 2019 年 12 月 15 日
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;分钟
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2436&nbsp;个字
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>次阅读
  
</span>

                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Istio 1.4 部署指南</h1>
              
              
              
                
                  <h2 class="post-subheading">使用 Istio CNI Plugin 来转发流量</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;发表于 2019 年 12 月 15 日
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;分钟
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2436&nbsp;个字
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>次阅读
  
</span>

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div id="container" class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <a title="搬瓦工" href="https://bandwagonhost.com/aff.php?aff=54207" target="_blank">
<p id="sponsor-text" style="box-sizing: border-box;
    text-align: center;
    width: 100%;
    border: 1px solid #e5e4e9;
    background-color: #d0e4a9;
    margin: 1em 0 0;
    padding: 0.6em 0.6em 0.4em 0.6em;
    border-radius: 0.3em 0.3em 0.1em 0.1em;
    color: #076a66;"><span style="text-decoration: underline;">搬瓦工</span>香港 VPS CN2，超低价 <span style="text-decoration: underline;">$2.99/年</span>起。适合新手入门建站，我的博客就是在这上面搭建的</p>
<p style="padding:0em;margin:0 0 1.5em 0;border: 1px solid #e5e4e9;border-radius: 0.1em 0.1em 0.3em 0.3em;background-color: #28344a;text-align: center;" class="entry-sponsor-img">
  <img alt="搬瓦工" id="support-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/bandwagonhost.jpg" style="border: none;width: 100%;max-width: 100%;display: inline-block;">

</p>
</a>

      <article role="main" class="blog-post">
	
<aside class="toc">
    <div id='anchors-navbar'>
        <i class='fa fa-anchor'></i>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-id-inline-toc-1-span-kubernetes-环境准备"><span id="inline-toc">1.</span> Kubernetes 环境准备</a>
<ul>
<li><a href="#前提条件">前提条件</a></li>
<li><a href="#安装-kubernetes-集群">安装 kubernetes 集群</a></li>
</ul></li>
<li><a href="#span-id-inline-toc-2-span-下载-istio-部署文件"><span id="inline-toc">2.</span> 下载 Istio 部署文件</a>
<ul>
<li><a href="#开启-istioctl-的自动补全功能">开启 istioctl 的自动补全功能</a>
<ul>
<li><a href="#bash">bash</a></li>
<li><a href="#zsh">zsh</a></li>
</ul></li>
</ul></li>
<li><a href="#span-id-inline-toc-3-span-部署-istio"><span id="inline-toc">3.</span> 部署 Istio</a>
<ul>
<li><a href="#istio-cni-plugin">Istio CNI Plugin</a></li>
<li><a href="#kubernetes-关键插件-critical-add-on-pods">Kubernetes 关键插件（Critical Add-On Pods）</a></li>
</ul></li>
<li><a href="#span-id-inline-toc-4-span-暴露-dashboard"><span id="inline-toc">4.</span> 暴露 Dashboard</a></li>
<li><a href="#span-id-inline-toc-5-span-暴露-gateway"><span id="inline-toc">5.</span> 暴露 Gateway</a></li>
</ul></li>
</ul>
</nav>
    </div>
    
</aside>


        
         

         
           

<p>Istio 一直处于快速迭代更新的过程中，它的部署方法也在不断更新，之前我在 1.0 版本中介绍的安装方法，对于最新的 1.4 版本已经不适用了。以后主流的部署方式都是用 istioctl 进行部署，helm 可以渐渐靠边站了~~</p>

<p>在部署 Istio 之前，首先需要确保 Kubernetes 集群（kubernetes 版本建议在 <code>1.13</code> 以上）已部署并配置好本地的 kubectl 客户端。</p>

<h2 id="span-id-inline-toc-1-span-kubernetes-环境准备"><span id="inline-toc">1.</span> Kubernetes 环境准备</h2>

<p>为了快速准备 kubernetes 环境，我们可以使用 sealos 来部署，步骤如下：</p>

<h3 id="前提条件">前提条件</h3>

<ul>
<li>下载<a href="http://store.lameleg.com/" target="_blank">kubernetes 离线安装包</a></li>
<li>下载<a href="https://github.com/fanux/sealos/releases" target="_blank">最新版本sealos</a></li>
<li>务必同步服务器时间</li>
<li>主机名不可重复</li>
</ul>

<h3 id="安装-kubernetes-集群">安装 kubernetes 集群</h3>

<pre><code class="language-bash">$ sealos init --master 192.168.0.2 \
    --node 192.168.0.3 \
    --node 192.168.0.4 \
    --node 192.168.0.5 \
    --user root \
    --passwd your-server-password \
    --version v1.16.3 \
    --pkg-url /root/kube1.16.3.tar.gz 
</code></pre>

<p>检查安装是否正常：</p>

<pre><code class="language-bash">$ kubectl get node

NAME       STATUS   ROLES    AGE   VERSION
sealos01   Ready    master   18h   v1.16.3
sealos02   Ready    &lt;none&gt;   18h   v1.16.3
sealos03   Ready    &lt;none&gt;   18h   v1.16.3
sealos04   Ready    &lt;none&gt;   18h   v1.16.3
</code></pre>

<h2 id="span-id-inline-toc-2-span-下载-istio-部署文件"><span id="inline-toc">2.</span> 下载 Istio 部署文件</h2>

<p>你可以从 GitHub 的 <a href="https://github.com/istio/istio/releases/tag/1.4.2" target="_blank">release</a> 页面下载 istio，或者直接通过下面的命令下载：</p>

<pre><code class="language-bash">$ curl -L https://istio.io/downloadIstio | sh -
</code></pre>

<p>下载完成后会得到一个 <code>istio-1.4.2</code> 目录，里面包含了：</p>

<ul>
<li><code>install/kubernetes</code> : 针对 Kubernetes 平台的安装文件</li>
<li><code>samples</code> : 示例应用</li>
<li><code>bin</code> : istioctl 二进制文件，可以用来手动注入 sidecar proxy</li>
</ul>

<p>进入 <code>istio-1.4.2</code> 目录。</p>

<pre><code class="language-bash">$ cd istio-1.4.2

$ tree -L 1 ./
./
├── bin
├── demo.yaml
├── install
├── LICENSE
├── manifest.yaml
├── README.md
├── samples
└── tools

4 directories, 4 files
</code></pre>

<p>将 istioctl 拷贝到 <code>/usr/local/bin/</code> 中：</p>

<pre><code class="language-bash">$ cp bin/istioctl /usr/local/bin/
</code></pre>

<h3 id="开启-istioctl-的自动补全功能">开启 istioctl 的自动补全功能</h3>

<h4 id="bash">bash</h4>

<p>将 <code>tools</code> 目录中的 <code>istioctl.bash</code> 拷贝到 $HOME 目录中：</p>

<pre><code class="language-bash">$ cp tools/istioctl.bash ~/
</code></pre>

<p>在 <code>~/.bashrc</code> 中添加一行：</p>

<pre><code class="language-bash">source ~/istioctl.bash
</code></pre>

<p>应用生效：</p>

<pre><code class="language-bash">$ source ~/.bashrc
</code></pre>

<h4 id="zsh">zsh</h4>

<p>将 <code>tools</code> 目录中的 <code>_istioctl</code> 拷贝到 $HOME 目录中：</p>

<pre><code class="language-bash">$ cp tools/_istioctl ~/
</code></pre>

<p>在 <code>~/.zshrc</code> 中添加一行：</p>

<pre><code class="language-bash">source ~/_istioctl
</code></pre>

<p>应用生效：</p>

<pre><code class="language-bash">$ source ~/.zshrc
</code></pre>

<h2 id="span-id-inline-toc-3-span-部署-istio"><span id="inline-toc">3.</span> 部署 Istio</h2>

<p>istioctl 提供了多种安装配置文件，可以通过下面的命令查看：</p>

<pre><code class="language-bash">$ istioctl profile list

Istio configuration profiles:
    minimal
    remote
    sds
    default
    demo
</code></pre>

<p>它们之间的差异如下：</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="left">default</th>
<th align="left">demo</th>
<th align="left">minimal</th>
<th align="left">sds</th>
<th align="left">remote</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center"><strong>核心组件</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-citadel</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
</tr>

<tr>
<td align="center">istio-egressgateway</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-galley</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-ingressgateway</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-nodeagent</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-pilot</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-policy</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-sidecar-injector</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
</tr>

<tr>
<td align="center">istio-telemetry</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center"><strong>附加组件</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">Grafana</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-tracing</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">kiali</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">prometheus</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>
</tbody>
</table>

<p>其中标记 <strong>X</strong> 表示该安装该组件。</p>

<p>如果只是想快速试用并体验完整的功能，可以直接使用配置文件 <code>demo</code> 来部署。</p>

<p>在正式部署之前，需要先说明两点：</p>

<h3 id="istio-cni-plugin">Istio CNI Plugin</h3>

<p>当前实现将用户 pod 流量转发到 proxy 的默认方式是使用 privileged 权限的 <code>istio-init</code> 这个 init container 来做的（运行脚本写入 iptables），需要用到 <code>NET_ADMIN</code> capabilities。对 linux capabilities 不了解的同学可以参考我的 <a href="https://fuckcloudnative.io/posts/linux-capabilities-why-they-exist-and-how-they-work/" target="_blank">Linux capabilities 系列</a>。</p>

<p>Istio CNI 插件的主要设计目标是消除这个 privileged 权限的 init container，换成利用 Kubernetes CNI 机制来实现相同功能的替代方案。具体的原理就是在 Kubernetes CNI 插件链末尾加上 Istio 的处理逻辑，在创建和销毁 pod 的这些 hook 点来针对 istio 的 pod 做网络配置：写入 iptables，让该 pod 所在的 network namespace 的网络流量转发到 proxy 进程。</p>

<p>详细内容请参考<a href="https://istio.io/docs/setup/additional-setup/cni/" target="_blank">官方文档</a>。</p>

<p>使用 Istio CNI 插件来创建 sidecar iptables 规则肯定是未来的主流方式，不如我们现在就尝试使用这种方法。</p>

<h3 id="kubernetes-关键插件-critical-add-on-pods">Kubernetes 关键插件（Critical Add-On Pods）</h3>

<p>众所周知，Kubernetes 的核心组件都运行在 master 节点上，然而还有一些附加组件对整个集群来说也很关键，例如 DNS 和 metrics-server，这些被称为<strong>关键插件</strong>。一旦关键插件无法正常工作，整个集群就有可能会无法正常工作，所以 Kubernetes 通过优先级（PriorityClass）来保证关键插件的正常调度和运行。要想让某个应用变成 Kubernetes 的<strong>关键插件</strong>，只需要其 <code>priorityClassName</code> 设为 <code>system-cluster-critical</code> 或 <code>system-node-critical</code>，其中 <code>system-node-critical</code> 优先级最高。</p>

<blockquote>
<p>注意：关键插件只能运行在 <code>kube-system</code> namespace 中！</p>
</blockquote>

<p>详细内容可以参考<a href="https://v1-16.docs.kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/" target="_blank">官方文档</a>。</p>

<p>接下来正式安装 istio，命令如下：</p>

<pre><code class="language-bash">$ istioctl manifest apply --set profile=demo \
   --set cni.enabled=true --set cni.components.cni.namespace=kube-system \
   --set values.gateways.istio-ingressgateway.type=ClusterIP
</code></pre>

<p>istioctl 支持两种 API：</p>

<ul>
<li><a href="https://istio.io/docs/reference/config/istio.operator.v1alpha12.pb/" target="_blank">IstioControlPlane API</a></li>
<li><a href="https://istio.io/docs/reference/config/installation-options/" target="_blank">Helm API</a></li>
</ul>

<p>在上述安装命令中，cni 参数使用的是 IstioControlPlane API，而 <code>values.*</code> 使用的是 Helm API。</p>

<p>部署完成后，查看各组件状态：</p>

<pre><code class="language-bash">$ kubectl -n istio-system get pod

NAME                                      READY   STATUS    RESTARTS   AGE
grafana-6b65874977-8psph                  1/1     Running   0          36s
istio-citadel-86dcf4c6b-nklp5             1/1     Running   0          37s
istio-egressgateway-68f754ccdd-m87m8      0/1     Running   0          37s
istio-galley-5fc6d6c45b-znwl9             1/1     Running   0          38s
istio-ingressgateway-6d759478d8-g5zz2     0/1     Running   0          37s
istio-pilot-5c4995d687-vf9c6              0/1     Running   0          37s
istio-policy-57b99968f-ssq28              1/1     Running   1          37s
istio-sidecar-injector-746f7c7bbb-qwc8l   1/1     Running   0          37s
istio-telemetry-854d8556d5-6znwb          1/1     Running   1          36s
istio-tracing-c66d67cd9-gjnkl             1/1     Running   0          38s
kiali-8559969566-jrdpn                    1/1     Running   0          36s
prometheus-66c5887c86-vtbwb               1/1     Running   0          39s
</code></pre>

<pre><code class="language-bash">$ kubectl -n kube-system get pod -l k8s-app=istio-cni-node

NAME                   READY   STATUS    RESTARTS   AGE
istio-cni-node-k8zfb   1/1     Running   0          10m
istio-cni-node-kpwpc   1/1     Running   0          10m
istio-cni-node-nvblg   1/1     Running   0          10m
istio-cni-node-vk6jd   1/1     Running   0          10m
</code></pre>

<p>可以看到 cni 插件已经安装成功，查看配置是否已经追加到 CNI 插件链的末尾：</p>

<pre><code class="language-bash">$ cat /etc/cni/net.d/10-calico.conflist

{
  &quot;name&quot;: &quot;k8s-pod-network&quot;,
  &quot;cniVersion&quot;: &quot;0.3.1&quot;,
  &quot;plugins&quot;: [
  ...
    {
      &quot;type&quot;: &quot;istio-cni&quot;,
      &quot;log_level&quot;: &quot;info&quot;,
      &quot;kubernetes&quot;: {
        &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/ZZZ-istio-cni-kubeconfig&quot;,
        &quot;cni_bin_dir&quot;: &quot;/opt/cni/bin&quot;,
        &quot;exclude_namespaces&quot;: [
          &quot;istio-system&quot;
        ]
      }
    }
  ]
}
</code></pre>

<p>默认情况下除了 <code>istio-system</code> namespace 之外，istio cni 插件会监视其他所有 namespace 中的 Pod，然而这并不能满足我们的需求，更严谨的做法是让 istio CNI 插件至少忽略 <code>kube-system</code>、<code>istio-system</code> 这两个 namespace，怎么做呢？</p>

<p>也很简单，还记得之前提到的 IstioControlPlane API 吗？可以直接通过它来覆盖之前的配置，只需要创建一个 <code>IstioControlPlane</code> CRD 就可以了。例如：</p>

<pre><code class="language-yaml">$ cat cni.yaml

apiVersion: install.istio.io/v1alpha2
kind: IstioControlPlane
spec:
  cni:
    enabled: true
    components:
      namespace: kube-system
  values:
    cni:
      excludeNamespaces:
       - istio-system
       - kube-system
       - monitoring
  unvalidatedValues:
    cni:
      logLevel: info
</code></pre>

<pre><code class="language-bash">$ istioctl manifest apply -f cni.yaml
</code></pre>

<p>删除所有的 istio-cni-node Pod：</p>

<pre><code class="language-bash">$ kubectl -n kube-system delete pod -l k8s-app=istio-cni-node
</code></pre>

<p>再次查看 CNI 插件链的配置：</p>

<pre><code class="language-bash">$ cat /etc/cni/net.d/10-calico.conflist

{
  &quot;name&quot;: &quot;k8s-pod-network&quot;,
  &quot;cniVersion&quot;: &quot;0.3.1&quot;,
  &quot;plugins&quot;: [
  ...
    {
      &quot;type&quot;: &quot;istio-cni&quot;,
      &quot;log_level&quot;: &quot;info&quot;,
      &quot;kubernetes&quot;: {
        &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/ZZZ-istio-cni-kubeconfig&quot;,
        &quot;cni_bin_dir&quot;: &quot;/opt/cni/bin&quot;,
        &quot;exclude_namespaces&quot;: [
          &quot;istio-system&quot;,
          &quot;kube-system&quot;,
          &quot;monitoring&quot;
        ]
      }
    }
  ]
}
</code></pre>

<h2 id="span-id-inline-toc-4-span-暴露-dashboard"><span id="inline-toc">4.</span> 暴露 Dashboard</h2>

<p>这个没什么好说的，通过 Ingress Controller 暴露就好了，可以参考我以前写的 <a href="https://fuckcloudnative.io/posts/istio-1.0-deploy/" target="_blank">Istio 1.0 部署</a>。如果使用 Contour 的可以参考我的另一篇文章：<a href="https://fuckcloudnative.io/posts/use-envoy-as-a-kubernetes-ingress/" target="_blank">Contour 学习笔记（一）：使用 Contour 接管 Kubernetes 的南北流量</a>。</p>

<p>这里我再介绍一种新的方式，<code>istioctl</code> 提供了一个子命令来从本地打开各种 Dashboard：</p>

<pre><code class="language-bash">$ istioctl dashboard --help

Access to Istio web UIs

Usage:
  istioctl dashboard [flags]
  istioctl dashboard [command]

Aliases:
  dashboard, dash, d

Available Commands:
  controlz    Open ControlZ web UI
  envoy       Open Envoy admin web UI
  grafana     Open Grafana web UI
  jaeger      Open Jaeger web UI
  kiali       Open Kiali web UI
  prometheus  Open Prometheus web UI
  zipkin      Open Zipkin web UI
</code></pre>

<p>例如，要想在本地打开 Grafana 页面，只需执行下面的命令：</p>

<pre><code class="language-bash">$ istioctl dashboard grafana
http://localhost:36813
</code></pre>

<p>咋一看可能觉得这个功能很鸡肋，我的集群又不是部署在本地，而且这个命令又不能指定监听的 IP，在本地用浏览器根本打不开呀！其实不然，你可以在本地安装 kubectl 和 istioctl 二进制文件，然后通过 kubeconfig 连接到集群，最后再在本地执行上面的命令，就可以打开页面啦，开发人员用来测试是不是很方便？Windows 用户当我没说。。。</p>

<h2 id="span-id-inline-toc-5-span-暴露-gateway"><span id="inline-toc">5.</span> 暴露 Gateway</h2>

<p>为了暴露 Ingress Gateway，我们可以使用 <code>HostNetwork</code> 模式运行，但你会发现无法启动 ingressgateway 的 Pod，因为如果 Pod 设置了 <code>HostNetwork=true</code>，则 dnsPolicy 就会从 <code>ClusterFirst</code> 被强制转换成 <code>Default</code>。而 Ingress Gateway 启动过程中需要通过 DNS 域名连接 <code>pilot</code> 等其他组件，所以无法启动。</p>

<p>我们可以通过强制将 <code>dnsPolicy</code> 的值设置为 <code>ClusterFirstWithHostNet</code> 来解决这个问题，详情参考：<a href="https://fuckcloudnative.io/posts/kubernetes-dns/" target="_blank">Kubernetes DNS 高阶指南</a>。</p>

<p>修改后的 ingressgateway deployment 配置文件如下：</p>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: istio-ingressgateway
  namespace: istio-system
  ...
spec:
  ...
  template:
    metadata:
    ...
    spec:
      affinity:
        nodeAffinity:
          ...
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                - 192.168.0.4   # 假设你想调度到这台主机上
      ...
      dnsPolicy: ClusterFirstWithHostNet
      hostNetwork: true
      restartPolicy: Always
      ...
</code></pre>

<p>接下来我们就可以在浏览器中通过 Gateway 的 URL 来访问服务网格中的服务了。后面我会开启一系列实验教程，本文的所有步骤都是为后面做准备，如果想跟着我做后面的实验，请务必做好本文所述的准备工作。</p>

         
	 
	 <br />
	 <div style="text-align:center;color: #ccc;font-size:16px;font-family: cursive;">-------他日江湖相逢 <i class="fa fa-umbrella" style="color:#986dbd"></i> 再当杯酒言欢-------</div>
         
           

<div class="entry-shang text-center">
	<p>「真诚赞赏，手留余香」</p>
        <button class="zs show-zs btn rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"> <span>赏</span> </button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><img src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg"/>米开朗基杨</span>
		<p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
 	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/wechat-2.png" id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
                <span class="zs-wechat"><img src="/img/wechat-btn.png"/></span>
	</div>
</div>

         

        
          <div class="blog-tags">
            
              <a href="https://fuckcloudnative.io/tags/istio/"><i class="fa fa-tags"></i>istio</a>&nbsp;
            
              <a href="https://fuckcloudnative.io/tags/service-mesh/"><i class="fa fa-tags"></i>service mesh</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
	      <a href="//service.weibo.com/share/share.php?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;title=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;pic=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2f20191215002051.png" target="_blank" title="分享到微博">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
      
      <li>
	      <a href="//connect.qq.com/widget/shareqq/index.html?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;title=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;source=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;desc=%e6%9c%ac%e6%96%87%e5%b0%86%e4%bc%9a%e5%91%8a%e8%af%89%e4%bd%a0%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20istioctl%20%e9%83%a8%e7%bd%b2%20istio%201.4%ef%bc%8c%e5%b9%b6%e5%bc%80%e5%90%af%20istio%20CNI%20%e6%8f%92%e4%bb%b6%e3%80%82&amp;pics=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2f20191215002051.png&amp;summary=%e6%9c%ac%e6%96%87%e5%b0%86%e4%bc%9a%e5%91%8a%e8%af%89%e4%bd%a0%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20istioctl%20%e9%83%a8%e7%bd%b2%20istio%201.4%ef%bc%8c%e5%b9%b6%e5%bc%80%e5%90%af%20istio%20CNI%20%e6%8f%92%e4%bb%b6%e3%80%82" target="_blank" title="分享到 QQ">
          <i class="fab fa-qq"></i>
        </a>
      </li>
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;text=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;via=RyangYang1" target="_blank" title="分享到 Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f" target="_blank" title="分享到 Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
	      <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;title=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97" target="_blank" title="分享到 LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">相关推荐</h4>
                  <ul>
                
                
                    <li><a href="/posts/istio-1.3-tour/">手把手教你部署 Istio 1.3</a></li>
                
                    <li><a href="/posts/istio-1.3/">Istio 1.3 发布，HTTP 遥测不再需要 Mixer</a></li>
                
                    <li><a href="/posts/circuit_breaking-and-outlier-detection-in-istio/">熔断与异常检测在 Istio 中的应用</a></li>
                
                    <li><a href="/posts/life-of-a-packet-through-istio/">数据包在 Istio 网格中的生命周期</a></li>
                
                    <li><a href="/posts/conflictingvirtualservicehost/">Istio 中 VirtualService 的注意事项</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fuckcloudnative.io/posts/font-spider-plus/" data-toggle="tooltip" data-placement="top" title="使用 font-spider 对 webfont 网页字体进行压缩">&larr; 前一篇</a>
            </li>
          
          
            <li class="next">
              <a href="https://fuckcloudnative.io/posts/use-nftables-as-firewall/" data-toggle="tooltip" data-placement="top" title="nftables 基础教程：使用 nftables 作为防火墙">后一篇 &rarr;</a>
            </li>
          
        </ul>
      

      
	    <link rel="stylesheet" href="https://fuckcloudnative.io/css/iDisqus.min.css" />
<div id="comment"></div>
<script src="https://fuckcloudnative.io/js/iDisqus.min.js"></script>
<script>
var disq = new iDisqus('comment', {
    forum: 'fuckcloudnative',
    api: 'https://disqus.fuckcloudnative.io',
    site: 'http://fuckcloudnative.io',
    emojiPath: 'https://api.fooleap.org/emoji/unicode/',
    mode: 2,
    timeout: 15,
    init: true
});
</script>

      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:yangchuansheng33@gmail.com" target="_blank" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-13-%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E6%A8%AA%E7%89%88%E4%BA%8C%E7%BB%B4%E7%A0%81_2019.05.17.1.1.png" target="_blank" title="Weixin">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/yangchuansheng" target="_blank" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/RyangYang1" target="_blank" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/yang-ryan-b6659b106" target="_blank" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://weibo.com/3496206342" target="_blank" title="微博">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://drive.google.com/drive/folders/0By_W-zIhlMXqSGJyU3pHaVVpV2M" target="_blank" title="视频分享">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-google-drive fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://fuckcloudnative.io/index.xml" target="_blank" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
	<br />
        <p class="credits copyright text-muted">
	  &nbsp;&bull;&nbsp;&copy;2019
          
            
              <a href="https://fuckcloudnative.io">米开朗基杨</a>
            
          

          &nbsp;&bull;&nbsp;更新于
          
            2019 年 12 月 19 日
          

	  &nbsp;&bull;&nbsp;
          <a href="https://fuckcloudnative.io/tags/">所有文章</a>

	  
        </p>
        <p class="credits theme-by text-muted">
        <br />
        <span id="busuanzi_container_site_pv">
            本站已被访问 <span id="busuanzi_value_site_pv"></span> 次啦
        </span>
        <span id="busuanzi_container_site_uv">
            &ensp;|&ensp;&thinsp;您是第 <span id="busuanzi_value_site_uv"></span> 位到访的小伙伴
        </span>
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="https://gohugo.io">Hugo v0.59.0</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 移植自 <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
	  <section class="credits theme-by text-muted" align="center">
    <span class="footer__copyright">
    <div>
    <span id="span_dt_dt"> </span>
    <script language="javascript">
      function show_date_time(){
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date("7/8/2017 10:56:12");
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span_dt_dt.innerHTML="本站已经开心运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
      }
      show_date_time();
    </script>
    </div>
</script>
</section>

	</p>
      </div>
    </div>
  </div>
</footer>


<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container',
        blogId: '10020-1569254413955-300',
        name: '云原生实验室',
        qrcode: 'https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/wechat.gif',
        keyword: 'vip',
    });
</script>
<script src='/js/bundle.min.13b2d74fbe48bdf362a1e1572571a00fa30ef02c3fa8f697c71a47c9462a759a.js' integrity='sha256-E7LXT75IvfNioeFXJXGgD6MO8Cw/qPaXxxpHyUYqdZo='></script>






<script src="https://fuckcloudnative.io/js/load-photoswipe.js"></script>








<div class="rocket"><img src="/img/rocket_up.png" alt="" width="100" height="100"></div>
<script>
    $(function () {
      $(window).scroll(function () {
        
        if ($(window).scrollTop() >= 1000) {
          $('.rocket').stop().fadeIn(1000);
        }else {
          $('.rocket').stop().fadeOut(1000);
        }
      })
      
      $('.rocket').click(function () {
        $('html,body').stop().animate({scrollTop:0},400);
       
      })
    })

</script>




<script type="text/javascript">
      jQuery(function() {
          jQuery("img").lazyload({threshold: 0,effect: "fadeIn"});
      });
</script>











<script type="text/javascript">
$(document).ready(function () {
  $(window).scroll(function(){
    $(".top-scroll-bar").attr("style", "width: " + ($(this).scrollTop() / ($(document).height() - $(this).height()) * 100) + "%; display: block;");
  });
})
</script>


<script type="text/javascript">
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("Docker", "Kubernetes", "Prometheus", "Envoy", "Istio", "coredns", "Service Mesh", "Cloud Native");
        var $i = $("<span />").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        function randomColor() {
          var flakeColor = new Array("#FFDA65", "#00BFFF", "#BA55D3", "#FFA07A", "#87CEEB", "#FFB6C1");
          var snowColor = flakeColor[Math.floor(flakeColor.length * Math.random())];
          return snowColor;
        }
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": randomColor()
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>


    
  </body>
</html>

