<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Istio 1.4 éƒ¨ç½²æŒ‡å— - Kubernetes|Docker|Istio|Envoy|Hugo|Golang|äº‘åŸç”Ÿ</title>


  <meta content="ç±³å¼€æœ—åŸºæ¨, istio, istio cni, critical pod" name="keywords">

  <meta name="description" content="æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨ istioctl éƒ¨ç½² istio 1.4ï¼Œå¹¶å¼€å¯ istio CNI æ’ä»¶ã€‚">
  <meta name="author" content="ç±³å¼€æœ—åŸºæ¨"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "äº‘åŸç”Ÿå®éªŒå®¤",
    
    "url": "https:\/\/fuckcloudnative.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fuckcloudnative.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io\/posts\/istio-deploy\/",
          "name": "Istio 1.4 éƒ¨ç½²æŒ‡å—"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "ç±³å¼€æœ—åŸºæ¨"
  },
  "headline": "Istio 1.4 éƒ¨ç½²æŒ‡å—",
  "description" : "æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨ istioctl éƒ¨ç½² istio 1.4ï¼Œå¹¶å¼€å¯ istio CNI æ’ä»¶ã€‚",
  "inLanguage" : "zh",
  "wordCount":  2436 ,
  "datePublished" : "2019-12-15T00:14:06",
  "dateModified" : "2019-12-15T00:14:06",
  "image" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
  "keywords" : [ "istio, service mesh" ],
  "mainEntityOfPage" : "https:\/\/fuckcloudnative.io\/posts\/istio-deploy\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fuckcloudnative.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Istio 1.4 éƒ¨ç½²æŒ‡å—" />
<meta property="og:description" content="æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨ istioctl éƒ¨ç½² istio 1.4ï¼Œå¹¶å¼€å¯ istio CNI æ’ä»¶ã€‚">
<meta property="og:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
<meta property="og:url" content="https://fuckcloudnative.io/posts/istio-deploy/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="äº‘åŸç”Ÿå®éªŒå®¤" />

  <meta name="twitter:title" content="Istio 1.4 éƒ¨ç½²æŒ‡å—" />
  <meta name="twitter:description" content="æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨ istioctl éƒ¨ç½² istio 1.4ï¼Œå¹¶å¼€å¯ istio CNI æ’ä»¶ã€‚">
  <meta name="twitter:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@RyangYang1" />
  <meta name="twitter:creator" content="@RyangYang1" />

  <link href='https://hugo-picture.oss-cn-beijing.aliyuncs.com/favicon-32x32.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.59.0" />
  <link rel="alternate" href="https://fuckcloudnative.io/index.xml" type="application/rss+xml" title="äº‘åŸç”Ÿå®éªŒå®¤">
  
  
  
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet">
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">


<link rel="stylesheet" href='/css/bundle.min.f389e6be7cecef1da8fb771dfe9c801a88dc7f2f87660bd530c4f14216846f94.css' integrity='sha256-84nmvnzs7x2o&#43;3cd/pyAGojcfy&#43;HZgvVMMTxQhaEb5Q='>





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?efe96f04908ae320df234a4f5626879e";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script src="https://fuckcloudnative.io/js/pace.min.js"></script>



<script src="https://fuckcloudnative.io/js/busuanzi.pure.mini.js"></script>
<script>
var int = setInterval(fixCount, 50);
function fixCount() {
    if (document.getElementById('busuanzi_container_site_uv').ownerDocument.defaultView.getComputedStyle(document.getElementById('busuanzi_container_site_uv'), null).display === 'inline') {
        clearInterval(int);
        document.getElementById('busuanzi_value_site_uv') = parseInt(document.getElementById('busuanzi_value_site_uv').innerHTML) + parseInt('100000');
    }
}
</script>







    <div class="top-scroll-bar"></div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-145022311-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">åˆ‡æ¢å¯¼èˆª</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="https://fuckcloudnative.io">ğŸ³ > $ cd /home/</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-dharmachakra fa-spin" style="color:#986dbd"></i> æ–‡ç« åˆ†ç±»</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes/">kubernetes</a>
                
                  <a href="/categories/monitoring/">ç›‘æ§</a>
                
                  <a href="/categories/service-mesh/">Service Mesh</a>
                
                  <a href="/categories/devops/">DevOps</a>
                
                  <a href="/categories/docker/">Docker</a>
                
                  <a href="/categories/linux/">Linux</a>
                
                  <a href="/categories/python/">Python</a>
                
                  <a href="/categories/network/">ç½‘ç»œ</a>
                
                  <a href="/categories/loadbalance/"> è´Ÿè½½å‡è¡¡</a>
                
                  <a href="/categories/gfw/">ç§‘å­¦ä¸Šç½‘</a>
                
                  <a href="/categories/math/">æ•°å­¦</a>
                
                  <a href="/categories/share/">é»‘ç§‘æŠ€</a>
                
                  <a href="/categories/hugo/">Hugo</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fab fa-docker"></i> ç”µå­ä¹¦</a>
              <div class="navlinks-children">
                
                  <a href="/prometheus-handbook/">Prometheus ä¸­æ–‡æ–‡æ¡£</a>
                
                  <a href="/talent-is-overrated/">å¤©æ‰æºè‡ªåˆ»æ„ç»ƒä¹ </a>
                
                  <a href="/the-way-to-go/">Go å…¥é—¨æŒ‡å—</a>
                
                  <a href="https://github.com/fengdu78/Coursera-ML-AndrewNg-Notes">æœºå™¨å­¦ä¹ ç¬”è®°</a>
                
                  <a href="https://github.com/ruanyf/reading-list">é˜®ä¸€å³°ä¹¦å•</a>
                
                  <a href="https://istio.io/zh/docs">Istio service mesh</a>
                
                  <a href="https://www.gitbook.com/book/yeasy/docker_practice">Docker handbook</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-book"></i> è‘µèŠ±å®å…¸</a>
              <div class="navlinks-children">
                
                  <a href="/learn-english/"> è‹±è¯­å­¦ä¹ ç»ˆæç§˜è¯€</a>
                
                  <a href="/a-day-in-the-life-of-jeff/">A Day in the life of Jeff</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"> ğŸ˜±ç¦åˆ©</a>
              <div class="navlinks-children">
                
                  <a href="https://bt.fuckcloudnative.io">ç§å­æœç´¢</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Rss è®¢é˜…" href="/index.xml">Rss è®¢é˜…</a>
            </li>
          
        

        

        
        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">æœç´¢</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="äº‘åŸç”Ÿå®éªŒå®¤" href="https://fuckcloudnative.io">
            <img class="avatar-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" alt="äº‘åŸç”Ÿå®éªŒå®¤" />
          </a>
        </div>
      </div>
    

  </div>
</nav>





  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search fuckcloudnative.io</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>


<script src="https://fuckcloudnative.io/js/algoliasearch.min.js"></script>
<script src="https://fuckcloudnative.io/js/autocomplete.min.js"></script>


<script>
var client = algoliasearch("4BELQK2TOI", "62fd06bd949abb4211bfab0aa288f67b");
var index = client.initIndex('blog');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            
            return '<span>' + '<a href="/' + suggestion.uri+ '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>


    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1 
      
         
          data-img-src-1="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-04-27-080627.jpg" 
         
         
      ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
		  
		      <h1 align="center">Istio 1.4 éƒ¨ç½²æŒ‡å—</h1>
		  
                  
                    
		      <hr class="small">
                      <h2 class="post-subheading">ä½¿ç”¨ Istio CNI Plugin æ¥è½¬å‘æµé‡</h2>
                    
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;å‘è¡¨äº 2019 å¹´ 12 æœˆ 15 æ—¥
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;åˆ†é’Ÿ
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2436&nbsp;ä¸ªå­—
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
  
</span>

                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Istio 1.4 éƒ¨ç½²æŒ‡å—</h1>
              
              
              
                
                  <h2 class="post-subheading">ä½¿ç”¨ Istio CNI Plugin æ¥è½¬å‘æµé‡</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;å‘è¡¨äº 2019 å¹´ 12 æœˆ 15 æ—¥
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;åˆ†é’Ÿ
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2436&nbsp;ä¸ªå­—
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
  
</span>

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div id="container" class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <a title="æ¬ç“¦å·¥" href="https://bandwagonhost.com/aff.php?aff=54207" target="_blank">
<p id="sponsor-text" style="box-sizing: border-box;
    text-align: center;
    width: 100%;
    border: 1px solid #e5e4e9;
    background-color: #d0e4a9;
    margin: 1em 0 0;
    padding: 0.6em 0.6em 0.4em 0.6em;
    border-radius: 0.3em 0.3em 0.1em 0.1em;
    color: #076a66;"><span style="text-decoration: underline;">æ¬ç“¦å·¥</span>é¦™æ¸¯ VPS CN2ï¼Œè¶…ä½ä»· <span style="text-decoration: underline;">$2.99/å¹´</span>èµ·ã€‚é€‚åˆæ–°æ‰‹å…¥é—¨å»ºç«™ï¼Œæˆ‘çš„åšå®¢å°±æ˜¯åœ¨è¿™ä¸Šé¢æ­å»ºçš„</p>
<p style="padding:0em;margin:0 0 1.5em 0;border: 1px solid #e5e4e9;border-radius: 0.1em 0.1em 0.3em 0.3em;background-color: #28344a;text-align: center;" class="entry-sponsor-img">
  <img alt="æ¬ç“¦å·¥" id="support-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/bandwagonhost.jpg" style="border: none;width: 100%;max-width: 100%;display: inline-block;">

</p>
</a>

      <article role="main" class="blog-post">
	
<aside class="toc">
    <div id='anchors-navbar'>
        <i class='fa fa-anchor'></i>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-id-inline-toc-1-span-kubernetes-ç¯å¢ƒå‡†å¤‡"><span id="inline-toc">1.</span> Kubernetes ç¯å¢ƒå‡†å¤‡</a>
<ul>
<li><a href="#å‰ææ¡ä»¶">å‰ææ¡ä»¶</a></li>
<li><a href="#å®‰è£…-kubernetes-é›†ç¾¤">å®‰è£… kubernetes é›†ç¾¤</a></li>
</ul></li>
<li><a href="#span-id-inline-toc-2-span-ä¸‹è½½-istio-éƒ¨ç½²æ–‡ä»¶"><span id="inline-toc">2.</span> ä¸‹è½½ Istio éƒ¨ç½²æ–‡ä»¶</a>
<ul>
<li><a href="#å¼€å¯-istioctl-çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½">å¼€å¯ istioctl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</a>
<ul>
<li><a href="#bash">bash</a></li>
<li><a href="#zsh">zsh</a></li>
</ul></li>
</ul></li>
<li><a href="#span-id-inline-toc-3-span-éƒ¨ç½²-istio"><span id="inline-toc">3.</span> éƒ¨ç½² Istio</a>
<ul>
<li><a href="#istio-cni-plugin">Istio CNI Plugin</a></li>
<li><a href="#kubernetes-å…³é”®æ’ä»¶-critical-add-on-pods">Kubernetes å…³é”®æ’ä»¶ï¼ˆCritical Add-On Podsï¼‰</a></li>
</ul></li>
<li><a href="#span-id-inline-toc-4-span-æš´éœ²-dashboard"><span id="inline-toc">4.</span> æš´éœ² Dashboard</a></li>
<li><a href="#span-id-inline-toc-5-span-æš´éœ²-gateway"><span id="inline-toc">5.</span> æš´éœ² Gateway</a></li>
</ul></li>
</ul>
</nav>
    </div>
    
</aside>


        
         

         
           

<p>Istio ä¸€ç›´å¤„äºå¿«é€Ÿè¿­ä»£æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒçš„éƒ¨ç½²æ–¹æ³•ä¹Ÿåœ¨ä¸æ–­æ›´æ–°ï¼Œä¹‹å‰æˆ‘åœ¨ 1.0 ç‰ˆæœ¬ä¸­ä»‹ç»çš„å®‰è£…æ–¹æ³•ï¼Œå¯¹äºæœ€æ–°çš„ 1.4 ç‰ˆæœ¬å·²ç»ä¸é€‚ç”¨äº†ã€‚ä»¥åä¸»æµçš„éƒ¨ç½²æ–¹å¼éƒ½æ˜¯ç”¨ istioctl è¿›è¡Œéƒ¨ç½²ï¼Œhelm å¯ä»¥æ¸æ¸é è¾¹ç«™äº†~~</p>

<p>åœ¨éƒ¨ç½² Istio ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿ Kubernetes é›†ç¾¤ï¼ˆkubernetes ç‰ˆæœ¬å»ºè®®åœ¨ <code>1.13</code> ä»¥ä¸Šï¼‰å·²éƒ¨ç½²å¹¶é…ç½®å¥½æœ¬åœ°çš„ kubectl å®¢æˆ·ç«¯ã€‚</p>

<h2 id="span-id-inline-toc-1-span-kubernetes-ç¯å¢ƒå‡†å¤‡"><span id="inline-toc">1.</span> Kubernetes ç¯å¢ƒå‡†å¤‡</h2>

<p>ä¸ºäº†å¿«é€Ÿå‡†å¤‡ kubernetes ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sealos æ¥éƒ¨ç½²ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>

<h3 id="å‰ææ¡ä»¶">å‰ææ¡ä»¶</h3>

<ul>
<li>ä¸‹è½½<a href="http://store.lameleg.com/" target="_blank">kubernetes ç¦»çº¿å®‰è£…åŒ…</a></li>
<li>ä¸‹è½½<a href="https://github.com/fanux/sealos/releases" target="_blank">æœ€æ–°ç‰ˆæœ¬sealos</a></li>
<li>åŠ¡å¿…åŒæ­¥æœåŠ¡å™¨æ—¶é—´</li>
<li>ä¸»æœºåä¸å¯é‡å¤</li>
</ul>

<h3 id="å®‰è£…-kubernetes-é›†ç¾¤">å®‰è£… kubernetes é›†ç¾¤</h3>

<pre><code class="language-bash">$ sealos init --master 192.168.0.2 \
    --node 192.168.0.3 \
    --node 192.168.0.4 \
    --node 192.168.0.5 \
    --user root \
    --passwd your-server-password \
    --version v1.16.3 \
    --pkg-url /root/kube1.16.3.tar.gz 
</code></pre>

<p>æ£€æŸ¥å®‰è£…æ˜¯å¦æ­£å¸¸ï¼š</p>

<pre><code class="language-bash">$ kubectl get node

NAME       STATUS   ROLES    AGE   VERSION
sealos01   Ready    master   18h   v1.16.3
sealos02   Ready    &lt;none&gt;   18h   v1.16.3
sealos03   Ready    &lt;none&gt;   18h   v1.16.3
sealos04   Ready    &lt;none&gt;   18h   v1.16.3
</code></pre>

<h2 id="span-id-inline-toc-2-span-ä¸‹è½½-istio-éƒ¨ç½²æ–‡ä»¶"><span id="inline-toc">2.</span> ä¸‹è½½ Istio éƒ¨ç½²æ–‡ä»¶</h2>

<p>ä½ å¯ä»¥ä» GitHub çš„ <a href="https://github.com/istio/istio/releases/tag/1.4.2" target="_blank">release</a> é¡µé¢ä¸‹è½½ istioï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ä¸‹è½½ï¼š</p>

<pre><code class="language-bash">$ curl -L https://istio.io/downloadIstio | sh -
</code></pre>

<p>ä¸‹è½½å®Œæˆåä¼šå¾—åˆ°ä¸€ä¸ª <code>istio-1.4.2</code> ç›®å½•ï¼Œé‡Œé¢åŒ…å«äº†ï¼š</p>

<ul>
<li><code>install/kubernetes</code> : é’ˆå¯¹ Kubernetes å¹³å°çš„å®‰è£…æ–‡ä»¶</li>
<li><code>samples</code> : ç¤ºä¾‹åº”ç”¨</li>
<li><code>bin</code> : istioctl äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ‰‹åŠ¨æ³¨å…¥ sidecar proxy</li>
</ul>

<p>è¿›å…¥ <code>istio-1.4.2</code> ç›®å½•ã€‚</p>

<pre><code class="language-bash">$ cd istio-1.4.2

$ tree -L 1 ./
./
â”œâ”€â”€ bin
â”œâ”€â”€ demo.yaml
â”œâ”€â”€ install
â”œâ”€â”€ LICENSE
â”œâ”€â”€ manifest.yaml
â”œâ”€â”€ README.md
â”œâ”€â”€ samples
â””â”€â”€ tools

4 directories, 4 files
</code></pre>

<p>å°† istioctl æ‹·è´åˆ° <code>/usr/local/bin/</code> ä¸­ï¼š</p>

<pre><code class="language-bash">$ cp bin/istioctl /usr/local/bin/
</code></pre>

<h3 id="å¼€å¯-istioctl-çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½">å¼€å¯ istioctl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</h3>

<h4 id="bash">bash</h4>

<p>å°† <code>tools</code> ç›®å½•ä¸­çš„ <code>istioctl.bash</code> æ‹·è´åˆ° $HOME ç›®å½•ä¸­ï¼š</p>

<pre><code class="language-bash">$ cp tools/istioctl.bash ~/
</code></pre>

<p>åœ¨ <code>~/.bashrc</code> ä¸­æ·»åŠ ä¸€è¡Œï¼š</p>

<pre><code class="language-bash">source ~/istioctl.bash
</code></pre>

<p>åº”ç”¨ç”Ÿæ•ˆï¼š</p>

<pre><code class="language-bash">$ source ~/.bashrc
</code></pre>

<h4 id="zsh">zsh</h4>

<p>å°† <code>tools</code> ç›®å½•ä¸­çš„ <code>_istioctl</code> æ‹·è´åˆ° $HOME ç›®å½•ä¸­ï¼š</p>

<pre><code class="language-bash">$ cp tools/_istioctl ~/
</code></pre>

<p>åœ¨ <code>~/.zshrc</code> ä¸­æ·»åŠ ä¸€è¡Œï¼š</p>

<pre><code class="language-bash">source ~/_istioctl
</code></pre>

<p>åº”ç”¨ç”Ÿæ•ˆï¼š</p>

<pre><code class="language-bash">$ source ~/.zshrc
</code></pre>

<h2 id="span-id-inline-toc-3-span-éƒ¨ç½²-istio"><span id="inline-toc">3.</span> éƒ¨ç½² Istio</h2>

<p>istioctl æä¾›äº†å¤šç§å®‰è£…é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š</p>

<pre><code class="language-bash">$ istioctl profile list

Istio configuration profiles:
    minimal
    remote
    sds
    default
    demo
</code></pre>

<p>å®ƒä»¬ä¹‹é—´çš„å·®å¼‚å¦‚ä¸‹ï¼š</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="left">default</th>
<th align="left">demo</th>
<th align="left">minimal</th>
<th align="left">sds</th>
<th align="left">remote</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center"><strong>æ ¸å¿ƒç»„ä»¶</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-citadel</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
</tr>

<tr>
<td align="center">istio-egressgateway</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-galley</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-ingressgateway</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-nodeagent</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-pilot</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-policy</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-sidecar-injector</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
</tr>

<tr>
<td align="center">istio-telemetry</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>

<tr>
<td align="center"><strong>é™„åŠ ç»„ä»¶</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">Grafana</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">istio-tracing</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">kiali</td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>

<tr>
<td align="center">prometheus</td>
<td align="left"><strong>X</strong></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
<td align="left"><strong>X</strong></td>
<td align="left"></td>
</tr>
</tbody>
</table>

<p>å…¶ä¸­æ ‡è®° <strong>X</strong> è¡¨ç¤ºè¯¥å®‰è£…è¯¥ç»„ä»¶ã€‚</p>

<p>å¦‚æœåªæ˜¯æƒ³å¿«é€Ÿè¯•ç”¨å¹¶ä½“éªŒå®Œæ•´çš„åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é…ç½®æ–‡ä»¶ <code>demo</code> æ¥éƒ¨ç½²ã€‚</p>

<p>åœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œéœ€è¦å…ˆè¯´æ˜ä¸¤ç‚¹ï¼š</p>

<h3 id="istio-cni-plugin">Istio CNI Plugin</h3>

<p>å½“å‰å®ç°å°†ç”¨æˆ· pod æµé‡è½¬å‘åˆ° proxy çš„é»˜è®¤æ–¹å¼æ˜¯ä½¿ç”¨ privileged æƒé™çš„ <code>istio-init</code> è¿™ä¸ª init container æ¥åšçš„ï¼ˆè¿è¡Œè„šæœ¬å†™å…¥ iptablesï¼‰ï¼Œéœ€è¦ç”¨åˆ° <code>NET_ADMIN</code> capabilitiesã€‚å¯¹ linux capabilities ä¸äº†è§£çš„åŒå­¦å¯ä»¥å‚è€ƒæˆ‘çš„ <a href="https://fuckcloudnative.io/posts/linux-capabilities-why-they-exist-and-how-they-work/" target="_blank">Linux capabilities ç³»åˆ—</a>ã€‚</p>

<p>Istio CNI æ’ä»¶çš„ä¸»è¦è®¾è®¡ç›®æ ‡æ˜¯æ¶ˆé™¤è¿™ä¸ª privileged æƒé™çš„ init containerï¼Œæ¢æˆåˆ©ç”¨ Kubernetes CNI æœºåˆ¶æ¥å®ç°ç›¸åŒåŠŸèƒ½çš„æ›¿ä»£æ–¹æ¡ˆã€‚å…·ä½“çš„åŸç†å°±æ˜¯åœ¨ Kubernetes CNI æ’ä»¶é“¾æœ«å°¾åŠ ä¸Š Istio çš„å¤„ç†é€»è¾‘ï¼Œåœ¨åˆ›å»ºå’Œé”€æ¯ pod çš„è¿™äº› hook ç‚¹æ¥é’ˆå¯¹ istio çš„ pod åšç½‘ç»œé…ç½®ï¼šå†™å…¥ iptablesï¼Œè®©è¯¥ pod æ‰€åœ¨çš„ network namespace çš„ç½‘ç»œæµé‡è½¬å‘åˆ° proxy è¿›ç¨‹ã€‚</p>

<p>è¯¦ç»†å†…å®¹è¯·å‚è€ƒ<a href="https://istio.io/docs/setup/additional-setup/cni/" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<p>ä½¿ç”¨ Istio CNI æ’ä»¶æ¥åˆ›å»º sidecar iptables è§„åˆ™è‚¯å®šæ˜¯æœªæ¥çš„ä¸»æµæ–¹å¼ï¼Œä¸å¦‚æˆ‘ä»¬ç°åœ¨å°±å°è¯•ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p>

<h3 id="kubernetes-å…³é”®æ’ä»¶-critical-add-on-pods">Kubernetes å…³é”®æ’ä»¶ï¼ˆCritical Add-On Podsï¼‰</h3>

<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒKubernetes çš„æ ¸å¿ƒç»„ä»¶éƒ½è¿è¡Œåœ¨ master èŠ‚ç‚¹ä¸Šï¼Œç„¶è€Œè¿˜æœ‰ä¸€äº›é™„åŠ ç»„ä»¶å¯¹æ•´ä¸ªé›†ç¾¤æ¥è¯´ä¹Ÿå¾ˆå…³é”®ï¼Œä¾‹å¦‚ DNS å’Œ metrics-serverï¼Œè¿™äº›è¢«ç§°ä¸º<strong>å…³é”®æ’ä»¶</strong>ã€‚ä¸€æ—¦å…³é”®æ’ä»¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œæ•´ä¸ªé›†ç¾¤å°±æœ‰å¯èƒ½ä¼šæ— æ³•æ­£å¸¸å·¥ä½œï¼Œæ‰€ä»¥ Kubernetes é€šè¿‡ä¼˜å…ˆçº§ï¼ˆPriorityClassï¼‰æ¥ä¿è¯å…³é”®æ’ä»¶çš„æ­£å¸¸è°ƒåº¦å’Œè¿è¡Œã€‚è¦æƒ³è®©æŸä¸ªåº”ç”¨å˜æˆ Kubernetes çš„<strong>å…³é”®æ’ä»¶</strong>ï¼Œåªéœ€è¦å…¶ <code>priorityClassName</code> è®¾ä¸º <code>system-cluster-critical</code> æˆ– <code>system-node-critical</code>ï¼Œå…¶ä¸­ <code>system-node-critical</code> ä¼˜å…ˆçº§æœ€é«˜ã€‚</p>

<blockquote>
<p>æ³¨æ„ï¼šå…³é”®æ’ä»¶åªèƒ½è¿è¡Œåœ¨ <code>kube-system</code> namespace ä¸­ï¼</p>
</blockquote>

<p>è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ<a href="https://v1-16.docs.kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<p>æ¥ä¸‹æ¥æ­£å¼å®‰è£… istioï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<pre><code class="language-bash">$ istioctl manifest apply --set profile=demo \
   --set cni.enabled=true --set cni.components.cni.namespace=kube-system \
   --set values.gateways.istio-ingressgateway.type=ClusterIP
</code></pre>

<p>istioctl æ”¯æŒä¸¤ç§ APIï¼š</p>

<ul>
<li><a href="https://istio.io/docs/reference/config/istio.operator.v1alpha12.pb/" target="_blank">IstioControlPlane API</a></li>
<li><a href="https://istio.io/docs/reference/config/installation-options/" target="_blank">Helm API</a></li>
</ul>

<p>åœ¨ä¸Šè¿°å®‰è£…å‘½ä»¤ä¸­ï¼Œcni å‚æ•°ä½¿ç”¨çš„æ˜¯ IstioControlPlane APIï¼Œè€Œ <code>values.*</code> ä½¿ç”¨çš„æ˜¯ Helm APIã€‚</p>

<p>éƒ¨ç½²å®Œæˆåï¼ŒæŸ¥çœ‹å„ç»„ä»¶çŠ¶æ€ï¼š</p>

<pre><code class="language-bash">$ kubectl -n istio-system get pod

NAME                                      READY   STATUS    RESTARTS   AGE
grafana-6b65874977-8psph                  1/1     Running   0          36s
istio-citadel-86dcf4c6b-nklp5             1/1     Running   0          37s
istio-egressgateway-68f754ccdd-m87m8      0/1     Running   0          37s
istio-galley-5fc6d6c45b-znwl9             1/1     Running   0          38s
istio-ingressgateway-6d759478d8-g5zz2     0/1     Running   0          37s
istio-pilot-5c4995d687-vf9c6              0/1     Running   0          37s
istio-policy-57b99968f-ssq28              1/1     Running   1          37s
istio-sidecar-injector-746f7c7bbb-qwc8l   1/1     Running   0          37s
istio-telemetry-854d8556d5-6znwb          1/1     Running   1          36s
istio-tracing-c66d67cd9-gjnkl             1/1     Running   0          38s
kiali-8559969566-jrdpn                    1/1     Running   0          36s
prometheus-66c5887c86-vtbwb               1/1     Running   0          39s
</code></pre>

<pre><code class="language-bash">$ kubectl -n kube-system get pod -l k8s-app=istio-cni-node

NAME                   READY   STATUS    RESTARTS   AGE
istio-cni-node-k8zfb   1/1     Running   0          10m
istio-cni-node-kpwpc   1/1     Running   0          10m
istio-cni-node-nvblg   1/1     Running   0          10m
istio-cni-node-vk6jd   1/1     Running   0          10m
</code></pre>

<p>å¯ä»¥çœ‹åˆ° cni æ’ä»¶å·²ç»å®‰è£…æˆåŠŸï¼ŒæŸ¥çœ‹é…ç½®æ˜¯å¦å·²ç»è¿½åŠ åˆ° CNI æ’ä»¶é“¾çš„æœ«å°¾ï¼š</p>

<pre><code class="language-bash">$ cat /etc/cni/net.d/10-calico.conflist

{
  &quot;name&quot;: &quot;k8s-pod-network&quot;,
  &quot;cniVersion&quot;: &quot;0.3.1&quot;,
  &quot;plugins&quot;: [
  ...
    {
      &quot;type&quot;: &quot;istio-cni&quot;,
      &quot;log_level&quot;: &quot;info&quot;,
      &quot;kubernetes&quot;: {
        &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/ZZZ-istio-cni-kubeconfig&quot;,
        &quot;cni_bin_dir&quot;: &quot;/opt/cni/bin&quot;,
        &quot;exclude_namespaces&quot;: [
          &quot;istio-system&quot;
        ]
      }
    }
  ]
}
</code></pre>

<p>é»˜è®¤æƒ…å†µä¸‹é™¤äº† <code>istio-system</code> namespace ä¹‹å¤–ï¼Œistio cni æ’ä»¶ä¼šç›‘è§†å…¶ä»–æ‰€æœ‰ namespace ä¸­çš„ Podï¼Œç„¶è€Œè¿™å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ›´ä¸¥è°¨çš„åšæ³•æ˜¯è®© istio CNI æ’ä»¶è‡³å°‘å¿½ç•¥ <code>kube-system</code>ã€<code>istio-system</code> è¿™ä¸¤ä¸ª namespaceï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ</p>

<p>ä¹Ÿå¾ˆç®€å•ï¼Œè¿˜è®°å¾—ä¹‹å‰æåˆ°çš„ IstioControlPlane API å—ï¼Ÿå¯ä»¥ç›´æ¥é€šè¿‡å®ƒæ¥è¦†ç›–ä¹‹å‰çš„é…ç½®ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª <code>IstioControlPlane</code> CRD å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-yaml">$ cat cni.yaml

apiVersion: install.istio.io/v1alpha2
kind: IstioControlPlane
spec:
  cni:
    enabled: true
    components:
      namespace: kube-system
  values:
    cni:
      excludeNamespaces:
       - istio-system
       - kube-system
       - monitoring
  unvalidatedValues:
    cni:
      logLevel: info
</code></pre>

<pre><code class="language-bash">$ istioctl manifest apply -f cni.yaml
</code></pre>

<p>åˆ é™¤æ‰€æœ‰çš„ istio-cni-node Podï¼š</p>

<pre><code class="language-bash">$ kubectl -n kube-system delete pod -l k8s-app=istio-cni-node
</code></pre>

<p>å†æ¬¡æŸ¥çœ‹ CNI æ’ä»¶é“¾çš„é…ç½®ï¼š</p>

<pre><code class="language-bash">$ cat /etc/cni/net.d/10-calico.conflist

{
  &quot;name&quot;: &quot;k8s-pod-network&quot;,
  &quot;cniVersion&quot;: &quot;0.3.1&quot;,
  &quot;plugins&quot;: [
  ...
    {
      &quot;type&quot;: &quot;istio-cni&quot;,
      &quot;log_level&quot;: &quot;info&quot;,
      &quot;kubernetes&quot;: {
        &quot;kubeconfig&quot;: &quot;/etc/cni/net.d/ZZZ-istio-cni-kubeconfig&quot;,
        &quot;cni_bin_dir&quot;: &quot;/opt/cni/bin&quot;,
        &quot;exclude_namespaces&quot;: [
          &quot;istio-system&quot;,
          &quot;kube-system&quot;,
          &quot;monitoring&quot;
        ]
      }
    }
  ]
}
</code></pre>

<h2 id="span-id-inline-toc-4-span-æš´éœ²-dashboard"><span id="inline-toc">4.</span> æš´éœ² Dashboard</h2>

<p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œé€šè¿‡ Ingress Controller æš´éœ²å°±å¥½äº†ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä»¥å‰å†™çš„ <a href="https://fuckcloudnative.io/posts/istio-1.0-deploy/" target="_blank">Istio 1.0 éƒ¨ç½²</a>ã€‚å¦‚æœä½¿ç”¨ Contour çš„å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://fuckcloudnative.io/posts/use-envoy-as-a-kubernetes-ingress/" target="_blank">Contour å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šä½¿ç”¨ Contour æ¥ç®¡ Kubernetes çš„å—åŒ—æµé‡</a>ã€‚</p>

<p>è¿™é‡Œæˆ‘å†ä»‹ç»ä¸€ç§æ–°çš„æ–¹å¼ï¼Œ<code>istioctl</code> æä¾›äº†ä¸€ä¸ªå­å‘½ä»¤æ¥ä»æœ¬åœ°æ‰“å¼€å„ç§ Dashboardï¼š</p>

<pre><code class="language-bash">$ istioctl dashboard --help

Access to Istio web UIs

Usage:
  istioctl dashboard [flags]
  istioctl dashboard [command]

Aliases:
  dashboard, dash, d

Available Commands:
  controlz    Open ControlZ web UI
  envoy       Open Envoy admin web UI
  grafana     Open Grafana web UI
  jaeger      Open Jaeger web UI
  kiali       Open Kiali web UI
  prometheus  Open Prometheus web UI
  zipkin      Open Zipkin web UI
</code></pre>

<p>ä¾‹å¦‚ï¼Œè¦æƒ³åœ¨æœ¬åœ°æ‰“å¼€ Grafana é¡µé¢ï¼Œåªéœ€æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>

<pre><code class="language-bash">$ istioctl dashboard grafana
http://localhost:36813
</code></pre>

<p>å’‹ä¸€çœ‹å¯èƒ½è§‰å¾—è¿™ä¸ªåŠŸèƒ½å¾ˆé¸¡è‚‹ï¼Œæˆ‘çš„é›†ç¾¤åˆä¸æ˜¯éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œè€Œä¸”è¿™ä¸ªå‘½ä»¤åˆä¸èƒ½æŒ‡å®šç›‘å¬çš„ IPï¼Œåœ¨æœ¬åœ°ç”¨æµè§ˆå™¨æ ¹æœ¬æ‰“ä¸å¼€å‘€ï¼å…¶å®ä¸ç„¶ï¼Œä½ å¯ä»¥åœ¨æœ¬åœ°å®‰è£… kubectl å’Œ istioctl äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ kubeconfig è¿æ¥åˆ°é›†ç¾¤ï¼Œæœ€åå†åœ¨æœ¬åœ°æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥æ‰“å¼€é¡µé¢å•¦ï¼Œå¼€å‘äººå‘˜ç”¨æ¥æµ‹è¯•æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼ŸWindows ç”¨æˆ·å½“æˆ‘æ²¡è¯´ã€‚ã€‚ã€‚</p>

<h2 id="span-id-inline-toc-5-span-æš´éœ²-gateway"><span id="inline-toc">5.</span> æš´éœ² Gateway</h2>

<p>ä¸ºäº†æš´éœ² Ingress Gatewayï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>HostNetwork</code> æ¨¡å¼è¿è¡Œï¼Œä½†ä½ ä¼šå‘ç°æ— æ³•å¯åŠ¨ ingressgateway çš„ Podï¼Œå› ä¸ºå¦‚æœ Pod è®¾ç½®äº† <code>HostNetwork=true</code>ï¼Œåˆ™ dnsPolicy å°±ä¼šä» <code>ClusterFirst</code> è¢«å¼ºåˆ¶è½¬æ¢æˆ <code>Default</code>ã€‚è€Œ Ingress Gateway å¯åŠ¨è¿‡ç¨‹ä¸­éœ€è¦é€šè¿‡ DNS åŸŸåè¿æ¥ <code>pilot</code> ç­‰å…¶ä»–ç»„ä»¶ï¼Œæ‰€ä»¥æ— æ³•å¯åŠ¨ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼ºåˆ¶å°† <code>dnsPolicy</code> çš„å€¼è®¾ç½®ä¸º <code>ClusterFirstWithHostNet</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯¦æƒ…å‚è€ƒï¼š<a href="https://fuckcloudnative.io/posts/kubernetes-dns/" target="_blank">Kubernetes DNS é«˜é˜¶æŒ‡å—</a>ã€‚</p>

<p>ä¿®æ”¹åçš„ ingressgateway deployment é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: istio-ingressgateway
  namespace: istio-system
  ...
spec:
  ...
  template:
    metadata:
    ...
    spec:
      affinity:
        nodeAffinity:
          ...
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                - 192.168.0.4   # å‡è®¾ä½ æƒ³è°ƒåº¦åˆ°è¿™å°ä¸»æœºä¸Š
      ...
      dnsPolicy: ClusterFirstWithHostNet
      hostNetwork: true
      restartPolicy: Always
      ...
</code></pre>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ Gateway çš„ URL æ¥è®¿é—®æœåŠ¡ç½‘æ ¼ä¸­çš„æœåŠ¡äº†ã€‚åé¢æˆ‘ä¼šå¼€å¯ä¸€ç³»åˆ—å®éªŒæ•™ç¨‹ï¼Œæœ¬æ–‡çš„æ‰€æœ‰æ­¥éª¤éƒ½æ˜¯ä¸ºåé¢åšå‡†å¤‡ï¼Œå¦‚æœæƒ³è·Ÿç€æˆ‘åšåé¢çš„å®éªŒï¼Œè¯·åŠ¡å¿…åšå¥½æœ¬æ–‡æ‰€è¿°çš„å‡†å¤‡å·¥ä½œã€‚</p>

         
	 
	 <br />
	 <div style="text-align:center;color: #ccc;font-size:16px;font-family: cursive;">-------ä»–æ—¥æ±Ÿæ¹–ç›¸é€¢ <i class="fa fa-umbrella" style="color:#986dbd"></i> å†å½“æ¯é…’è¨€æ¬¢-------</div>
         
           

<div class="entry-shang text-center">
	<p>ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</p>
        <button class="zs show-zs btn rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"> <span>èµ</span> </button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">Ã—</button>
		<span class="author"><img src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg"/>ç±³å¼€æœ—åŸºæ¨</span>
		<p class="tip"><i></i><span>çœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™</span></p>
 	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2å…ƒ</button>
			<button class="btn btn-blink" data-num="5">5å…ƒ</button>
			<button class="btn btn-blink" data-num="10">10å…ƒ</button>
			<button class="btn btn-blink" data-num="50">50å…ƒ</button>
			<button class="btn btn-blink" data-num="100">100å…ƒ</button>
			<button class="btn btn-blink" data-num="1">ä»»æ„é‡‘é¢</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2å…ƒ</button>
			<p>ä½¿ç”¨<span id="pay-type">å¾®ä¿¡</span>æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
			<img src="/img/wechat-2.png" id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
                <span class="zs-wechat"><img src="/img/wechat-btn.png"/></span>
	</div>
</div>

         

        
          <div class="blog-tags">
            
              <a href="https://fuckcloudnative.io/tags/istio/"><i class="fa fa-tags"></i>istio</a>&nbsp;
            
              <a href="https://fuckcloudnative.io/tags/service-mesh/"><i class="fa fa-tags"></i>service mesh</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
	      <a href="//service.weibo.com/share/share.php?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;title=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;pic=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2f20191215002051.png" target="_blank" title="åˆ†äº«åˆ°å¾®åš">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
      
      <li>
	      <a href="//connect.qq.com/widget/shareqq/index.html?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;title=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;source=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;desc=%e6%9c%ac%e6%96%87%e5%b0%86%e4%bc%9a%e5%91%8a%e8%af%89%e4%bd%a0%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20istioctl%20%e9%83%a8%e7%bd%b2%20istio%201.4%ef%bc%8c%e5%b9%b6%e5%bc%80%e5%90%af%20istio%20CNI%20%e6%8f%92%e4%bb%b6%e3%80%82&amp;pics=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2f20191215002051.png&amp;summary=%e6%9c%ac%e6%96%87%e5%b0%86%e4%bc%9a%e5%91%8a%e8%af%89%e4%bd%a0%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%20istioctl%20%e9%83%a8%e7%bd%b2%20istio%201.4%ef%bc%8c%e5%b9%b6%e5%bc%80%e5%90%af%20istio%20CNI%20%e6%8f%92%e4%bb%b6%e3%80%82" target="_blank" title="åˆ†äº«åˆ° QQ">
          <i class="fab fa-qq"></i>
        </a>
      </li>
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;text=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97&amp;via=RyangYang1" target="_blank" title="åˆ†äº«åˆ° Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f" target="_blank" title="åˆ†äº«åˆ° Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
	      <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fistio-deploy%2f&amp;title=Istio%201.4%20%e9%83%a8%e7%bd%b2%e6%8c%87%e5%8d%97" target="_blank" title="åˆ†äº«åˆ° LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">ç›¸å…³æ¨è</h4>
                  <ul>
                
                
                    <li><a href="/posts/istio-1.3-tour/">æ‰‹æŠŠæ‰‹æ•™ä½ éƒ¨ç½² Istio 1.3</a></li>
                
                    <li><a href="/posts/istio-1.3/">Istio 1.3 å‘å¸ƒï¼ŒHTTP é¥æµ‹ä¸å†éœ€è¦ Mixer</a></li>
                
                    <li><a href="/posts/circuit_breaking-and-outlier-detection-in-istio/">ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨</a></li>
                
                    <li><a href="/posts/life-of-a-packet-through-istio/">æ•°æ®åŒ…åœ¨ Istio ç½‘æ ¼ä¸­çš„ç”Ÿå‘½å‘¨æœŸ</a></li>
                
                    <li><a href="/posts/conflictingvirtualservicehost/">Istio ä¸­ VirtualService çš„æ³¨æ„äº‹é¡¹</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fuckcloudnative.io/posts/font-spider-plus/" data-toggle="tooltip" data-placement="top" title="ä½¿ç”¨ font-spider å¯¹ webfont ç½‘é¡µå­—ä½“è¿›è¡Œå‹ç¼©">&larr; å‰ä¸€ç¯‡</a>
            </li>
          
          
            <li class="next">
              <a href="https://fuckcloudnative.io/posts/use-nftables-as-firewall/" data-toggle="tooltip" data-placement="top" title="nftables åŸºç¡€æ•™ç¨‹ï¼šä½¿ç”¨ nftables ä½œä¸ºé˜²ç«å¢™">åä¸€ç¯‡ &rarr;</a>
            </li>
          
        </ul>
      

      
	    <link rel="stylesheet" href="https://fuckcloudnative.io/css/iDisqus.min.css" />
<div id="comment"></div>
<script src="https://fuckcloudnative.io/js/iDisqus.min.js"></script>
<script>
var disq = new iDisqus('comment', {
    forum: 'fuckcloudnative',
    api: 'https://disqus.fuckcloudnative.io',
    site: 'http://fuckcloudnative.io',
    emojiPath: 'https://api.fooleap.org/emoji/unicode/',
    mode: 2,
    timeout: 15,
    init: true
});
</script>

      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:yangchuansheng33@gmail.com" target="_blank" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-13-%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E6%A8%AA%E7%89%88%E4%BA%8C%E7%BB%B4%E7%A0%81_2019.05.17.1.1.png" target="_blank" title="Weixin">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/yangchuansheng" target="_blank" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/RyangYang1" target="_blank" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/yang-ryan-b6659b106" target="_blank" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://weibo.com/3496206342" target="_blank" title="å¾®åš">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://drive.google.com/drive/folders/0By_W-zIhlMXqSGJyU3pHaVVpV2M" target="_blank" title="è§†é¢‘åˆ†äº«">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-google-drive fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://fuckcloudnative.io/index.xml" target="_blank" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
	<br />
        <p class="credits copyright text-muted">
	  &nbsp;&bull;&nbsp;&copy;2019
          
            
              <a href="https://fuckcloudnative.io">ç±³å¼€æœ—åŸºæ¨</a>
            
          

          &nbsp;&bull;&nbsp;æ›´æ–°äº
          
            2019 å¹´ 12 æœˆ 19 æ—¥
          

	  &nbsp;&bull;&nbsp;
          <a href="https://fuckcloudnative.io/tags/">æ‰€æœ‰æ–‡ç« </a>

	  
        </p>
        <p class="credits theme-by text-muted">
        <br />
        <span id="busuanzi_container_site_pv">
            æœ¬ç«™å·²è¢«è®¿é—® <span id="busuanzi_value_site_pv"></span> æ¬¡å•¦
        </span>
        <span id="busuanzi_container_site_uv">
            &ensp;|&ensp;&thinsp;æ‚¨æ˜¯ç¬¬ <span id="busuanzi_value_site_uv"></span> ä½åˆ°è®¿çš„å°ä¼™ä¼´
        </span>
        </p>
        
        <p class="credits theme-by text-muted">
          ç”± <a href="https://gohugo.io">Hugo v0.59.0</a> å¼ºåŠ›é©±åŠ¨ &nbsp;&bull;&nbsp; ä¸»é¢˜ <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> ç§»æ¤è‡ª <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
	  <section class="credits theme-by text-muted" align="center">
    <span class="footer__copyright">
    <div>
    <span id="span_dt_dt"> </span>
    <script language="javascript">
      function show_date_time(){
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date("7/8/2017 10:56:12");
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span_dt_dt.innerHTML="æœ¬ç«™å·²ç»å¼€å¿ƒè¿è¡Œ "+daysold+" å¤© "+hrsold+" å°æ—¶ "+minsold+" åˆ† "+seconds+" ç§’";
      }
      show_date_time();
    </script>
    </div>
</script>
</section>

	</p>
      </div>
    </div>
  </div>
</footer>


<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container',
        blogId: '10020-1569254413955-300',
        name: 'äº‘åŸç”Ÿå®éªŒå®¤',
        qrcode: 'https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/wechat.gif',
        keyword: 'vip',
    });
</script>
<script src='/js/bundle.min.13b2d74fbe48bdf362a1e1572571a00fa30ef02c3fa8f697c71a47c9462a759a.js' integrity='sha256-E7LXT75IvfNioeFXJXGgD6MO8Cw/qPaXxxpHyUYqdZo='></script>






<script src="https://fuckcloudnative.io/js/load-photoswipe.js"></script>








<div class="rocket"><img src="/img/rocket_up.png" alt="" width="100" height="100"></div>
<script>
    $(function () {
      $(window).scroll(function () {
        
        if ($(window).scrollTop() >= 1000) {
          $('.rocket').stop().fadeIn(1000);
        }else {
          $('.rocket').stop().fadeOut(1000);
        }
      })
      
      $('.rocket').click(function () {
        $('html,body').stop().animate({scrollTop:0},400);
       
      })
    })

</script>




<script type="text/javascript">
      jQuery(function() {
          jQuery("img").lazyload({threshold: 0,effect: "fadeIn"});
      });
</script>











<script type="text/javascript">
$(document).ready(function () {
  $(window).scroll(function(){
    $(".top-scroll-bar").attr("style", "width: " + ($(this).scrollTop() / ($(document).height() - $(this).height()) * 100) + "%; display: block;");
  });
})
</script>


<script type="text/javascript">
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("Docker", "Kubernetes", "Prometheus", "Envoy", "Istio", "coredns", "Service Mesh", "Cloud Native");
        var $i = $("<span />").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        function randomColor() {
          var flakeColor = new Array("#FFDA65", "#00BFFF", "#BA55D3", "#FFA07A", "#87CEEB", "#FFB6C1");
          var snowColor = flakeColor[Math.floor(flakeColor.length * Math.random())];
          return snowColor;
        }
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": randomColor()
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>


    
  </body>
</html>

