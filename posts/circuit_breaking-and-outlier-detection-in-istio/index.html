<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨ - Kubernetes|Docker|Istio|Envoy|Hugo|Golang|äº‘åŸç”Ÿ</title>


  <meta content="circuit breaking, outlier detection, istio, envoy" name="keywords">

  <meta name="description" content="æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯ç†”æ–­ä»¥åŠå¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ç†”æ–­å’Œå¼‚å¸¸æ£€æµ‹æ¥ä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚">
  <meta name="author" content="ç±³å¼€æœ—åŸºæ¨"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "äº‘åŸç”Ÿå®éªŒå®¤",
    
    "url": "https:\/\/fuckcloudnative.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fuckcloudnative.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fuckcloudnative.io\/posts\/circuit_breaking-and-outlier-detection-in-istio\/",
          "name": "ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ istio ä¸­çš„åº”ç”¨"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "ç±³å¼€æœ—åŸºæ¨"
  },
  "headline": "ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨",
  "description" : "æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯ç†”æ–­ä»¥åŠå¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ç†”æ–­å’Œå¼‚å¸¸æ£€æµ‹æ¥ä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚",
  "inLanguage" : "zh",
  "wordCount":  4722 ,
  "datePublished" : "2018-12-28T17:23:43",
  "dateModified" : "2018-12-28T17:23:43",
  "image" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
  "keywords" : [ "istio, service mesh, kubernetes" ],
  "mainEntityOfPage" : "https:\/\/fuckcloudnative.io\/posts\/circuit_breaking-and-outlier-detection-in-istio\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fuckcloudnative.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hugo-picture.oss-cn-beijing.aliyuncs.com\/blog\/2019-08-26-WechatIMG12268.jpeg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨" />
<meta property="og:description" content="æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯ç†”æ–­ä»¥åŠå¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ç†”æ–­å’Œå¼‚å¸¸æ£€æµ‹æ¥ä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚">
<meta property="og:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
<meta property="og:url" content="https://fuckcloudnative.io/posts/circuit_breaking-and-outlier-detection-in-istio/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="äº‘åŸç”Ÿå®éªŒå®¤" />

  <meta name="twitter:title" content="ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨" />
  <meta name="twitter:description" content="æœ¬æ–‡å°†ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯ç†”æ–­ä»¥åŠå¦‚ä½•åœ¨ Istio ä¸­ä½¿ç”¨ç†”æ–­å’Œå¼‚å¸¸æ£€æµ‹æ¥ä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚">
  <meta name="twitter:image" content="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@RyangYang1" />
  <meta name="twitter:creator" content="@RyangYang1" />

  <link href='https://hugo-picture.oss-cn-beijing.aliyuncs.com/favicon-32x32.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.59.0" />
  <link rel="alternate" href="https://fuckcloudnative.io/index.xml" type="application/rss+xml" title="äº‘åŸç”Ÿå®éªŒå®¤">
  
  
  
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet">
  <link href="https://cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">


<link rel="stylesheet" href='/css/bundle.min.d217a6a11bc17dc3e103bef3ba21832728f51d46cb03c12302afe9b4245396fa.css' integrity='sha256-0hemoRvBfcPhA77zuiGDJyj1HUbLA8EjAq/ptCRTlvo='>





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?efe96f04908ae320df234a4f5626879e";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script src="https://fuckcloudnative.io/js/pace.min.js"></script>



<script src="https://fuckcloudnative.io/js/busuanzi.pure.mini.js"></script>
<script>
var int = setInterval(fixCount, 50);
function fixCount() {
    if (document.getElementById('busuanzi_container_site_uv').ownerDocument.defaultView.getComputedStyle(document.getElementById('busuanzi_container_site_uv'), null).display === 'inline') {
        clearInterval(int);
        document.getElementById('busuanzi_value_site_uv') = parseInt(document.getElementById('busuanzi_value_site_uv').innerHTML) + parseInt('100000');
    }
}
</script>







    <div class="top-scroll-bar"></div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-145022311-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">åˆ‡æ¢å¯¼èˆª</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="https://fuckcloudnative.io">ğŸ³ > $ cd /home/</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-dharmachakra fa-spin" style="color:#986dbd"></i> æ–‡ç« åˆ†ç±»</a>
              <div class="navlinks-children">
                
                  <a href="/categories/kubernetes/">kubernetes</a>
                
                  <a href="/categories/monitoring/">ç›‘æ§</a>
                
                  <a href="/categories/service-mesh/">Service Mesh</a>
                
                  <a href="/categories/devops/">DevOps</a>
                
                  <a href="/categories/docker/">Docker</a>
                
                  <a href="/categories/linux/">Linux</a>
                
                  <a href="/categories/python/">Python</a>
                
                  <a href="/categories/network/">ç½‘ç»œ</a>
                
                  <a href="/categories/loadbalance/"> è´Ÿè½½å‡è¡¡</a>
                
                  <a href="/categories/gfw/">ç§‘å­¦ä¸Šç½‘</a>
                
                  <a href="/categories/math/">æ•°å­¦</a>
                
                  <a href="/categories/share/">é»‘ç§‘æŠ€</a>
                
                  <a href="/categories/hugo/">Hugo</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fab fa-docker"></i> ç”µå­ä¹¦</a>
              <div class="navlinks-children">
                
                  <a href="/prometheus-handbook/">Prometheus ä¸­æ–‡æ–‡æ¡£</a>
                
                  <a href="/talent-is-overrated/">å¤©æ‰æºè‡ªåˆ»æ„ç»ƒä¹ </a>
                
                  <a href="/the-way-to-go/">Go å…¥é—¨æŒ‡å—</a>
                
                  <a href="https://github.com/fengdu78/Coursera-ML-AndrewNg-Notes">æœºå™¨å­¦ä¹ ç¬”è®°</a>
                
                  <a href="https://github.com/ruanyf/reading-list">é˜®ä¸€å³°ä¹¦å•</a>
                
                  <a href="https://istio.io/zh/docs">Istio service mesh</a>
                
                  <a href="https://www.gitbook.com/book/yeasy/docker_practice">Docker handbook</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"><i class="fas fa-book"></i> è‘µèŠ±å®å…¸</a>
              <div class="navlinks-children">
                
                  <a href="/learn-english/"> è‹±è¯­å­¦ä¹ ç»ˆæç§˜è¯€</a>
                
                  <a href="/a-day-in-the-life-of-jeff/">A Day in the life of Jeff</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
		    <a class="navlinks-parent"> ğŸ˜±ç¦åˆ©</a>
              <div class="navlinks-children">
                
                  <a href="https://google.fuckcloudnative.io">è°·æ­Œæœç´¢</a>
                
                  <a href="https://bt.fuckcloudnative.io">ç§å­æœç´¢</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Rss è®¢é˜…" href="/index.xml">Rss è®¢é˜…</a>
            </li>
          
        

        

        
        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">æœç´¢</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="äº‘åŸç”Ÿå®éªŒå®¤" href="https://fuckcloudnative.io">
            <img class="avatar-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg" alt="äº‘åŸç”Ÿå®éªŒå®¤" />
          </a>
        </div>
      </div>
    

  </div>
</nav>





  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search fuckcloudnative.io</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>


<script src="https://fuckcloudnative.io/js/algoliasearch.min.js"></script>
<script src="https://fuckcloudnative.io/js/autocomplete.min.js"></script>


<script>
var client = algoliasearch("4BELQK2TOI", "62fd06bd949abb4211bfab0aa288f67b");
var index = client.initIndex('blog');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            
            return '<span>' + '<a href="/' + suggestion.uri+ '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>


    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1 
      
         
          data-img-src-1="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-04-27-080627.jpg" 
         
         
      ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
		  
		      <h1 align="center">ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨</h1>
		  
                  
                    
		      <hr class="small">
                      <h2 class="post-subheading">é€šè¿‡ Istio æ¥çª¥æ¢ Envoy çš„ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹æœºåˆ¶</h2>
                    
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;å‘è¡¨äº 2018 å¹´ 12 æœˆ 28 æ—¥
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;10&nbsp;åˆ†é’Ÿ
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;4722&nbsp;ä¸ªå­—
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
  
</span>

                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹åœ¨ Istio ä¸­çš„åº”ç”¨</h1>
              
              
              
                
                  <h2 class="post-subheading">é€šè¿‡ Istio æ¥çª¥æ¢ Envoy çš„ç†”æ–­ä¸å¼‚å¸¸æ£€æµ‹æœºåˆ¶</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;å‘è¡¨äº 2018 å¹´ 12 æœˆ 28 æ—¥
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;10&nbsp;åˆ†é’Ÿ
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;4722&nbsp;ä¸ªå­—
  
  
    
    
  
  &nbsp;|&nbsp;<i class="fas fa-book-reader"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>æ¬¡é˜…è¯»
  
</span>

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div id="container" class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <a title="æ¬ç“¦å·¥" href="https://bandwagonhost.com/aff.php?aff=54207" target="_blank">
<p id="sponsor-text" style="box-sizing: border-box;
    text-align: center;
    width: 100%;
    border: 1px solid #e5e4e9;
    background-color: #d0e4a9;
    margin: 1em 0 0;
    padding: 0.6em 0.6em 0.4em 0.6em;
    border-radius: 0.3em 0.3em 0.1em 0.1em;
    color: #076a66;"><span style="text-decoration: underline;">æ¬ç“¦å·¥</span>é¦™æ¸¯ VPS CN2ï¼Œè¶…ä½ä»· <span style="text-decoration: underline;">$2.99/å¹´</span>èµ·ã€‚é€‚åˆæ–°æ‰‹å…¥é—¨å»ºç«™ï¼Œæˆ‘çš„åšå®¢å°±æ˜¯åœ¨è¿™ä¸Šé¢æ­å»ºçš„</p>
<p style="padding:0em;margin:0 0 1.5em 0;border: 1px solid #e5e4e9;border-radius: 0.1em 0.1em 0.3em 0.3em;background-color: #28344a;text-align: center;" class="entry-sponsor-img">
  <img alt="æ¬ç“¦å·¥" id="support-img" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/bandwagonhost.jpg" style="border: none;width: 100%;max-width: 100%;display: inline-block;">

</p>
</a>

      <article role="main" class="blog-post">
	
<aside class="toc">
    <div id='anchors-navbar'>
        <i class='fa fa-anchor'></i>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#span-id-inline-toc-1-span-ä»€ä¹ˆæ˜¯ç†”æ–­"><span id="inline-toc">1.</span> ä»€ä¹ˆæ˜¯ç†”æ–­ï¼Ÿ</a></li>
<li><a href="#span-id-inline-toc-2-span-istio-ä¸­çš„ç†”æ–­"><span id="inline-toc">2.</span> Istio ä¸­çš„ç†”æ–­</a>
<ul>
<li><a href="#éƒ¨ç½²ç¤ºä¾‹">éƒ¨ç½²ç¤ºä¾‹</a></li>
<li><a href="#æœ€å¤§è¿æ¥æ•°">æœ€å¤§è¿æ¥æ•°</a></li>
<li><a href="#å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—">å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—</a></li>
<li><a href="#å¦‚æœæœåŠ¡å®Œå…¨å´©æºƒæ€ä¹ˆåŠ">å¦‚æœæœåŠ¡å®Œå…¨å´©æºƒæ€ä¹ˆåŠï¼Ÿ</a>
<ul>
<li><a href="#å¼‚å¸¸æ£€æµ‹çš„éš”ç¦»ç®—æ³•">å¼‚å¸¸æ£€æµ‹çš„éš”ç¦»ç®—æ³•</a></li>
<li><a href="#å¼‚å¸¸æ£€æµ‹ç±»å‹">å¼‚å¸¸æ£€æµ‹ç±»å‹</a></li>
<li><a href="#å¼‚å¸¸æ£€æµ‹ç¤ºä¾‹">å¼‚å¸¸æ£€æµ‹ç¤ºä¾‹</a></li>
</ul></li>
</ul></li>
<li><a href="#span-id-inline-toc-3-span-å‚è€ƒèµ„æ–™"><span id="inline-toc">3.</span> å‚è€ƒèµ„æ–™</a></li>
</ul></li>
</ul>
</nav>
    </div>
    
</aside>


        
         

         
           
           

<p>åœ¨å¾®æœåŠ¡é¢†åŸŸï¼Œå„ä¸ªæœåŠ¡éœ€è¦åœ¨ç½‘ç»œä¸Šæ‰§è¡Œå¤§é‡çš„è°ƒç”¨ã€‚è€Œç½‘ç»œæ˜¯å¾ˆè„†å¼±çš„ï¼Œå¦‚æœæŸä¸ªæœåŠ¡ç¹å¿™æˆ–è€…æ— æ³•å“åº”è¯·æ±‚ï¼Œå°†æœ‰å¯èƒ½å¼•å‘é›†ç¾¤çš„å¤§è§„æ¨¡çº§è”æ•…éšœï¼Œä»è€Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ï¼Œé€šå¸¸æŠŠè¿™ç§ç°è±¡ç§°ä¸º <span id="inline-purple">æœåŠ¡é›ªå´©æ•ˆåº”</span>ã€‚ä¸ºäº†ä½¿æœåŠ¡æœ‰ä¸€å®šçš„å†—ä½™ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿæ•…éšœæœŸé—´èƒ½å¤Ÿä¿æŒæœåŠ¡èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç†”æ–­æœºåˆ¶ã€‚</p>

<h2 id="span-id-inline-toc-1-span-ä»€ä¹ˆæ˜¯ç†”æ–­"><span id="inline-toc">1.</span> ä»€ä¹ˆæ˜¯ç†”æ–­ï¼Ÿ</h2>

<hr />

<p>ç†”æ–­ï¼ˆCircuit Breakingï¼‰è¿™ä¸€æ¦‚å¿µæ¥æºäºç”µå­å·¥ç¨‹ä¸­çš„<strong>æ–­è·¯å™¨</strong>ï¼ˆCircuit Breakerï¼‰ã€‚åœ¨äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› è®¿é—®å‹åŠ›è¿‡å¤§è€Œå“åº”å˜æ…¢æˆ–å¤±è´¥ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼Œå¯ä»¥æš‚æ—¶åˆ‡æ–­å¯¹ä¸‹æ¸¸æœåŠ¡çš„è°ƒç”¨ã€‚è¿™ç§ç‰ºç‰²å±€éƒ¨ï¼Œä¿å…¨æ•´ä½“çš„æªæ–½å°±å«åš<strong>ç†”æ–­</strong>ã€‚</p>

<p>å¦‚æœä¸é‡‡å–ç†”æ–­æªæ–½ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¼šæ€æ ·å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ —å­ã€‚</p>

<p>å½“å‰ç³»ç»Ÿä¸­æœ‰ Aã€Bã€C ä¸‰ä¸ªæœåŠ¡ï¼ŒæœåŠ¡ A æ˜¯ä¸Šæ¸¸ï¼ŒæœåŠ¡ B æ˜¯ä¸­æ¸¸ï¼ŒæœåŠ¡ C æ˜¯ä¸‹æ¸¸ã€‚å®ƒä»¬çš„è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>


<link rel="stylesheet" href="https://fuckcloudnative.io/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/post_loading.gif" data-original="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking.svg" alt="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking.svg"/>
    </div>
    <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking.svg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>ä¸€æ—¦ä¸‹æ¸¸æœåŠ¡ C å› æŸäº›åŸå› å˜å¾—ä¸å¯ç”¨ï¼Œç§¯å‹äº†å¤§é‡è¯·æ±‚ï¼ŒæœåŠ¡ B çš„è¯·æ±‚çº¿ç¨‹ä¹Ÿéšä¹‹é˜»å¡ã€‚çº¿ç¨‹èµ„æºé€æ¸è€—å°½ï¼Œä½¿å¾—æœåŠ¡ B ä¹Ÿå˜å¾—ä¸å¯ç”¨ã€‚ç´§æ¥ç€ï¼ŒæœåŠ¡ A ä¹Ÿå˜ä¸ºä¸å¯ç”¨ï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯è¢«æ‹–å®ã€‚</p>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/post_loading.gif" data-original="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking1.svg" alt="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking1.svg"/>
    </div>
    <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking1.svg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>åƒè¿™ç§è°ƒç”¨é“¾è·¯çš„è¿é”æ•…éšœï¼Œå°±æ˜¯ä¸Šæ–‡æ‰€è¯´çš„æœåŠ¡é›ªå´©æ•ˆåº”ã€‚</p>

<p>æ­£æ‰€è°“åˆ®éª¨ç–—æ¯’ï¼Œå£®å£«æ–­è…•ã€‚åœ¨è¿™ç§æ—¶å€™ï¼Œå°±éœ€è¦æˆ‘ä»¬çš„ç†”æ–­æœºåˆ¶æ¥æŒ½æ•‘æ•´ä¸ªç³»ç»Ÿã€‚ç†”æ–­æœºåˆ¶çš„å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/post_loading.gif" data-original="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking3.svg" alt="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking3.svg"/>
    </div>
    <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/circuit-breaking3.svg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>è¿™é‡Œéœ€è¦è§£é‡Šä¸¤ç‚¹ï¼š</p>

<ul>
<li>å¼€å¯ç†”æ–­ï¼šåœ¨å›ºå®šæ—¶é—´çª—å£å†…ï¼Œæ¥å£è°ƒç”¨è¶…æ—¶æ¯”ç‡è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼Œä¼šå¼€å¯ç†”æ–­ã€‚è¿›å…¥ç†”æ–­çŠ¶æ€åï¼Œåç»­å¯¹è¯¥æœåŠ¡æ¥å£çš„è°ƒç”¨ä¸å†ç»è¿‡ç½‘ç»œï¼Œç›´æ¥æ‰§è¡Œæœ¬åœ°çš„é»˜è®¤æ–¹æ³•ï¼Œè¾¾åˆ°æœåŠ¡é™çº§çš„æ•ˆæœã€‚</li>
<li>ç†”æ–­æ¢å¤ï¼šç†”æ–­ä¸å¯èƒ½æ˜¯æ°¸ä¹…çš„ï¼Œå½“ç»è¿‡äº†è§„å®šæ—¶é—´ä¹‹åï¼ŒæœåŠ¡å°†ä»ç†”æ–­çŠ¶æ€æ¢å¤è¿‡æ¥ï¼Œå†æ¬¡æ¥å—è°ƒç”¨æ–¹çš„è¿œç¨‹è°ƒç”¨ã€‚</li>
</ul>

<h2 id="span-id-inline-toc-2-span-istio-ä¸­çš„ç†”æ–­"><span id="inline-toc">2.</span> Istio ä¸­çš„ç†”æ–­</h2>

<hr />

<p>Istio æ˜¯é€šè¿‡ Envoy Proxy æ¥å®ç°ç†”æ–­æœºåˆ¶çš„ï¼ŒEnvoy å¼ºåˆ¶åœ¨ç½‘ç»œå±‚é¢é…ç½®ç†”æ–­ç­–ç•¥ï¼Œè¿™æ ·å°±ä¸å¿…ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºå•ç‹¬é…ç½®æˆ–é‡æ–°ç¼–ç¨‹ã€‚ä¸‹é¢å°±é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•ä¸º Istio ç½‘æ ¼ä¸­çš„æœåŠ¡é…ç½®ç†”æ–­çš„è¿æ¥æ•°ã€è¯·æ±‚æ•°å’Œå¼‚å¸¸æ£€æµ‹ã€‚</p>

<p>è¯¥ç¤ºä¾‹çš„æ¶æ„å¦‚å›¾æ‰€ç¤ºï¼š</p>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/post_loading.gif" data-original="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/istio-circuit-break2.svg" alt="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/istio-circuit-break2.svg"/>
    </div>
    <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/istio-circuit-break2.svg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>è¯¥ç¤ºä¾‹ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»„æˆï¼Œå…¶ä¸­å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ª Java HTTP åº”ç”¨ç¨‹åºï¼Œè¢«æ‰“åŒ…åœ¨é•œåƒ <code>docker.io/ceposta/http-envoy-client-standalone:latest</code> ä¸­ï¼Œå®ƒç”¨æ¥æ¨¡æ‹Ÿå¯¹åç«¯æœåŠ¡ <code>httpbin</code> å‘èµ· http è°ƒç”¨ï¼Œæ‰€æœ‰çš„è°ƒç”¨é¦–å…ˆéƒ½ä¼šè¢« Envoy Proxy æ‹¦æˆªã€‚</p>

<style type="text/css">.notice{padding:18px;line-height:24px;margin-bottom:24px;margin-top:30px;border-radius:4px;color:#444;background:#e7f2fa}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de}.notice-title:before{margin-right:8px;font-family:"Font Awesome 5 Free",FontAwesome;font-weight:600}.notice.warning .notice-title{background:rgba(217,83,79,.9)}.notice.warning .notice-title:before{content:'\f071'}.notice.warning{background:#fae2e2}.notice.info .notice-title{background:#f0b37e}.notice.info .notice-title:before{content:'\f05a'}.notice.info{background:#fff2db}.notice.note .notice-title{background:#6ab0de}.notice.note .notice-title:before{content:'\f06a'}.notice.note{background:#e7f2fA}.notice.tip .notice-title{background:rgba(92,184,92,.8)}.notice.tip .notice-title:before{content:'\f058'}.notice.tip{background:#e6f9e6}</style><div class="notice note" >
<p class="first notice-title">æ³¨æ„</p><p>å‡è®¾ä½ çš„é›†ç¾¤ä¸­å·²ç»éƒ¨ç½²äº† Istioï¼Œæ²¡æœ‰å¯ç”¨ Sidecar çš„è‡ªåŠ¨æ³¨å…¥ï¼Œå¹¶ä¸”æ²¡æœ‰å¯ç”¨åŒå‘ TLS èº«ä»½éªŒè¯ã€‚</p></div>


<h3 id="éƒ¨ç½²ç¤ºä¾‹">éƒ¨ç½²ç¤ºä¾‹</h3>

<p>éƒ¨ç½² <a href="https://github.com/istio/istio/tree/master/samples/httpbin" target="_blank">httpbin</a> åº”ç”¨ï¼Œè¯¥åº”ç”¨å°†ä¼šä½œä¸ºæœ¬ç¤ºä¾‹çš„åç«¯æœåŠ¡ï¼š</p>

<pre><code class="language-bash"># è¿›å…¥ istio æ ¹ç›®å½•
$ kubectl apply -f &lt;(istioctl kube-inject -f samples/httpbin/httpbin.yaml)
</code></pre>

<p>åˆ›å»ºä¸€ä¸ª <code>DestinationRule</code>ï¼Œé’ˆå¯¹ <code>httpbin</code> æœåŠ¡è®¾ç½®ç†”æ–­ç­–ç•¥ï¼š</p>

<pre><code class="language-yaml">$ kubectl apply -f - &lt;&lt;EOF
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: httpbin
spec:
  host: httpbin
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 1
      http:
        http1MaxPendingRequests: 1
        maxRequestsPerConnection: 1
    outlierDetection:
      consecutiveErrors: 2
      interval: 1s
      baseEjectionTime: 3m
      maxEjectionPercent: 100
EOF
</code></pre>

<p>æŸ¥çœ‹è¯¥ç­–ç•¥åœ¨ Envoy ä¸­å¯¹åº”çš„ <code>Cluster</code> é…ç½®ï¼š</p>

<pre><code class="language-bash">$ kubectl get pod -l app=httpbin

NAME                      READY     STATUS    RESTARTS   AGE
httpbin-d6d68fb97-cswzc   2/2       Running   0          2m
</code></pre>

<pre><code class="language-json">$ istioctl pc cluster httpbin-d6d68fb97-cswzc --fqdn httpbin.default.svc.cluster.local --direction outbound -o json

[
    {
        &quot;name&quot;: &quot;outbound|8000||httpbin.default.svc.cluster.local&quot;,
        &quot;type&quot;: &quot;EDS&quot;,
        &quot;edsClusterConfig&quot;: {
            &quot;edsConfig&quot;: {
                &quot;ads&quot;: {}
            },
            &quot;serviceName&quot;: &quot;outbound|8000||httpbin.default.svc.cluster.local&quot;
        },
        &quot;connectTimeout&quot;: &quot;1.000s&quot;,
        &quot;maxRequestsPerConnection&quot;: 1,
        &quot;circuitBreakers&quot;: {
            &quot;thresholds&quot;: [
                {
                    &quot;maxConnections&quot;: 1,
                    &quot;maxPendingRequests&quot;: 1
                }
            ]
        },
        &quot;outlierDetection&quot;: {
            &quot;interval&quot;: &quot;1.000s&quot;,
            &quot;baseEjectionTime&quot;: &quot;180.000s&quot;,
            &quot;maxEjectionPercent&quot;: 100,
            &quot;enforcingConsecutive5xx&quot;: 0,
            &quot;consecutiveGatewayFailure&quot;: 2,
            &quot;enforcingConsecutiveGatewayFailure&quot;: 100
        }
    }
]
</code></pre>

<p>ä¸Šé¢çš„é…ç½®å‘Šè¯‰æˆ‘ä»¬ï¼š</p>

<ul>
<li><strong>maxConnections</strong> : é™åˆ¶å¯¹åç«¯æœåŠ¡å‘èµ·çš„ <code>HTTP/1.1</code> è¿æ¥æ•°ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šå¼€å¯ç†”æ–­ã€‚</li>
<li><strong>maxPendingRequests</strong> : é™åˆ¶å¾…å¤„ç†è¯·æ±‚åˆ—è¡¨çš„é•¿åº¦ï¼Œ å¦‚æœè¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šå¼€å¯ç†”æ–­ã€‚</li>
<li><strong>maxRequestsPerConnection</strong> : åœ¨ä»»ä½•ç»™å®šæ—¶é—´å†…é™åˆ¶å¯¹åç«¯æœåŠ¡å‘èµ·çš„ <code>HTTP/2</code> è¯·æ±‚æ•°ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šå¼€å¯ç†”æ–­ã€‚</li>
</ul>

<p>ä¸‹é¢åˆ†åˆ«å¯¹è¿™å‡ ä¸ªå‚æ•°åšè¯¦ç»†è§£é‡Šã€‚</p>

<ul>
<li><span id="inline-purple">maxConnections</span> : è¡¨ç¤ºåœ¨ä»»ä½•ç»™å®šæ—¶é—´å†…ï¼Œ Envoy ä¸ä¸Šæ¸¸é›†ç¾¤ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ httpbin æœåŠ¡ï¼‰å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ã€‚è¯¥é…ç½®ä»…é€‚ç”¨äº <code>HTTP/1.1</code> åè®®ï¼Œå› ä¸º <code>HTTP/2</code> åè®®å¯ä»¥åœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè€Œ <code>HTTP/1.1</code> åè®®åœ¨åŒä¸€ä¸ªè¿æ¥ä¸­åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼ˆå³æ–­è·¯å™¨æº¢å‡ºï¼‰ï¼Œé›†ç¾¤çš„<a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/cluster_manager/cluster_stats#config-cluster-manager-cluster-stats" target="_blank">upstream_cx_overflow</a> è®¡æ•°å™¨å°±ä¼šé€’å¢ã€‚</li>
<li><span id="inline-purple">maxPendingRequests</span> : è¡¨ç¤ºå¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ã€‚å› ä¸º <code>HTTP/2</code> æ˜¯é€šè¿‡å•ä¸ªè¿æ¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚çš„ï¼Œå› æ­¤è¯¥ç†”æ–­ç­–ç•¥ä»…åœ¨åˆ›å»ºåˆå§‹ <code>HTTP/2</code> è¿æ¥æ—¶æœ‰ç”¨ï¼Œä¹‹åçš„è¯·æ±‚å°†ä¼šåœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸Šå¤šè·¯å¤ç”¨ã€‚å¯¹äº <code>HTTP/1.1</code> åè®®ï¼Œåªè¦æ²¡æœ‰è¶³å¤Ÿçš„ä¸Šæ¸¸è¿æ¥å¯ç”¨äºç«‹å³åˆ†æ´¾è¯·æ±‚ï¼Œå°±ä¼šå°†è¯·æ±‚æ·»åŠ åˆ°å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼Œå› æ­¤è¯¥æ–­è·¯å™¨å°†åœ¨è¯¥è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒæœ‰æ•ˆã€‚å¦‚æœè¯¥æ–­è·¯å™¨æº¢å‡ºï¼Œé›†ç¾¤çš„ <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/cluster_manager/cluster_stats#config-cluster-manager-cluster-stats" target="_blank">upstream_rq_pending_overflow</a> è®¡æ•°å™¨å°±ä¼šé€’å¢ã€‚</li>
<li><span id="inline-purple">maxRequestsPerConnection</span> : è¡¨ç¤ºåœ¨ä»»ä½•ç»™å®šæ—¶é—´å†…ï¼Œä¸Šæ¸¸é›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ httpbin æœåŠ¡ï¼‰å¯ä»¥å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ã€‚å®é™…ä¸Šï¼Œè¿™é€‚ç”¨äºä»… <code>HTTP/2</code> é›†ç¾¤ï¼Œå› ä¸º <code>HTTP/1.1</code> é›†ç¾¤ç”±æœ€å¤§è¿æ¥æ•°æ–­è·¯å™¨æ§åˆ¶ã€‚å¦‚æœè¯¥æ–­è·¯å™¨æº¢å‡ºï¼Œé›†ç¾¤çš„ <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/cluster_manager/cluster_stats#config-cluster-manager-cluster-stats" target="_blank">upstream_rq_pending_overflow</a> è®¡æ•°å™¨å°±ä¼šé€’å¢ã€‚</li>
</ul>

<p>Istio DestinationRule ä¸ Envoy çš„ç†”æ–­å‚æ•°å¯¹ç…§è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<table>
<thead>
<tr>
<th align="center">Envoy paramether</th>
<th align="center">Envoy upon object</th>
<th align="center">Istio parameter</th>
<th align="center">Istio upon ojbect</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">max_connections</td>
<td align="center">cluster.circuit_breakers</td>
<td align="center">maxConnections</td>
<td align="center">TCPSettings</td>
</tr>

<tr>
<td align="center">max_pending_requests</td>
<td align="center">cluster.circuit_breakers</td>
<td align="center">http1MaxPendingRequests</td>
<td align="center">HTTPSettings</td>
</tr>

<tr>
<td align="center">max_requests</td>
<td align="center">cluster.circuit_breakers</td>
<td align="center">http2MaxRequests</td>
<td align="center">HTTPSettings</td>
</tr>

<tr>
<td align="center">max_retries</td>
<td align="center">cluster.circuit_breakers</td>
<td align="center">maxRetries</td>
<td align="center">HTTPSettings</td>
</tr>

<tr>
<td align="center">connect_timeout_ms</td>
<td align="center">cluster</td>
<td align="center">connectTimeout</td>
<td align="center">TCPSettings</td>
</tr>

<tr>
<td align="center">max_requests_per_connection</td>
<td align="center">cluster</td>
<td align="center">maxRequestsPerConnection</td>
<td align="center">HTTPSettings</td>
</tr>
</tbody>
</table>

<h3 id="æœ€å¤§è¿æ¥æ•°">æœ€å¤§è¿æ¥æ•°</h3>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»ä¸º <code>httpbin</code> æœåŠ¡è®¾ç½®äº†ç†”æ–­ç­–ç•¥ï¼Œæ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ª Java å®¢æˆ·ç«¯ï¼Œç”¨æ¥å‘åç«¯æœåŠ¡å‘é€è¯·æ±‚ï¼Œè§‚å¯Ÿæ˜¯å¦ä¼šè§¦å‘ç†”æ–­ç­–ç•¥ã€‚è¿™ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ§åˆ¶è¿æ¥æ•°é‡ã€å¹¶å‘æ•°ã€å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—ï¼Œä½¿ç”¨è¿™ä¸€å®¢æˆ·ç«¯ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„è§¦å‘å‰é¢åœ¨ç›®æ ‡è§„åˆ™ä¸­è®¾ç½®çš„ç†”æ–­ç­–ç•¥ã€‚è¯¥å®¢æˆ·ç«¯çš„ deployment yaml å†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-yaml"># httpbin-client-deploy.yaml
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: httpbin-client-v1
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: httpbin-client
        version: v1
    spec:
      containers:
      - image: ceposta/http-envoy-client-standalone:latest
        imagePullPolicy: IfNotPresent
        name: httpbin-client
        command: [&quot;/bin/sleep&quot;,&quot;infinity&quot;]
</code></pre>

<p>è¿™é‡Œæˆ‘ä»¬ä¼šæŠŠç»™å®¢æˆ·ç«¯ä¹Ÿè¿›è¡Œ Sidecar çš„æ³¨å…¥ï¼Œä»¥æ­¤ä¿è¯ Istio å¯¹ç½‘ç»œäº¤äº’çš„æ§åˆ¶ï¼š</p>

<pre><code class="language-bash">$ kubectl apply -f &lt;(istioctl kube-inject -f httpbin-client-deploy.yaml)
</code></pre>

<p>ä¸‹é¢æ¥è§‚å¯Ÿä¸€ä¸‹å½“å®¢æˆ·ç«¯è¯•å›¾ä½¿ç”¨å¤ªå¤šçº¿ç¨‹ä¸ä¸Šæ¸¸é›†ç¾¤å»ºç«‹å¹¶å‘è¿æ¥æ—¶ï¼ŒEnvoy ä¼šå¦‚ä½•åº”å¯¹ã€‚</p>

<p>åœ¨ä¸Šé¢çš„ç†”æ–­è®¾ç½®ä¸­æŒ‡å®šäº† <code>maxConnections: 1</code> ä»¥åŠ <code>http1MaxPendingRequests: 1</code>ã€‚è¿™æ„å‘³ç€å¦‚æœè¶…è¿‡äº†ä¸€ä¸ªè¿æ¥åŒæ—¶å‘èµ·è¯·æ±‚ï¼ŒIstio å°±ä¼šç†”æ–­ï¼Œé˜»æ­¢åç»­çš„è¯·æ±‚æˆ–è¿æ¥ã€‚</p>

<p>å…ˆå°è¯•é€šè¿‡å•çº¿ç¨‹ï¼ˆ<code>NUM_THREADS=1</code>ï¼‰åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œå¹¶è¿›è¡Œ 5 æ¬¡è°ƒç”¨ï¼ˆé»˜è®¤å€¼ï¼š<code>NUM_CALLS_PER_CLIENT=5</code>ï¼‰ï¼š</p>

<pre><code class="language-bash">$ CLIENT_POD=$(kubectl get pod | grep httpbin-client | awk '{ print $1 }')
$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/get export NUM_THREADS=1 &amp;&amp; java -jar http-client.jar'

using num threads: 1
Starting pool-1-thread-1 with numCalls=5 delayBetweenCalls=0 url=http://localhost:15001/get mixedRespTimes=false
pool-1-thread-1: successes=[5], failures=[0], duration=[545ms]
</code></pre>

<p>å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡äº†ï¼š</p>

<pre><code class="language-bash">successes=[5]
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ istio-proxy çš„çŠ¶æ€ï¼Œè·å–æ›´å¤šç›¸å…³ä¿¡æ¯ï¼š</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin

...
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_http1_total: 5
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_overflow: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_total: 5
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_200: 5
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_2xx: 5
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_retry: 0
...
</code></pre>

<p>å¯ä»¥çœ‹å‡ºæ€»å…±å‘é€äº† 5 ä¸ª <code>HTTP/1.1</code> è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ 5 ä¸ªè¯·æ±‚ï¼Œå“åº”ç å‡ä¸º <code>200</code>ã€‚</p>

<p>ä¸‹é¢å°è¯•æŠŠçº¿ç¨‹æ•°æé«˜åˆ° 2ï¼š</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/get export NUM_THREADS=2 &amp;&amp; java -jar http-client.jar'

using num threads: 2
Starting pool-1-thread-1 with numCalls=5 parallelSends=false delayBetweenCalls=0 url=http://httpbin:8000/get mixedRespTimes=false
Starting pool-1-thread-2 with numCalls=5 parallelSends=false delayBetweenCalls=0 url=http://httpbin:8000/get mixedRespTimes=false
pool-1-thread-1: successes=[3], failures=[2], duration=[96ms]
pool-1-thread-2: successes=[4], failures=[1], duration=[87ms]
</code></pre>

<p>å†æ¬¡æŸ¥çœ‹ istio-proxy çš„çŠ¶æ€ï¼š</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin

...
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_http1_total: 7
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_overflow: 3
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_total: 10
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_200: 7
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_2xx: 7
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_503: 3
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_5xx: 3
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: 3
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_retry: 0
...
</code></pre>

<p>æ€»å…±å‘é€äº† 10 ä¸ª <code>HTTP/1</code> è¿æ¥ï¼Œåªæœ‰ 7 ä¸ª è¢«å…è®¸é€šè¿‡ï¼Œå‰©ä½™è¯·æ±‚è¢«æ–­è·¯å™¨æ‹¦æˆªäº†ã€‚å…¶ä¸­ <code>upstream_cx_overflow</code> çš„å€¼ä¸º 3ï¼Œè¡¨æ˜ <code>maxConnections</code> æ–­è·¯å™¨èµ·ä½œç”¨äº†ã€‚<code>Istio-proxy</code> å…è®¸ä¸€å®šçš„å†—ä½™ï¼Œä½ å¯ä»¥å°†çº¿ç¨‹æ•°æé«˜åˆ° 3ï¼Œç†”æ–­çš„æ•ˆæœä¼šæ›´æ˜æ˜¾ã€‚</p>

<h3 id="å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—">å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—</h3>

<p>æµ‹è¯•å®Œ <code>maxConnections</code> æ–­è·¯å™¨ä¹‹åï¼Œæˆ‘ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ <code>maxPendingRequests</code> æ–­è·¯å™¨ã€‚å‰é¢å·²ç»å°† <code>maxPendingRequests</code> çš„å€¼è®¾ç½®ä¸º 1ï¼Œç°åœ¨æŒ‰ç…§é¢„æƒ³ï¼Œæˆ‘ä»¬åªéœ€è¦æ¨¡æ‹Ÿåœ¨å•ä¸ª <code>HTTP/1.1</code> è¿æ¥ä¸­åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå°±å¯ä»¥è§¦å‘è¯¥æ–­è·¯å™¨å¼€å¯ç†”æ–­ã€‚ç”±äº <code>HTTP/1.1</code> åŒä¸€ä¸ªè¿æ¥åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå‰©ä¸‹çš„è¯·æ±‚åªèƒ½æ”¾åˆ°å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚é€šè¿‡é™åˆ¶å¾…å¤„ç†è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ï¼Œå¯ä»¥å¯¹æ¶æ„è¯·æ±‚ã€DoS å’Œç³»ç»Ÿä¸­çš„çº§è”é”™è¯¯èµ·åˆ°ä¸€å®šçš„ç¼“è§£ä½œç”¨ã€‚</p>

<p>ç°åœ¨å°è¯•é€šè¿‡å•çº¿ç¨‹ï¼ˆ<code>NUM_THREADS=1</code>ï¼‰åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œå¹¶åŒæ—¶å‘é€ 20 ä¸ªè¯·æ±‚ï¼ˆ<code>PARALLEL_SENDS=true</code>ï¼Œ<code>NUM_CALLS_PER_CLIENT=20</code>ï¼‰ï¼š</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/get export NUM_THREADS=1 export PARALLEL_SENDS=true export NUM_CALLS_PER_CLIENT=20 &amp;&amp; java -jar http-client.jar'

using num threads: 1
Starting pool-1-thread-1 with numCalls=20 parallelSends=true delayBetweenCalls=0 url=http://httpbin:8000/get mixedRespTimes=false
finished batch 0
finished batch 5
finished batch 10
finished batch 15
pool-1-thread-1: successes=[16], failures=[4], duration=[116ms]
</code></pre>

<p>æŸ¥è¯¢ istio-proxy çš„çŠ¶æ€ï¼š</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin | grep pending

cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_active: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_failure_eject: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: 4
cluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_total: 16
</code></pre>

<p><code>upstream_rq_pending_overflow</code> çš„å€¼æ˜¯ <code>4</code>ï¼Œè¯´æ˜æœ‰ <code>4</code> æ¬¡è°ƒç”¨è§¦å‘äº† <code>maxPendingRequests</code> æ–­è·¯å™¨çš„ç†”æ–­ç­–ç•¥ï¼Œè¢«æ ‡è®°ä¸ºç†”æ–­ã€‚</p>

<h3 id="å¦‚æœæœåŠ¡å®Œå…¨å´©æºƒæ€ä¹ˆåŠ">å¦‚æœæœåŠ¡å®Œå…¨å´©æºƒæ€ä¹ˆåŠï¼Ÿ</h3>

<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“ Envoy çš„ç†”æ–­ç­–ç•¥å¯¹é›†ç¾¤ä¸­å‹åŠ›è¿‡å¤§çš„ä¸Šæ¸¸æœåŠ¡èµ·åˆ°ä¸€å®šçš„ä¿æŠ¤ä½œç”¨ï¼Œä½†è¿˜æœ‰ä¸€ç§æç«¯çš„æƒ…å†µéœ€è¦æˆ‘ä»¬è€ƒè™‘ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æŸäº›èŠ‚ç‚¹å®Œå…¨å´©æºƒï¼ˆæˆ–è€…å³å°†å®Œå…¨å´©æºƒï¼‰è¯¥æ€ä¹ˆåŠï¼Ÿ</p>

<p>ä¸ºäº†ä¸“é—¨åº”å¯¹è¿™ç§æƒ…å†µï¼ŒEnvoy ä¸­å¼•å…¥äº†<strong>å¼‚å¸¸æ£€æµ‹</strong>çš„åŠŸèƒ½ï¼Œé€šè¿‡å‘¨æœŸæ€§çš„å¼‚å¸¸æ£€æµ‹æ¥åŠ¨æ€ç¡®å®šä¸Šæ¸¸é›†ç¾¤ä¸­çš„æŸäº›ä¸»æœºæ˜¯å¦å¼‚å¸¸ï¼Œå¦‚æœå‘ç°å¼‚å¸¸ï¼Œå°±å°†è¯¥ä¸»æœºä»è¿æ¥æ± ä¸­éš”ç¦»å‡ºå»ã€‚å¼‚å¸¸æ£€æµ‹æ˜¯<strong>è¢«åŠ¨</strong>å¥åº·æ£€æŸ¥çš„ä¸€ç§å½¢å¼ï¼ŒEnvoy åŒæ—¶æ”¯æŒ<a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/health_checking#arch-overview-health-checking" target="_blank">ä¸»åŠ¨å¥åº·æ£€æŸ¥</a>å’Œè¢«åŠ¨å¥åº·æ£€æŸ¥ï¼Œå®ƒä»¬å¯ä»¥åŒæ—¶å¯ç”¨ï¼Œè”åˆå†³å®šä¸Šæ¸¸ä¸»æœºçš„å¥åº·çŠ¶å†µã€‚</p>

<h4 id="å¼‚å¸¸æ£€æµ‹çš„éš”ç¦»ç®—æ³•">å¼‚å¸¸æ£€æµ‹çš„éš”ç¦»ç®—æ³•</h4>

<p>æ ¹æ®å¼‚å¸¸æ£€æµ‹çš„ç±»å‹ï¼Œå¯¹ä¸»æœºçš„éš”ç¦»å¯ä»¥è¿ç»­æ‰§è¡Œï¼ˆä¾‹å¦‚è¿ç»­è¿”å› <code>5xx</code> çŠ¶æ€ç ï¼‰ï¼Œä¹Ÿå¯ä»¥å‘¨æœŸæ€§æ‰§è¡Œï¼ˆä¾‹å¦‚é…ç½®äº†å‘¨æœŸæ€§æˆåŠŸç‡æ£€æµ‹ï¼‰ã€‚éš”ç¦»ç®—æ³•çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
<li>æ£€æµ‹åˆ°äº†æŸä¸ªä¸»æœºå¼‚å¸¸ã€‚</li>
<li>å¦‚æœåˆ°ç›®å‰ä¸ºæ­¢è´Ÿè½½å‡è¡¡æ± ä¸­è¿˜æ²¡æœ‰ä¸»æœºè¢«éš”ç¦»å‡ºå»ï¼ŒEnvoy å°†ä¼šç«‹å³éš”ç¦»è¯¥å¼‚å¸¸ä¸»æœºï¼›å¦‚æœå·²ç»æœ‰ä¸»æœºè¢«éš”ç¦»å‡ºå»ï¼Œå°±ä¼šæ£€æŸ¥å½“å‰éš”ç¦»çš„ä¸»æœºæ•°æ˜¯å¦ä½äºè®¾å®šçš„é˜ˆå€¼ï¼ˆé€šè¿‡ <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-max-ejection-percent" target="_blank">outlier_detection.max_ejection_percent</a> æŒ‡å®šï¼‰ï¼Œå¦‚æœå½“å‰è¢«éš”ç¦»çš„ä¸»æœºæ•°é‡ä¸è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œå°±å°†è¯¥ä¸»æœºéš”ç¦»å‡ºå»ï¼Œå¦åˆ™ä¸éš”ç¦»ã€‚</li>
<li>éš”ç¦»ä¸æ˜¯æ°¸ä¹…çš„ï¼Œä¼šæœ‰ä¸€ä¸ªæ—¶é—´é™åˆ¶ã€‚å½“ä¸»æœºè¢«éš”ç¦»åï¼Œè¯¥ä¸»æœºå°±ä¼šè¢«æ ‡è®°ä¸ºä¸å¥åº·ï¼Œå¹¶ä¸”ä¸ä¼šè¢«åŠ å…¥åˆ°è´Ÿè½½å‡è¡¡æ± ä¸­ï¼Œé™¤éè´Ÿè½½å‡è¡¡å¤„äº<a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing/panic_threshold#arch-overview-load-balancing-panic-threshold" target="_blank">ææ…Œ</a>æ¨¡å¼ã€‚éš”ç¦»æ—¶é—´ç­‰äº <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-base-ejection-time" target="_blank">outlier_detection.base_ejection_time_ms</a> çš„å€¼ä¹˜ä»¥ä¸»æœºè¢«éš”ç¦»çš„æ¬¡æ•°ã€‚æ‰€ä»¥å¦‚æœæŸä¸ªä¸»æœºè¿ç»­å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´å®ƒè¢«éš”ç¦»çš„æ—¶é—´è¶Šæ¥è¶Šé•¿ã€‚</li>
<li>ç»è¿‡äº†è§„å®šçš„éš”ç¦»æ—¶é—´ä¹‹åï¼Œè¢«éš”ç¦»çš„ä¸»æœºå°†ä¼šè‡ªåŠ¨æ¢å¤è¿‡æ¥ï¼Œé‡æ–°æ¥å—è°ƒç”¨æ–¹çš„è¿œç¨‹è°ƒç”¨ã€‚é€šå¸¸å¼‚å¸¸æ£€æµ‹ä¼šä¸ä¸»åŠ¨å¥åº·æ£€æŸ¥ä¸€èµ·ç”¨äºå…¨é¢çš„å¥åº·æ£€æŸ¥è§£å†³æ–¹æ¡ˆã€‚</li>
</ol>

<div class="notice note" >
<p class="first notice-title">æ³¨æ„</p><p>ææ…Œæ¨¡å¼æŒ‡çš„æ˜¯ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†æœåŠ¡å™¨ä¼šæ— è§†è´Ÿè½½å‡è¡¡æ± çš„å¥åº·æ ‡è®°ï¼Œé‡æ–°å‘æ‰€æœ‰ä¸»æœºå‘é€æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„æœºåˆ¶ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¿…é¡»äº†è§£åˆ°çš„ä¸€ç‚¹æ˜¯ï¼Œæœ‰æ—¶å€™â€œç†è®ºä¸Šâ€çš„ä¸œè¥¿å¯èƒ½ä¸æ˜¯æ­£å¸¸æƒ…å†µï¼Œæœ€å¥½èƒ½é™ä½ä¸€ç‚¹è¦æ±‚æ¥é˜²æ­¢æ‰©å¤§æ•…éšœå½±å“ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œå¯ä»¥å¯¹è¿™ä¸€æ¯”ä¾‹è¿›è¡Œæ§åˆ¶ï¼ˆç¼ºçœæƒ…å†µä¸‹è¶…è¿‡ 50% çš„é©±é€å°±ä¼šè¿›å…¥ææ…ŒçŠ¶æ€ï¼‰ï¼Œå¯ä»¥æé«˜ï¼Œä¹Ÿå¯ä»¥ç¦æ­¢è¿™ä¸€é˜ˆå€¼ã€‚</p></div>


<h4 id="å¼‚å¸¸æ£€æµ‹ç±»å‹">å¼‚å¸¸æ£€æµ‹ç±»å‹</h4>

<p>Envoy æ”¯æŒä¸€ä¸‹å‡ ç§å¼‚å¸¸æ£€æµ‹ç±»å‹ï¼š</p>

<ul>
<li><strong>è¿ç»­ <code>5xx</code> å“åº”</strong>ï¼šå¦‚æœä¸Šæ¸¸ä¸»æœºè¿ç»­è¿”å›ä¸€å®šæ•°é‡çš„ <code>5xx</code> å“åº”ï¼ˆåŒ…æ‹¬ <code>500</code>ï¼‰ï¼Œè¯¥ä¸»æœºå°±ä¼šè¢«é©±é€ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ <code>5xx</code> å“åº”ä¸ä»…åŒ…æ‹¬è¿”å›çš„ <code>5xx</code> çŠ¶æ€ç ï¼Œä¹ŸåŒ…æ‹¬ HTTP è·¯ç”±è¿”å›çš„ä¸€ä¸ªäº‹ä»¶ï¼ˆå¦‚è¿æ¥è¶…æ—¶å’Œè¿æ¥é”™è¯¯ï¼‰ã€‚éš”ç¦»ä¸»æœºæ‰€éœ€çš„ <code>5xx</code> å“åº”æ•°é‡ç”± <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-consecutive-5xx" target="_blank">outlier_detection.consecutive_5xx</a> çš„å€¼æ§åˆ¶ã€‚</li>
<li><strong>è¿ç»­ç½‘å…³æ•…éšœ</strong>ï¼šå¦‚æœä¸Šæ¸¸ä¸»æœºè¿ç»­è¿”å›ä¸€å®šæ•°é‡çš„ <code>&quot;gateway errors&quot;</code>ï¼ˆ<code>502</code>ï¼Œ<code>503</code> æˆ– <code>504</code> çŠ¶æ€ç ï¼Œä½†ä¸åŒ…æ‹¬ <code>500</code>ï¼‰ï¼Œè¯¥ä¸»æœºå°±ä¼šè¢«é©±é€ã€‚è¿™é‡ŒåŒæ ·ä¹ŸåŒ…æ‹¬ HTTP è·¯ç”±è¿”å›çš„ä¸€ä¸ªäº‹ä»¶ï¼ˆå¦‚è¿æ¥è¶…æ—¶å’Œè¿æ¥é”™è¯¯ï¼‰ã€‚éš”ç¦»ä¸»æœºæ‰€éœ€çš„è¿ç»­ç½‘å…³æ•…éšœæ•°é‡ç”± <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-consecutive-gateway-failure" target="_blank">outlier_detection.consecutive_gateway_failure</a> çš„å€¼æ§åˆ¶ã€‚</li>
<li><strong>è°ƒç”¨æˆåŠŸç‡</strong>ï¼šåŸºäºè°ƒç”¨æˆåŠŸç‡çš„å¼‚å¸¸æ£€æµ‹ç±»å‹ä¼šèšåˆé›†ç¾¤ä¸­æ¯ä¸ªä¸»æœºçš„è°ƒç”¨æˆåŠŸç‡ï¼Œç„¶åæ ¹æ®ç»Ÿè®¡çš„æ•°æ®ä»¥ç»™å®šçš„å‘¨æœŸæ¥éš”ç¦»ä¸»æœºã€‚å¦‚æœè¯¥ä¸»æœºçš„è¯·æ±‚æ•°é‡å°äº <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-success-rate-request-volume" target="_blank">outlier_detection.success_rate_request_volume</a> æŒ‡å®šçš„å€¼ï¼Œåˆ™ä¸ä¼šä¸ºè¯¥ä¸»æœºè®¡ç®—è°ƒç”¨æˆåŠŸç‡ï¼Œå› æ­¤èšåˆçš„ç»Ÿè®¡æ•°æ®ä¸­ä¸ä¼šåŒ…æ‹¬è¯¥ä¸»æœºçš„è°ƒç”¨æˆåŠŸç‡ã€‚å¦‚æœåœ¨ç»™å®šçš„å‘¨æœŸå†…å…·æœ‰æœ€å°æ‰€éœ€è¯·æ±‚é‡çš„ä¸»æœºæ•°å°äº <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#envoy-api-field-cluster-outlierdetection-success-rate-minimum-hosts" target="_blank">outlier_detection.success_rate_minimum_hosts</a> æŒ‡å®šçš„å€¼ï¼Œåˆ™ä¸ä¼šå¯¹è¯¥é›†ç¾¤æ‰§è¡Œè°ƒç”¨æˆåŠŸç‡æ£€æµ‹ã€‚</li>
</ul>

<p>Istio DestinationRule ä¸ Envoy çš„å¼‚å¸¸æ£€æµ‹å‚æ•°å¯¹ç…§è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<table>
<thead>
<tr>
<th align="center">Envoy paramether</th>
<th align="center">Envoy upon object</th>
<th align="center">Istio parameter</th>
<th align="center">Istio upon ojbect</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">consecutive_gateway_failure</td>
<td align="center">cluster.outlier_detection</td>
<td align="center">consecutiveErrors</td>
<td align="center">outlierDetection</td>
</tr>

<tr>
<td align="center">interval</td>
<td align="center">cluster.outlier_detection</td>
<td align="center">interval</td>
<td align="center">outlierDetection</td>
</tr>

<tr>
<td align="center">baseEjectionTime</td>
<td align="center">cluster.outlier_detection</td>
<td align="center">baseEjectionTime</td>
<td align="center">outlierDetection</td>
</tr>

<tr>
<td align="center">maxEjectionPercent</td>
<td align="center">cluster.outlier_detection</td>
<td align="center">maxEjectionPercent</td>
<td align="center">outlierDetection</td>
</tr>
</tbody>
</table>

<p>Envoy ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–å‚æ•°åœ¨ Istio ä¸­æš‚æ—¶æ˜¯ä¸æ”¯æŒçš„ï¼Œå…·ä½“å‚è€ƒ Envoy å®˜æ–¹æ–‡æ¡£ <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto#cluster-outlierdetection" target="_blank">Outlier detection</a>ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬å›å¤´å†æ¥çœ‹ä¸€ä¸‹æœ¬æ–‡æœ€åˆåˆ›å»ºçš„ DestinationRule ä¸­å…³äºå¼‚å¸¸æ£€æµ‹çš„é…ç½®ï¼š</p>

<pre><code class="language-yaml">    outlierDetection:
      consecutiveErrors: 2
      interval: 1s
      baseEjectionTime: 3m
      maxEjectionPercent: 100
</code></pre>

<p>è¯¥é…ç½®è¡¨ç¤ºæ¯ç§’é’Ÿæ‰«æä¸€æ¬¡ä¸Šæ¸¸ä¸»æœºï¼Œè¿ç»­å¤±è´¥ <code>2</code> æ¬¡è¿”å› 5xx é”™è¯¯ç çš„æ‰€æœ‰ä¸»æœºä¼šè¢«ç§»å‡ºè¿æ¥æ±  3 åˆ†é’Ÿã€‚</p>

<h4 id="å¼‚å¸¸æ£€æµ‹ç¤ºä¾‹">å¼‚å¸¸æ£€æµ‹ç¤ºä¾‹</h4>

<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡è°ƒç”¨ä¸€ä¸ª URL æ¥æŒ‡å®š httpbin æœåŠ¡è¿”å› <code>502</code> çŠ¶æ€ç ï¼Œä»¥æ­¤æ¥è§¦å‘è¿ç»­ç½‘å…³æ•…éšœå¼‚å¸¸æ£€æµ‹ã€‚æ€»å…±å‘èµ· 3 æ¬¡è°ƒç”¨ï¼Œå› ä¸º DestinationRule ä¸­çš„é…ç½®è¦æ±‚ Envoy çš„å¼‚å¸¸æ£€æµ‹æœºåˆ¶å¿…é¡»æ£€æµ‹åˆ°ä¸¤ä¸ªè¿ç»­çš„ç½‘å…³æ•…éšœæ‰ä¼šå°† httpbin æœåŠ¡ç§»é™¤è´Ÿè½½å‡è¡¡æ± ã€‚</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/status/502 export NUM_CALLS_PER_CLIENT=3 &amp;&amp; java -jar http-client.jar'

using num threads: 1
Starting pool-1-thread-1 with numCalls=3 parallelSends=false delayBetweenCalls=0 url=http://httpbin:8000/status/502 mixedRespTimes=false
pool-1-thread-1: successes=[0], failures=[3], duration=[99ms]
</code></pre>

<p>æŸ¥çœ‹ istio-proxy çš„çŠ¶æ€ï¼š</p>

<pre><code class="language-bash">$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin | grep outlier

cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_active: 1
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_consecutive_5xx: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_detected_consecutive_5xx: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_detected_consecutive_gateway_failure: 1
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_detected_success_rate: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_consecutive_5xx: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_consecutive_gateway_failure: 1
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_success_rate: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_total: 1
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_overflow: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_success_rate: 0
cluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_total: 0
</code></pre>

<p>ç¡®å®æ£€æµ‹åˆ°äº†è¿ç»­ç½‘å…³æ•…éšœï¼Œ<code>consecutive_gateway_failure</code> çš„å€¼ä¸º 1ã€‚ä½†æ˜¯æˆ‘é€šè¿‡æŸ¥çœ‹ EDSï¼Œå‘ç° Envoy å¹¶æ²¡æœ‰å°† httpbin æœåŠ¡ç§»å‡ºè´Ÿè½½å‡è¡¡æ± ï¼š</p>

<pre><code class="language-bash">$ export PILOT_SVC_IP=$(kubectl -n istio-system get svc istio-pilot -o go-template='{{.spec.clusterIP}}')
$ curl -s http://$PILOT_SVC_IP:8080/debug/edsz|grep &quot;outbound|8000||httpbin.default.svc.cluster.local&quot; -B 1 -A 15
</code></pre>

<pre><code class="language-json">{
  &quot;clusterName&quot;: &quot;outbound|8000||httpbin.default.svc.cluster.local&quot;,
  &quot;endpoints&quot;: [
    {
      &quot;locality&quot;: {

      },
      &quot;lbEndpoints&quot;: [
        {
          &quot;endpoint&quot;: {
            &quot;address&quot;: {
              &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;172.30.104.27&quot;,
                &quot;portValue&quot;: 8000
              }
            }
          },
</code></pre>

<p>å›å»é‡æ–°çœ‹äº†ä¸€ä¸‹ Envoy çš„é…ç½®ï¼Œ<code>enforcingConsecutiveGatewayFailure</code> çš„å€¼ä¸º 100ï¼Œç†è®ºä¸Š outlierDetection åº”è¯¥æ˜¯ç”Ÿæ•ˆçš„ã€‚ä½†è¿™é‡Œæˆ‘ç–å¿½äº† Envoy çš„ææ…Œæ¨¡å¼ï¼ŒEnvoy é»˜è®¤çš„ææ…Œé˜ˆå€¼æ˜¯ <code>50%</code>ï¼Œè€Œ httpbin åº”ç”¨åªæœ‰ä¸€ä¸ª upstreamï¼Œæ‰€ä»¥æ²¡æœ‰è¢«ç§»é™¤ã€‚å½“ç„¶è¿™åªæ˜¯ä¸ªäººçŒœæµ‹ï¼Œæš‚æ—¶ä¹Ÿæ²¡æ—¶é—´éªŒè¯ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚</p>

<h2 id="span-id-inline-toc-3-span-å‚è€ƒèµ„æ–™"><span id="inline-toc">3.</span> å‚è€ƒèµ„æ–™</h2>

<hr />

<ul>
<li><a href="https://preliminary.istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#outlierdetection" target="_blank">istio.networking.v1alpha3 OutlierDetection</a></li>
<li><a href="https://preliminary.istio.io/zh/docs/tasks/traffic-management/circuit-breaking/" target="_blank">Istio æµé‡ç®¡ç†ä¹‹ç†”æ–­</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/33490531" target="_blank">Envoy Proxyå’ŒNetflix Hystrixï¼Œç©¶ç«Ÿè°æ‰æ˜¯ç†”æ–­ç‹è€…ï¼Ÿ</a></li>
<li><a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/outlier#arch-overview-outlier-detection" target="_blank">Envoy Outlier detection</a></li>
<li><a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/load_balancing/panic_threshold#" target="_blank">Envoy Panic threshold</a></li>
<li><a href="https://blog.christianposta.com/microservices/01-microservices-patterns-with-envoy-proxy-part-i-circuit-breaking/" target="_blank">Microservices Patterns With Envoy Sidecar Proxy, Part I: Circuit Breaking</a></li>
</ul>

         
	 
	 <br />
	 <div style="text-align:center;color: #ccc;font-size:16px;font-family: cursive;">-------ä»–æ—¥æ±Ÿæ¹–ç›¸é€¢ <i class="fa fa-umbrella" style="color:#986dbd"></i> å†å½“æ¯é…’è¨€æ¬¢-------</div>
         
           

<div class="entry-shang text-center">
	<p>ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</p>
        <button class="zs show-zs btn rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"> <span>èµ</span> </button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">Ã—</button>
		<span class="author"><img src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-08-26-WechatIMG12268.jpeg"/>ç±³å¼€æœ—åŸºæ¨</span>
		<p class="tip"><i></i><span>çœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™</span></p>
 	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2å…ƒ</button>
			<button class="btn btn-blink" data-num="5">5å…ƒ</button>
			<button class="btn btn-blink" data-num="10">10å…ƒ</button>
			<button class="btn btn-blink" data-num="50">50å…ƒ</button>
			<button class="btn btn-blink" data-num="100">100å…ƒ</button>
			<button class="btn btn-blink" data-num="1">ä»»æ„é‡‘é¢</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2å…ƒ</button>
			<p>ä½¿ç”¨<span id="pay-type">å¾®ä¿¡</span>æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
			<img src="/img/wechat-2.png" id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
                <span class="zs-wechat"><img src="/img/wechat-btn.png"/></span>
	</div>
</div>

         

        
          <div class="blog-tags">
            
              <a href="https://fuckcloudnative.io/tags/istio/"><i class="fa fa-tags"></i>istio</a>&nbsp;
            
              <a href="https://fuckcloudnative.io/tags/service-mesh/"><i class="fa fa-tags"></i>service mesh</a>&nbsp;
            
              <a href="https://fuckcloudnative.io/tags/kubernetes/"><i class="fa fa-tags"></i>kubernetes</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
	      <a href="//service.weibo.com/share/share.php?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fcircuit_breaking-and-outlier-detection-in-istio%2f&amp;title=%e7%86%94%e6%96%ad%e4%b8%8e%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e5%9c%a8%20Istio%20%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8&amp;pic=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2fEKjSX26WsAU3Y9T.jpeg" target="_blank" title="åˆ†äº«åˆ°å¾®åš">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
      
      <li>
	      <a href="//connect.qq.com/widget/shareqq/index.html?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fcircuit_breaking-and-outlier-detection-in-istio%2f&amp;title=%e7%86%94%e6%96%ad%e4%b8%8e%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e5%9c%a8%20Istio%20%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8&amp;source=%e7%86%94%e6%96%ad%e4%b8%8e%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e5%9c%a8%20Istio%20%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8&amp;desc=%e6%9c%ac%e6%96%87%e5%b0%86%e4%bc%9a%e5%91%8a%e8%af%89%e4%bd%a0%e4%bb%80%e4%b9%88%e6%98%af%e7%86%94%e6%96%ad%e4%bb%a5%e5%8f%8a%e5%a6%82%e4%bd%95%e5%9c%a8%20Istio%20%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%86%94%e6%96%ad%e5%92%8c%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e6%9d%a5%e4%bf%9d%e9%9a%9c%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%8f%af%e7%94%a8%e6%80%a7%e3%80%82&amp;pics=https%3a%2f%2fhugo-picture.oss-cn-beijing.aliyuncs.com%2fimages%2fEKjSX26WsAU3Y9T.jpeg&amp;summary=%e6%9c%ac%e6%96%87%e5%b0%86%e4%bc%9a%e5%91%8a%e8%af%89%e4%bd%a0%e4%bb%80%e4%b9%88%e6%98%af%e7%86%94%e6%96%ad%e4%bb%a5%e5%8f%8a%e5%a6%82%e4%bd%95%e5%9c%a8%20Istio%20%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%86%94%e6%96%ad%e5%92%8c%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e6%9d%a5%e4%bf%9d%e9%9a%9c%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%8f%af%e7%94%a8%e6%80%a7%e3%80%82" target="_blank" title="åˆ†äº«åˆ° QQ">
          <i class="fab fa-qq"></i>
        </a>
      </li>
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fcircuit_breaking-and-outlier-detection-in-istio%2f&amp;text=%e7%86%94%e6%96%ad%e4%b8%8e%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e5%9c%a8%20Istio%20%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8&amp;via=RyangYang1" target="_blank" title="åˆ†äº«åˆ° Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffuckcloudnative.io%2fposts%2fcircuit_breaking-and-outlier-detection-in-istio%2f" target="_blank" title="åˆ†äº«åˆ° Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
	      <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffuckcloudnative.io%2fposts%2fcircuit_breaking-and-outlier-detection-in-istio%2f&amp;title=%e7%86%94%e6%96%ad%e4%b8%8e%e5%bc%82%e5%b8%b8%e6%a3%80%e6%b5%8b%e5%9c%a8%20Istio%20%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8" target="_blank" title="åˆ†äº«åˆ° LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">ç›¸å…³æ¨è</h4>
                  <ul>
                
                
                    <li><a href="/posts/sealos/">kubernetes é«˜å¯ç”¨éƒ¨ç½²å·¥å…·ï¼šsealos</a></li>
                
                    <li><a href="/posts/what-happens-when-k8s/">kubectl åˆ›å»º Pod èƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li>
                
                    <li><a href="/posts/istio-deploy/">Istio 1.4 éƒ¨ç½²æŒ‡å—</a></li>
                
                    <li><a href="/posts/understanding-the-pleg-is-not-healthy/">æ·±å…¥ç†è§£ Kubelet ä¸­çš„ PLEG is not healthy</a></li>
                
                    <li><a href="/posts/istio-1.3-tour/">æ‰‹æŠŠæ‰‹æ•™ä½ éƒ¨ç½² Istio 1.3</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fuckcloudnative.io/posts/optimizing-kubernetes-resource-allocation-production/" data-toggle="tooltip" data-placement="top" title="ä¼˜åŒ–ç”Ÿäº§ç¯å¢ƒä¸­çš„ Kubernetes èµ„æºåˆ†é…">&larr; å‰ä¸€ç¯‡</a>
            </li>
          
          
            <li class="next">
              <a href="https://fuckcloudnative.io/posts/nginx-mirror/" data-toggle="tooltip" data-placement="top" title="Nginx æµé‡é•œåƒä½¿ç”¨æŠ€å·§">åä¸€ç¯‡ &rarr;</a>
            </li>
          
        </ul>
      

      
	    <link rel="stylesheet" href="https://fuckcloudnative.io/css/iDisqus.min.css" />
<div id="comment"></div>
<script src="https://fuckcloudnative.io/js/iDisqus.min.js"></script>
<script>
var disq = new iDisqus('comment', {
    forum: 'fuckcloudnative',
    api: 'https://disqus.fuckcloudnative.io',
    site: 'http://fuckcloudnative.io',
    emojiPath: 'https://api.fooleap.org/emoji/unicode/',
    mode: 2,
    timeout: 15,
    init: true
});
</script>

      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:yangchuansheng33@gmail.com" target="_blank" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://hugo-picture.oss-cn-beijing.aliyuncs.com/blog/2019-06-13-%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E6%A8%AA%E7%89%88%E4%BA%8C%E7%BB%B4%E7%A0%81_2019.05.17.1.1.png" target="_blank" title="Weixin">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/yangchuansheng" target="_blank" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/RyangYang1" target="_blank" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/yang-ryan-b6659b106" target="_blank" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://weibo.com/3496206342" target="_blank" title="å¾®åš">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://drive.google.com/drive/folders/0By_W-zIhlMXqSGJyU3pHaVVpV2M" target="_blank" title="è§†é¢‘åˆ†äº«">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                    <i class="fab fa-google-drive fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://fuckcloudnative.io/index.xml" target="_blank" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x" style="color:#986dbd"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
	<br />
        <p class="credits copyright text-muted">
	  &nbsp;&bull;&nbsp;&copy;2019
          
            
              <a href="https://fuckcloudnative.io">ç±³å¼€æœ—åŸºæ¨</a>
            
          

          &nbsp;&bull;&nbsp;æ›´æ–°äº
          
            2019 å¹´ 12 æœˆ 28 æ—¥
          

	  &nbsp;&bull;&nbsp;
          <a href="https://fuckcloudnative.io/tags/">æ‰€æœ‰æ–‡ç« </a>

	  
        </p>
        <p class="credits theme-by text-muted">
        <br />
        <span id="busuanzi_container_site_pv">
            æœ¬ç«™å·²è¢«è®¿é—® <span id="busuanzi_value_site_pv"></span> æ¬¡å•¦
        </span>
        <span id="busuanzi_container_site_uv">
            &ensp;|&ensp;&thinsp;æ‚¨æ˜¯ç¬¬ <span id="busuanzi_value_site_uv"></span> ä½åˆ°è®¿çš„å°ä¼™ä¼´
        </span>
        </p>
        
        <p class="credits theme-by text-muted">
          ç”± <a href="https://gohugo.io">Hugo v0.59.0</a> å¼ºåŠ›é©±åŠ¨ &nbsp;&bull;&nbsp; ä¸»é¢˜ <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> ç§»æ¤è‡ª <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
	  <section class="credits theme-by text-muted" align="center">
    <span class="footer__copyright">
    <div>
    <span id="span_dt_dt"> </span>
    <script language="javascript">
      function show_date_time(){
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date("7/8/2017 10:56:12");
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span_dt_dt.innerHTML="æœ¬ç«™å·²ç»å¼€å¿ƒè¿è¡Œ "+daysold+" å¤© "+hrsold+" å°æ—¶ "+minsold+" åˆ† "+seconds+" ç§’";
      }
      show_date_time();
    </script>
    </div>
</script>
</section>

	</p>
      </div>
    </div>
  </div>
</footer>


<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container',
        blogId: '10020-1569254413955-300',
        name: 'äº‘åŸç”Ÿå®éªŒå®¤',
        qrcode: 'https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/wechat.gif',
        keyword: 'vip',
    });
</script>
<script src='/js/bundle.min.2edcc70ee805856207d1f946a24aa8f451cdbd10caea2a90095e50f5a05c70dc.js' integrity='sha256-LtzHDugFhWIH0flGokqo9FHNvRDK6iqQCV5Q9aBccNw='></script>






<script src="https://fuckcloudnative.io/js/load-photoswipe.js"></script>








<div class="rocket"><img src="/img/rocket_up.png" alt="" width="100" height="100"></div>
<script>
    $(function () {
      $(window).scroll(function () {
        
        if ($(window).scrollTop() >= 1000) {
          $('.rocket').stop().fadeIn(1000);
        }else {
          $('.rocket').stop().fadeOut(1000);
        }
      })
      
      $('.rocket').click(function () {
        $('html,body').stop().animate({scrollTop:0},400);
       
      })
    })

</script>




<script type="text/javascript">
      jQuery(function() {
          jQuery("img").lazyload({threshold: 0,effect: "fadeIn"});
      });
</script>











<script type="text/javascript">
$(document).ready(function () {
  $(window).scroll(function(){
    $(".top-scroll-bar").attr("style", "width: " + ($(this).scrollTop() / ($(document).height() - $(this).height()) * 100) + "%; display: block;");
  });
})
</script>


<script type="text/javascript">
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("Docker", "Kubernetes", "Prometheus", "Envoy", "Istio", "coredns", "Service Mesh", "Cloud Native");
        var $i = $("<span />").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        function randomColor() {
          var flakeColor = new Array("#FFDA65", "#00BFFF", "#BA55D3", "#FFA07A", "#87CEEB", "#FFB6C1");
          var snowColor = flakeColor[Math.floor(flakeColor.length * Math.random())];
          return snowColor;
        }
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": randomColor()
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>


    
  </body>
</html>

